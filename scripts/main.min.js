!window.XMLHttpRequest||window.FileAPI&&FileAPI.shouldLoad||(window.XMLHttpRequest.prototype.setRequestHeader=function(e){return function(t,r){if("__setXHR_"===t){var n=r(this);n instanceof Function&&n(this)}else e.apply(this,arguments)}}(window.XMLHttpRequest.prototype.setRequestHeader));var ngFileUpload=angular.module("ngFileUpload",[]);ngFileUpload.version="12.2.13",ngFileUpload.service("UploadBase",["$http","$q","$timeout",function(e,t,r){function n(n){function i(e){l.notify&&l.notify(e),c.progressFunc&&r(function(){c.progressFunc(e)})}function u(e){return null!=n._start&&a?{loaded:e.loaded+n._start,total:n._file&&n._file.size||e.total,type:e.type,config:n,lengthComputable:!0,target:e.target}:e}function s(){e(n).then(function(e){if(a&&n._chunkSize&&!n._finished&&n._file){var t=n._file&&n._file.size||0;i({loaded:Math.min(n._end,t),total:t,config:n,type:"progress"}),o.upload(n,!0)}else n._finished&&delete n._finished,l.resolve(e)},function(e){l.reject(e)},function(e){l.notify(e)})}n.method=n.method||"POST",n.headers=n.headers||{};var l=n._deferred=n._deferred||t.defer(),c=l.promise;return n.disableProgress||(n.headers.__setXHR_=function(){return function(e){e&&e.upload&&e.upload.addEventListener&&(n.__XHR=e,n.xhrFn&&n.xhrFn(e),e.upload.addEventListener("progress",function(e){e.config=n,i(u(e))},!1),e.upload.addEventListener("load",function(e){e.lengthComputable&&(e.config=n,i(u(e)))},!1))}}),a?n._chunkSize&&n._end&&!n._finished?(n._start=n._end,n._end+=n._chunkSize,s()):n.resumeSizeUrl?e.get(n.resumeSizeUrl).then(function(e){n.resumeSizeResponseReader?n._start=n.resumeSizeResponseReader(e.data):n._start=parseInt((null==e.data.size?e.data:e.data.size).toString()),n._chunkSize&&(n._end=n._start+n._chunkSize),s()},function(e){throw e}):n.resumeSize?n.resumeSize().then(function(e){n._start=e,n._chunkSize&&(n._end=n._start+n._chunkSize),s()},function(e){throw e}):(n._chunkSize&&(n._start=0,n._end=n._start+n._chunkSize),s()):s(),c.success=function(e){return c.then(function(t){e(t.data,t.status,t.headers,n)}),c},c.error=function(e){return c.then(null,function(t){e(t.data,t.status,t.headers,n)}),c},c.progress=function(e){return c.progressFunc=e,c.then(null,null,function(t){e(t)}),c},c.abort=c.pause=function(){return n.__XHR&&r(function(){n.__XHR.abort()}),c},c.xhr=function(e){return n.xhrFn=function(t){return function(){t&&t.apply(c,arguments),e.apply(c,arguments)}}(n.xhrFn),c},o.promisesCount++,c["finally"]&&c["finally"]instanceof Function&&c["finally"](function(){o.promisesCount--}),c}function i(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}var o=this;o.promisesCount=0,this.isResumeSupported=function(){return window.Blob&&window.Blob.prototype.slice};var a=this.isResumeSupported();this.isUploadInProgress=function(){return o.promisesCount>0},this.rename=function(e,t){return e.ngfName=t,e},this.jsonBlob=function(e){null==e||angular.isString(e)||(e=JSON.stringify(e));var t=new window.Blob([e],{type:"application/json"});return t._ngfBlob=!0,t},this.json=function(e){return angular.toJson(e)},this.isFile=function(e){return null!=e&&(e instanceof window.Blob||e.flashId&&e.name&&e.size)},this.upload=function(e,t){function r(t,r){if(t._ngfBlob)return t;if(e._file=e._file||t,null!=e._start&&a){e._end&&e._end>=t.size&&(e._finished=!0,e._end=t.size);var n=t.slice(e._start,e._end||t.size);return n.name=t.name,n.ngfName=t.ngfName,e._chunkSize&&(r.append("_chunkSize",e._chunkSize),r.append("_currentChunkSize",e._end-e._start),r.append("_chunkNumber",Math.floor(e._start/e._chunkSize)),r.append("_totalSize",e._file.size)),n}return t}function u(t,n,i){if(void 0!==n)if(angular.isDate(n)&&(n=n.toISOString()),angular.isString(n))t.append(i,n);else if(o.isFile(n)){var a=r(n,t),s=i.split(",");s[1]&&(a.ngfName=s[1].replace(/^\s+|\s+$/g,""),i=s[0]),e._fileKey=e._fileKey||i,t.append(i,a,a.ngfName||a.name)}else if(angular.isObject(n)){if(n.$$ngfCircularDetection)throw"ngFileUpload: Circular reference in config.data. Make sure specified data for Upload.upload() has no circular reference: "+i;n.$$ngfCircularDetection=!0;try{for(var l in n)if(n.hasOwnProperty(l)&&"$$ngfCircularDetection"!==l){var c=null==e.objectKey?"[i]":e.objectKey;n.length&&parseInt(l)>-1&&(c=null==e.arrayKey?c:e.arrayKey),u(t,n[l],i+c.replace(/[ik]/g,l))}}finally{delete n.$$ngfCircularDetection}}else t.append(i,n)}function s(){e._chunkSize=o.translateScalars(e.resumeChunkSize),e._chunkSize=e._chunkSize?parseInt(e._chunkSize.toString()):null,e.headers=e.headers||{},e.headers["Content-Type"]=void 0,e.transformRequest=e.transformRequest?angular.isArray(e.transformRequest)?e.transformRequest:[e.transformRequest]:[],e.transformRequest.push(function(t){var r,n=new window.FormData;t=t||e.fields||{},e.file&&(t.file=e.file);for(r in t)if(t.hasOwnProperty(r)){var i=t[r];e.formDataAppender?e.formDataAppender(n,r,i):u(n,i,r)}return n})}return t||(e=i(e)),e._isDigested||(e._isDigested=!0,s()),n(e)},this.http=function(t){return t=i(t),t.transformRequest=t.transformRequest||function(t){return window.ArrayBuffer&&t instanceof window.ArrayBuffer||t instanceof window.Blob?t:e.defaults.transformRequest[0].apply(this,arguments)},t._chunkSize=o.translateScalars(t.resumeChunkSize),t._chunkSize=t._chunkSize?parseInt(t._chunkSize.toString()):null,n(t)},this.translateScalars=function(e){if(angular.isString(e)){if(e.search(/kb/i)===e.length-2)return parseFloat(1024*e.substring(0,e.length-2));if(e.search(/mb/i)===e.length-2)return parseFloat(1048576*e.substring(0,e.length-2));if(e.search(/gb/i)===e.length-2)return parseFloat(1073741824*e.substring(0,e.length-2));if(e.search(/b/i)===e.length-1)return parseFloat(e.substring(0,e.length-1));if(e.search(/s/i)===e.length-1)return parseFloat(e.substring(0,e.length-1));if(e.search(/m/i)===e.length-1)return parseFloat(60*e.substring(0,e.length-1));if(e.search(/h/i)===e.length-1)return parseFloat(3600*e.substring(0,e.length-1))}return e},this.urlToBlob=function(r){var n=t.defer();return e({url:r,method:"get",responseType:"arraybuffer"}).then(function(e){var t=new Uint8Array(e.data),i=e.headers("content-type")||"image/WebP",o=new window.Blob([t],{type:i}),a=r.match(/.*\/(.+?)(\?.*)?$/);a.length>1&&(o.name=a[1]),n.resolve(o)},function(e){n.reject(e)}),n.promise},this.setDefaults=function(e){this.defaults=e||{}},this.defaults={},this.version=ngFileUpload.version}]),ngFileUpload.service("Upload",["$parse","$timeout","$compile","$q","UploadExif",function(e,t,r,n,i){function o(e,t,r){var i=[s.emptyPromise()];return angular.forEach(e,function(n,o){0===n.type.indexOf("image/jpeg")&&s.attrGetter("ngfFixOrientation",t,r,{$file:n})&&i.push(s.happyPromise(s.applyExifRotation(n),n).then(function(t){e.splice(o,1,t)}))}),n.all(i)}function a(e,t,r,i){var o=s.attrGetter("ngfResize",t,r);if(!o||!s.isResizeSupported()||!e.length)return s.emptyPromise();if(o instanceof Function){var a=n.defer();return o(e).then(function(n){u(n,e,t,r,i).then(function(e){a.resolve(e)},function(e){a.reject(e)})},function(e){a.reject(e)})}return u(o,e,t,r,i)}function u(e,t,r,i,o){function a(n,a){if(0===n.type.indexOf("image")){if(e.pattern&&!s.validatePattern(n,e.pattern))return;e.resizeIf=function(e,t){return s.attrGetter("ngfResizeIf",r,i,{$width:e,$height:t,$file:n})};var l=s.resize(n,e);u.push(l),l.then(function(e){t.splice(a,1,e)},function(e){n.$error="resize",(n.$errorMessages=n.$errorMessages||{}).resize=!0,n.$errorParam=(e?(e.message?e.message:e)+": ":"")+(n&&n.name),o.$ngfValidations.push({name:"resize",valid:!1}),s.applyModelValidation(o,t)})}}for(var u=[s.emptyPromise()],l=0;l<t.length;l++)a(t[l],l);return n.all(u)}var s=i;return s.getAttrWithDefaults=function(e,t){if(null!=e[t])return e[t];var r=s.defaults[t];return null==r?r:angular.isString(r)?r:JSON.stringify(r)},s.attrGetter=function(t,r,n,i){var o=this.getAttrWithDefaults(r,t);if(!n)return o;try{return i?e(o)(n,i):e(o)(n)}catch(a){if(t.search(/min|max|pattern/i))return o;throw a}},s.shouldUpdateOn=function(e,t,r){var n=s.attrGetter("ngfModelOptions",t,r);return!n||!n.updateOn||n.updateOn.split(" ").indexOf(e)>-1},s.emptyPromise=function(){var e=n.defer(),r=arguments;return t(function(){e.resolve.apply(e,r)}),e.promise},s.rejectPromise=function(){var e=n.defer(),r=arguments;return t(function(){e.reject.apply(e,r)}),e.promise},s.happyPromise=function(e,r){var i=n.defer();return e.then(function(e){i.resolve(e)},function(e){t(function(){throw e}),i.resolve(r)}),i.promise},s.updateModel=function(r,n,i,u,l,c,d){function f(o,a,l,d,f){n.$$ngfPrevValidFiles=o,n.$$ngfPrevInvalidFiles=a;var g=o&&o.length?o[0]:null,p=a&&a.length?a[0]:null;r&&(s.applyModelValidation(r,o),r.$setViewValue(f?g:o)),u&&e(u)(i,{$files:o,$file:g,$newFiles:l,$duplicateFiles:d,$invalidFiles:a,$invalidFile:p,$event:c});var m=s.attrGetter("ngfModelInvalid",n);m&&t(function(){e(m).assign(i,f?p:a)}),t(function(){})}function g(){function e(e,t){return e.name===t.name&&(e.$ngfOrigSize||e.size)===(t.$ngfOrigSize||t.size)&&e.type===t.type}function t(t){var r;for(r=0;r<v.length;r++)if(e(t,v[r]))return!0;for(r=0;r<y.length;r++)if(e(t,y[r]))return!0;return!1}if(l){h=[],b=[];for(var r=0;r<l.length;r++)t(l[r])?b.push(l[r]):h.push(l[r])}}function p(e){return angular.isArray(e)?e:[e]}function m(){function e(){t(function(){f(S?v.concat(U):U,S?y.concat($):$,l,b,C)},w&&w.debounce?w.debounce.change||w.debounce:0)}var o=E?h:U;a(o,n,i,r).then(function(){E?s.validate(h,S?v.length:0,r,n,i).then(function(t){U=t.validsFiles,$=t.invalidsFiles,e()}):e()},function(){for(var t=0;t<o.length;t++){var r=o[t];if("resize"===r.$error){var n=U.indexOf(r);n>-1&&(U.splice(n,1),$.push(r)),e()}}})}var h,v,y,b=[],$=[],U=[];v=n.$$ngfPrevValidFiles||[],y=n.$$ngfPrevInvalidFiles||[],r&&r.$modelValue&&(v=p(r.$modelValue));var S=s.attrGetter("ngfKeep",n,i);h=(l||[]).slice(0),"distinct"!==S&&s.attrGetter("ngfKeepDistinct",n,i)!==!0||g(n,i);var C=!S&&!s.attrGetter("ngfMultiple",n,i)&&!s.attrGetter("multiple",n);if(!S||h.length){s.attrGetter("ngfBeforeModelChange",n,i,{$files:l,$file:l&&l.length?l[0]:null,$newFiles:h,$duplicateFiles:b,$event:c});var E=s.attrGetter("ngfValidateAfterResize",n,i),w=s.attrGetter("ngfModelOptions",n,i);s.validate(h,S?v.length:0,r,n,i).then(function(e){d?f(h,[],l,b,C):(w&&w.allowInvalid||E?U=h:(U=e.validFiles,$=e.invalidFiles),s.attrGetter("ngfFixOrientation",n,i)&&s.isExifSupported()?o(U,n,i).then(function(){m()}):m())})}},s}]),ngFileUpload.directive("ngfSelect",["$parse","$timeout","$compile","Upload",function(e,t,r,n){function i(e){var t=e.match(/Android[^\d]*(\d+)\.(\d+)/);if(t&&t.length>2){var r=n.defaults.androidFixMinorVersion||4;return parseInt(t[1])<4||parseInt(t[1])===r&&parseInt(t[2])<r}return e.indexOf("Chrome")===-1&&/.*Windows.*Safari.*/.test(e)}function o(e,t,r,n,o,u,s,l){function c(){return"input"===t[0].tagName.toLowerCase()&&r.type&&"file"===r.type.toLowerCase()}function d(){return b("ngfChange")||b("ngfSelect")}function f(t){if(l.shouldUpdateOn("change",r,e)){var i=t.__files_||t.target&&t.target.files,o=[];if(!i)return;for(var a=0;a<i.length;a++)o.push(i[a]);l.updateModel(n,r,e,d(),o.length?o:null,t)}}function g(e,n){function i(t){e.attr("id","ngf-"+t),n.attr("id","ngf-label-"+t)}for(var o=0;o<t[0].attributes.length;o++){var a=t[0].attributes[o];"type"!==a.name&&"class"!==a.name&&"style"!==a.name&&("id"===a.name?(i(a.value),$.push(r.$observe("id",i))):e.attr(a.name,a.value||"required"!==a.name&&"multiple"!==a.name?a.value:a.name))}}function p(){if(c())return t;var e=angular.element('<input type="file">'),r=angular.element("<label>upload</label>");return r.css("visibility","hidden").css("position","absolute").css("overflow","hidden").css("width","0px").css("height","0px").css("border","none").css("margin","0px").css("padding","0px").attr("tabindex","-1"),g(e,r),a.push({el:t,ref:r}),document.body.appendChild(r.append(e)[0]),e}function m(r){if(t.attr("disabled"))return!1;if(!b("ngfSelectDisabled",e)){var n=h(r);if(null!=n)return n;v(r);try{c()||document.body.contains(C[0])||(a.push({el:t,ref:C.parent()}),document.body.appendChild(C.parent()[0]),C.bind("change",f))}catch(o){}return i(navigator.userAgent)?setTimeout(function(){C[0].click()},0):C[0].click(),!1}}function h(e){var t=e.changedTouches||e.originalEvent&&e.originalEvent.changedTouches;if(t){if("touchstart"===e.type)return S=t[0].clientX,U=t[0].clientY,!0;if("touchend"===e.type){var r=t[0].clientX,n=t[0].clientY;if(Math.abs(r-S)>20||Math.abs(n-U)>20)return e.stopPropagation(),e.preventDefault(),!1}return!0}}function v(t){l.shouldUpdateOn("click",r,e)&&C.val()&&(C.val(null),l.updateModel(n,r,e,d(),null,t,!0))}function y(e){if(C&&!C.attr("__ngf_ie10_Fix_")){if(!C[0].parentNode)return void(C=null);e.preventDefault(),e.stopPropagation(),C.unbind("click");var t=C.clone();return C.replaceWith(t),C=t,C.attr("__ngf_ie10_Fix_","true"),C.bind("change",f),C.bind("click",y),C[0].click(),!1}C.removeAttr("__ngf_ie10_Fix_")}var b=function(e,t){return l.attrGetter(e,r,t)};l.registerModelChangeValidator(n,r,e);var $=[];b("ngfMultiple")&&$.push(e.$watch(b("ngfMultiple"),function(){C.attr("multiple",b("ngfMultiple",e))})),b("ngfCapture")&&$.push(e.$watch(b("ngfCapture"),function(){C.attr("capture",b("ngfCapture",e))})),b("ngfAccept")&&$.push(e.$watch(b("ngfAccept"),function(){C.attr("accept",b("ngfAccept",e))})),$.push(r.$observe("accept",function(){C.attr("accept",b("accept"))}));var U=0,S=0,C=t;c()||(C=p()),C.bind("change",f),c()?t.bind("click",v):t.bind("click touchstart touchend",m),navigator.appVersion.indexOf("MSIE 10")!==-1&&C.bind("click",y),n&&n.$formatters.push(function(e){return null!=e&&0!==e.length||C.val()&&C.val(null),e}),e.$on("$destroy",function(){c()||C.parent().remove(),angular.forEach($,function(e){e()})}),u(function(){for(var e=0;e<a.length;e++){var t=a[e];document.body.contains(t.el[0])||(a.splice(e,1),t.ref.remove())}}),window.FileAPI&&window.FileAPI.ngfFixIE&&window.FileAPI.ngfFixIE(t,C,f)}var a=[];return{restrict:"AEC",require:"?ngModel",link:function(i,a,u,s){o(i,a,u,s,e,t,r,n)}}}]),function(){function e(e){return"img"===e.tagName.toLowerCase()?"image":"audio"===e.tagName.toLowerCase()?"audio":"video"===e.tagName.toLowerCase()?"video":/./}function t(t,r,n,i,o,a,u,s){function l(e){var a=t.attrGetter("ngfNoObjectUrl",o,n);t.dataUrl(e,a)["finally"](function(){r(function(){var t=(a?e.$ngfDataUrl:e.$ngfBlobUrl)||e.$ngfDataUrl;s?i.css("background-image","url('"+(t||"")+"')"):i.attr("src",t),t?i.removeClass("ng-hide"):i.addClass("ng-hide")})})}r(function(){var r=n.$watch(o[a],function(r){var c=u;if("ngfThumbnail"===a&&(c||(c={width:i[0].naturalWidth||i[0].clientWidth,height:i[0].naturalHeight||i[0].clientHeight}),0===c.width&&window.getComputedStyle)){var d=getComputedStyle(i[0]);d.width&&d.width.indexOf("px")>-1&&d.height&&d.height.indexOf("px")>-1&&(c={width:parseInt(d.width.slice(0,-2)),height:parseInt(d.height.slice(0,-2))})}return angular.isString(r)?(i.removeClass("ng-hide"),s?i.css("background-image","url('"+r+"')"):i.attr("src",r)):void(!r||!r.type||0!==r.type.search(e(i[0]))||s&&0!==r.type.indexOf("image")?i.addClass("ng-hide"):c&&t.isResizeSupported()?(c.resizeIf=function(e,i){return t.attrGetter("ngfResizeIf",o,n,{$width:e,$height:i,$file:r})},t.resize(r,c).then(function(e){l(e)},function(e){throw e})):l(r))});n.$on("$destroy",function(){r()})})}ngFileUpload.service("UploadDataUrl",["UploadBase","$timeout","$q",function(e,t,r){var n=e;return n.base64DataUrl=function(e){if(angular.isArray(e)){var t=r.defer(),i=0;return angular.forEach(e,function(r){n.dataUrl(r,!0)["finally"](function(){if(i++,i===e.length){var r=[];angular.forEach(e,function(e){r.push(e.$ngfDataUrl)}),t.resolve(r,e)}})}),t.promise}return n.dataUrl(e,!0)},n.dataUrl=function(e,i){if(!e)return n.emptyPromise(e,e);if(i&&null!=e.$ngfDataUrl||!i&&null!=e.$ngfBlobUrl)return n.emptyPromise(i?e.$ngfDataUrl:e.$ngfBlobUrl,e);var o=i?e.$$ngfDataUrlPromise:e.$$ngfBlobUrlPromise;if(o)return o;var a=r.defer();return t(function(){if(window.FileReader&&e&&(!window.FileAPI||navigator.userAgent.indexOf("MSIE 8")===-1||e.size<2e4)&&(!window.FileAPI||navigator.userAgent.indexOf("MSIE 9")===-1||e.size<4e6)){var r=window.URL||window.webkitURL;if(r&&r.createObjectURL&&!i){var o;try{o=r.createObjectURL(e)}catch(u){return void t(function(){e.$ngfBlobUrl="",a.reject()})}t(function(){if(e.$ngfBlobUrl=o,o){a.resolve(o,e),n.blobUrls=n.blobUrls||[],n.blobUrlsTotalSize=n.blobUrlsTotalSize||0,n.blobUrls.push({url:o,size:e.size}),n.blobUrlsTotalSize+=e.size||0;for(var t=n.defaults.blobUrlsMaxMemory||268435456,i=n.defaults.blobUrlsMaxQueueSize||200;(n.blobUrlsTotalSize>t||n.blobUrls.length>i)&&n.blobUrls.length>1;){var u=n.blobUrls.splice(0,1)[0];r.revokeObjectURL(u.url),n.blobUrlsTotalSize-=u.size}}})}else{var s=new FileReader;s.onload=function(r){t(function(){e.$ngfDataUrl=r.target.result,a.resolve(r.target.result,e),t(function(){delete e.$ngfDataUrl},1e3)})},s.onerror=function(){t(function(){e.$ngfDataUrl="",a.reject()})},s.readAsDataURL(e)}}else t(function(){e[i?"$ngfDataUrl":"$ngfBlobUrl"]="",a.reject()})}),o=i?e.$$ngfDataUrlPromise=a.promise:e.$$ngfBlobUrlPromise=a.promise,o["finally"](function(){delete e[i?"$$ngfDataUrlPromise":"$$ngfBlobUrlPromise"]}),o},n}]),ngFileUpload.directive("ngfSrc",["Upload","$timeout",function(e,r){return{restrict:"AE",link:function(n,i,o){t(e,r,n,i,o,"ngfSrc",e.attrGetter("ngfResize",o,n),!1)}}}]),ngFileUpload.directive("ngfBackground",["Upload","$timeout",function(e,r){return{restrict:"AE",link:function(n,i,o){t(e,r,n,i,o,"ngfBackground",e.attrGetter("ngfResize",o,n),!0)}}}]),ngFileUpload.directive("ngfThumbnail",["Upload","$timeout",function(e,r){return{restrict:"AE",link:function(n,i,o){var a=e.attrGetter("ngfSize",o,n);t(e,r,n,i,o,"ngfThumbnail",a,e.attrGetter("ngfAsBackground",o,n))}}}]),ngFileUpload.config(["$compileProvider",function(e){e.imgSrcSanitizationWhitelist&&e.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|webcal|local|file|data|blob):/),e.aHrefSanitizationWhitelist&&e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|webcal|local|file|data|blob):/)}]),ngFileUpload.filter("ngfDataUrl",["UploadDataUrl","$sce",function(e,t){return function(r,n,i){if(angular.isString(r))return t.trustAsResourceUrl(r);var o=r&&((n?r.$ngfDataUrl:r.$ngfBlobUrl)||r.$ngfDataUrl);return r&&!o?(!r.$ngfDataUrlFilterInProgress&&angular.isObject(r)&&(r.$ngfDataUrlFilterInProgress=!0,e.dataUrl(r,n)),""):(r&&delete r.$ngfDataUrlFilterInProgress,(r&&o?i?t.trustAsResourceUrl(o):o:r)||"")}}])}(),ngFileUpload.service("UploadValidate",["UploadDataUrl","$q","$timeout",function(e,t,r){function n(e){var t="",r=[];if(e.length>2&&"/"===e[0]&&"/"===e[e.length-1])t=e.substring(1,e.length-1);else{var i=e.split(",");if(i.length>1)for(var o=0;o<i.length;o++){var a=n(i[o]);a.regexp?(t+="("+a.regexp+")",o<i.length-1&&(t+="|")):r=r.concat(a.excludes)}else 0===e.indexOf("!")?r.push("^((?!"+n(e.substring(1)).regexp+").)*$"):(0===e.indexOf(".")&&(e="*"+e),t="^"+e.replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g"),"\\$&")+"$",t=t.replace(/\\\*/g,".*").replace(/\\\?/g,"."))}return{regexp:t,excludes:r}}function i(e,t){null==t||e.$dirty||(e.$setDirty?e.$setDirty():e.$dirty=!0)}var o=e;return o.validatePattern=function(e,t){if(!t)return!0;var r=n(t),i=!0;if(r.regexp&&r.regexp.length){var o=new RegExp(r.regexp,"i");i=null!=e.type&&o.test(e.type)||null!=e.name&&o.test(e.name)}for(var a=r.excludes.length;a--;){var u=new RegExp(r.excludes[a],"i");i=i&&(null==e.type||u.test(e.type))&&(null==e.name||u.test(e.name))}return i},o.ratioToFloat=function(e){var t=e.toString(),r=t.search(/[x:]/i);return t=r>-1?parseFloat(t.substring(0,r))/parseFloat(t.substring(r+1)):parseFloat(t)},o.registerModelChangeValidator=function(e,t,r){e&&e.$formatters.push(function(n){if(e.$dirty){var i=n;n&&!angular.isArray(n)&&(i=[n]),o.validate(i,0,e,t,r).then(function(){o.applyModelValidation(e,i)})}return n})},o.applyModelValidation=function(e,t){i(e,t),angular.forEach(e.$ngfValidations,function(t){e.$setValidity(t.name,t.valid)})},o.getValidationAttr=function(e,t,r,n,i){var a="ngf"+r[0].toUpperCase()+r.substr(1),u=o.attrGetter(a,e,t,{$file:i});if(null==u&&(u=o.attrGetter("ngfValidate",e,t,{$file:i}))){var s=(n||r).split(".");u=u[s[0]],s.length>1&&(u=u&&u[s[1]])}return u},o.validate=function(e,r,n,i,a){function u(t,r,u){if(e){for(var s=e.length,l=null;s--;){var g=e[s];if(g){var p=o.getValidationAttr(i,a,t,r,g);null!=p&&(u(g,p,s)||(c.indexOf(t)===-1?(g.$error=t,(g.$errorMessages=g.$errorMessages||{})[t]=!0,g.$errorParam=p,f.indexOf(g)===-1&&f.push(g),d||e.splice(s,1),l=!1):e.splice(s,1)))}}null!==l&&n.$ngfValidations.push({name:t,valid:l})}}function s(r,u,s,g,p){function m(t,n,i){function o(o){if(o())if(c.indexOf(r)===-1){if(n.$error=r,(n.$errorMessages=n.$errorMessages||{})[r]=!0,n.$errorParam=i,f.indexOf(n)===-1&&f.push(n),!d){var a=e.indexOf(n);a>-1&&e.splice(a,1)}t.resolve(!1)}else{var u=e.indexOf(n);u>-1&&e.splice(u,1),t.resolve(!0)}else t.resolve(!0)}null!=i?g(n,i).then(function(e){o(function(){return!p(e,i)})},function(){o(function(){return l("ngfValidateForce",{$file:n})})}):t.resolve(!0)}var h=[o.emptyPromise(!0)];e&&(e=void 0===e.length?[e]:e,angular.forEach(e,function(e){var n=t.defer();return h.push(n.promise),!s||null!=e.type&&0===e.type.search(s)?void("dimensions"===r&&null!=o.attrGetter("ngfDimensions",i)?o.imageDimensions(e).then(function(t){m(n,e,l("ngfDimensions",{$file:e,$width:t.width,$height:t.height}))},function(){n.resolve(!1)}):"duration"===r&&null!=o.attrGetter("ngfDuration",i)?o.mediaDuration(e).then(function(t){m(n,e,l("ngfDuration",{$file:e,$duration:t}))},function(){n.resolve(!1)}):m(n,e,o.getValidationAttr(i,a,r,u,e))):void n.resolve(!0)}));var v=t.defer();return t.all(h).then(function(e){for(var t=!0,i=0;i<e.length;i++)if(!e[i]){t=!1;break}n.$ngfValidations.push({name:r,valid:t}),v.resolve(t)}),v.promise}n=n||{},n.$ngfValidations=n.$ngfValidations||[],angular.forEach(n.$ngfValidations,function(e){e.valid=!0});var l=function(e,t){return o.attrGetter(e,i,a,t)},c=(o.attrGetter("ngfIgnoreInvalid",i,a)||"").split(" "),d=o.attrGetter("ngfRunAllValidations",i,a);if(null==e||0===e.length)return o.emptyPromise({validFiles:e,invalidFiles:[]});e=void 0===e.length?[e]:e.slice(0);var f=[];u("pattern",null,o.validatePattern),u("minSize","size.min",function(e,t){return e.size+.1>=o.translateScalars(t)}),u("maxSize","size.max",function(e,t){return e.size-.1<=o.translateScalars(t)});var g=0;if(u("maxTotalSize",null,function(t,r){return g+=t.size,!(g>o.translateScalars(r))||(e.splice(0,e.length),!1)}),u("validateFn",null,function(e,t){return t===!0||null===t||""===t}),!e.length)return o.emptyPromise({validFiles:[],invalidFiles:f});var p=t.defer(),m=[];return m.push(s("maxHeight","height.max",/image/,this.imageDimensions,function(e,t){return e.height<=t})),m.push(s("minHeight","height.min",/image/,this.imageDimensions,function(e,t){return e.height>=t})),m.push(s("maxWidth","width.max",/image/,this.imageDimensions,function(e,t){return e.width<=t})),m.push(s("minWidth","width.min",/image/,this.imageDimensions,function(e,t){return e.width>=t})),m.push(s("dimensions",null,/image/,function(e,t){return o.emptyPromise(t)},function(e){return e})),m.push(s("ratio",null,/image/,this.imageDimensions,function(e,t){for(var r=t.toString().split(","),n=!1,i=0;i<r.length;i++)Math.abs(e.width/e.height-o.ratioToFloat(r[i]))<.01&&(n=!0);return n})),m.push(s("maxRatio","ratio.max",/image/,this.imageDimensions,function(e,t){return e.width/e.height-o.ratioToFloat(t)<1e-4})),m.push(s("minRatio","ratio.min",/image/,this.imageDimensions,function(e,t){return e.width/e.height-o.ratioToFloat(t)>-1e-4})),m.push(s("maxDuration","duration.max",/audio|video/,this.mediaDuration,function(e,t){return e<=o.translateScalars(t)})),m.push(s("minDuration","duration.min",/audio|video/,this.mediaDuration,function(e,t){return e>=o.translateScalars(t)})),m.push(s("duration",null,/audio|video/,function(e,t){return o.emptyPromise(t)},function(e){return e})),m.push(s("validateAsyncFn",null,null,function(e,t){return t},function(e){return e===!0||null===e||""===e})),t.all(m).then(function(){if(d)for(var t=0;t<e.length;t++){var n=e[t];n.$error&&e.splice(t--,1)}d=!1,u("maxFiles",null,function(e,t,n){return r+n<t}),p.resolve({validFiles:e,invalidFiles:f})}),p.promise},o.imageDimensions=function(e){if(e.$ngfWidth&&e.$ngfHeight){var n=t.defer();return r(function(){n.resolve({width:e.$ngfWidth,height:e.$ngfHeight})}),n.promise}if(e.$ngfDimensionPromise)return e.$ngfDimensionPromise;var i=t.defer();return r(function(){return 0!==e.type.indexOf("image")?void i.reject("not image"):void o.dataUrl(e).then(function(t){function n(){var t=u[0].naturalWidth||u[0].clientWidth,r=u[0].naturalHeight||u[0].clientHeight;u.remove(),e.$ngfWidth=t,e.$ngfHeight=r,i.resolve({width:t,height:r})}function o(){u.remove(),i.reject("load error")}function a(){r(function(){u[0].parentNode&&(u[0].clientWidth?n():s++>10?o():a())},1e3)}var u=angular.element("<img>").attr("src",t).css("visibility","hidden").css("position","fixed").css("max-width","none !important").css("max-height","none !important");u.on("load",n),u.on("error",o);var s=0;a(),angular.element(document.getElementsByTagName("body")[0]).append(u)},function(){i.reject("load error")})}),e.$ngfDimensionPromise=i.promise,e.$ngfDimensionPromise["finally"](function(){delete e.$ngfDimensionPromise}),e.$ngfDimensionPromise},o.mediaDuration=function(e){if(e.$ngfDuration){var n=t.defer();return r(function(){n.resolve(e.$ngfDuration)}),n.promise}if(e.$ngfDurationPromise)return e.$ngfDurationPromise;var i=t.defer();return r(function(){return 0!==e.type.indexOf("audio")&&0!==e.type.indexOf("video")?void i.reject("not media"):void o.dataUrl(e).then(function(t){function n(){var t=u[0].duration;e.$ngfDuration=t,u.remove(),i.resolve(t)}function o(){u.remove(),i.reject("load error")}function a(){r(function(){u[0].parentNode&&(u[0].duration?n():s>10?o():a())},1e3)}var u=angular.element(0===e.type.indexOf("audio")?"<audio>":"<video>").attr("src",t).css("visibility","none").css("position","fixed");u.on("loadedmetadata",n),u.on("error",o);var s=0;a(),angular.element(document.body).append(u)},function(){i.reject("load error")})}),e.$ngfDurationPromise=i.promise,e.$ngfDurationPromise["finally"](function(){delete e.$ngfDurationPromise}),e.$ngfDurationPromise},o}]),ngFileUpload.service("UploadResize",["UploadValidate","$q",function(e,t){var r=e,n=function(e,t,r,n,i){var o=i?Math.max(r/e,n/t):Math.min(r/e,n/t);return{width:e*o,height:t*o,marginX:e*o-r,marginY:t*o-n}},i=function(e,i,o,a,u,s,l,c){var d=t.defer(),f=document.createElement("canvas"),g=document.createElement("img");return g.setAttribute("style","visibility:hidden;position:fixed;z-index:-100000"),document.body.appendChild(g),g.onload=function(){var e=g.width,t=g.height;if(g.parentNode.removeChild(g),null!=c&&c(e,t)===!1)return void d.reject("resizeIf");try{if(s){var p=r.ratioToFloat(s),m=e/t;m<p?(i=e,o=i/p):(o=t,i=o*p)}i||(i=e),o||(o=t);var h=n(e,t,i,o,l);f.width=Math.min(h.width,i),f.height=Math.min(h.height,o);var v=f.getContext("2d");v.drawImage(g,Math.min(0,-h.marginX/2),Math.min(0,-h.marginY/2),h.width,h.height),d.resolve(f.toDataURL(u||"image/WebP",a||.934))}catch(y){d.reject(y)}},g.onerror=function(){g.parentNode.removeChild(g),d.reject()},g.src=e,d.promise};return r.dataUrltoBlob=function(e,t,r){for(var n=e.split(","),i=n[0].match(/:(.*?);/)[1],o=atob(n[1]),a=o.length,u=new Uint8Array(a);a--;)u[a]=o.charCodeAt(a);var s=new window.Blob([u],{type:i});return s.name=t,s.$ngfOrigSize=r,s},r.isResizeSupported=function(){var e=document.createElement("canvas");return window.atob&&e.getContext&&e.getContext("2d")&&window.Blob},r.isResizeSupported()&&Object.defineProperty(window.Blob.prototype,"name",{get:function(){return this.$ngfName},set:function(e){this.$ngfName=e},configurable:!0}),r.resize=function(e,n){if(0!==e.type.indexOf("image"))return r.emptyPromise(e);var o=t.defer();return r.dataUrl(e,!0).then(function(t){i(t,n.width,n.height,n.quality,n.type||e.type,n.ratio,n.centerCrop,n.resizeIf).then(function(i){if("image/jpeg"===e.type&&n.restoreExif!==!1)try{i=r.restoreExif(t,i)}catch(a){setTimeout(function(){throw a},1)}try{var u=r.dataUrltoBlob(i,e.name,e.size);o.resolve(u)}catch(a){o.reject(a)}},function(t){"resizeIf"===t&&o.resolve(e),o.reject(t)})},function(e){o.reject(e)}),o.promise},r}]),function(){function e(e,r,n,i,o,a,u,s,l,c){function d(){return r.attr("disabled")||y("ngfDropDisabled",e)}function f(t,r,n){if(t){var i;try{i=t&&t.getData&&t.getData("text/html")}catch(o){}h(t.items,t.files,y("ngfAllowDir",e)!==!1,y("multiple")||y("ngfMultiple",e)).then(function(e){e.length?g(e,r):p(n,i).then(function(e){g(e,r)})})}}function g(t,r){s.updateModel(i,n,e,y("ngfChange")||y("ngfDrop"),t,r)}function p(t,r){if(!s.shouldUpdateOn(t,n,e)||"string"!=typeof r)return s.rejectPromise([]);var i=[];r.replace(/<(img src|img [^>]* src) *=\"([^\"]*)\"/gi,function(e,t,r){i.push(r)});var o=[],a=[];if(i.length){angular.forEach(i,function(e){o.push(s.urlToBlob(e).then(function(e){a.push(e)}))});var u=c.defer();return c.all(o).then(function(){u.resolve(a)},function(e){u.reject(e)}),u.promise}return s.emptyPromise()}function m(e,t,r,n){var i=y("ngfDragOverClass",e,{$event:r}),o="dragover";if(angular.isString(i))o=i;else if(i&&(i.delay&&(S=i.delay),i.accept||i.reject)){var a=r.dataTransfer.items;if(null!=a&&a.length)for(var u=i.pattern||y("ngfPattern",e,{$event:r}),l=a.length;l--;){if(!s.validatePattern(a[l],u)){o=i.reject;break}o=i.accept}else o=i.accept}n(o)}function h(t,r,i,o){function a(e,t){var r=c.defer();if(null!=e)if(e.isDirectory){var n=[s.emptyPromise()];if(f){var i={type:"directory"};i.name=i.path=(t||"")+e.name,g.push(i)}var o=e.createReader(),u=[],m=function(){o.readEntries(function(i){try{i.length?(u=u.concat(Array.prototype.slice.call(i||[],0)),m()):(angular.forEach(u.slice(0),function(r){g.length<=l&&p<=d&&n.push(a(r,(t?t:"")+e.name+"/"))}),c.all(n).then(function(){r.resolve()},function(e){r.reject(e)}))}catch(o){r.reject(o)}},function(e){r.reject(e)})};m()}else e.file(function(e){try{e.path=(t?t:"")+e.name,f&&(e=s.rename(e,e.path)),g.push(e),p+=e.size,r.resolve()}catch(n){r.reject(n)}},function(e){r.reject(e)});return r.promise}var l=s.getValidationAttr(n,e,"maxFiles");null==l&&(l=Number.MAX_VALUE);var d=s.getValidationAttr(n,e,"maxTotalSize");null==d&&(d=Number.MAX_VALUE);var f=y("ngfIncludeDir",e),g=[],p=0,m=[s.emptyPromise()];if(t&&t.length>0&&"file:"!==u.location.protocol)for(var h=0;h<t.length;h++){if(t[h].webkitGetAsEntry&&t[h].webkitGetAsEntry()&&t[h].webkitGetAsEntry().isDirectory){var v=t[h].webkitGetAsEntry();if(v.isDirectory&&!i)continue;null!=v&&m.push(a(v))}else{var b=t[h].getAsFile();null!=b&&(g.push(b),p+=b.size)}if(g.length>l||p>d||!o&&g.length>0)break}else if(null!=r)for(var $=0;$<r.length;$++){var U=r.item($);if((U.type||U.size>0)&&(g.push(U),p+=U.size),g.length>l||p>d||!o&&g.length>0)break}var S=c.defer();return c.all(m).then(function(){if(o||f||!g.length)S.resolve(g);else{for(var e=0;g[e]&&"directory"===g[e].type;)e++;S.resolve([g[e]])}},function(e){S.reject(e)}),S.promise}var v=t(),y=function(e,t,r){return s.attrGetter(e,n,t,r)};if(y("dropAvailable")&&a(function(){e[y("dropAvailable")]?e[y("dropAvailable")].value=v:e[y("dropAvailable")]=v}),!v)return void(y("ngfHideOnDropNotAvailable",e)===!0&&r.css("display","none"));null==y("ngfSelect")&&s.registerModelChangeValidator(i,n,e);var b,$=null,U=o(y("ngfStopPropagation")),S=1;r[0].addEventListener("dragover",function(t){if(!d()&&s.shouldUpdateOn("drop",n,e)){if(t.preventDefault(),U(e)&&t.stopPropagation(),navigator.userAgent.indexOf("Chrome")>-1){var i=t.dataTransfer.effectAllowed;t.dataTransfer.dropEffect="move"===i||"linkMove"===i?"move":"copy"}a.cancel($),b||(b="C",m(e,n,t,function(n){b=n,r.addClass(b),y("ngfDrag",e,{$isDragging:!0,$class:b,$event:t})}))}},!1),r[0].addEventListener("dragenter",function(t){!d()&&s.shouldUpdateOn("drop",n,e)&&(t.preventDefault(),U(e)&&t.stopPropagation())},!1),r[0].addEventListener("dragleave",function(t){!d()&&s.shouldUpdateOn("drop",n,e)&&(t.preventDefault(),
U(e)&&t.stopPropagation(),$=a(function(){b&&r.removeClass(b),b=null,y("ngfDrag",e,{$isDragging:!1,$event:t})},S||100))},!1),r[0].addEventListener("drop",function(t){!d()&&s.shouldUpdateOn("drop",n,e)&&(t.preventDefault(),U(e)&&t.stopPropagation(),b&&r.removeClass(b),b=null,f(t.dataTransfer,t,"dropUrl"))},!1),r[0].addEventListener("paste",function(t){navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&y("ngfEnableFirefoxPaste",e)&&t.preventDefault(),!d()&&s.shouldUpdateOn("paste",n,e)&&f(t.clipboardData||t.originalEvent.clipboardData,t,"pasteUrl")},!1),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&y("ngfEnableFirefoxPaste",e)&&(r.attr("contenteditable",!0),r.on("keypress",function(e){e.metaKey||e.ctrlKey||e.preventDefault()}))}function t(){var e=document.createElement("div");return"draggable"in e&&"ondrop"in e&&!/Edge\/12./i.test(navigator.userAgent)}ngFileUpload.directive("ngfDrop",["$parse","$timeout","$window","Upload","$http","$q",function(t,r,n,i,o,a){return{restrict:"AEC",require:"?ngModel",link:function(u,s,l,c){e(u,s,l,c,t,r,n,i,o,a)}}}]),ngFileUpload.directive("ngfNoFileDrop",function(){return function(e,r){t()&&r.css("display","none")}}),ngFileUpload.directive("ngfDropAvailable",["$parse","$timeout","Upload",function(e,r,n){return function(i,o,a){if(t()){var u=e(n.attrGetter("ngfDropAvailable",a));r(function(){u(i),u.assign&&u.assign(i,!0)})}}}])}(),ngFileUpload.service("UploadExif",["UploadResize","$q",function(e,t){function r(e,t,r,n){switch(t){case 2:return e.transform(-1,0,0,1,r,0);case 3:return e.transform(-1,0,0,-1,r,n);case 4:return e.transform(1,0,0,-1,0,n);case 5:return e.transform(0,1,1,0,0,0);case 6:return e.transform(0,1,-1,0,n,0);case 7:return e.transform(0,-1,-1,0,n,r);case 8:return e.transform(0,-1,1,0,0,r)}}function n(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return window.btoa(t)}var i=e;return i.isExifSupported=function(){return window.FileReader&&(new FileReader).readAsArrayBuffer&&i.isResizeSupported()},i.readOrientation=function(e){var r=t.defer(),n=new FileReader,i=e.slice?e.slice(0,65536):e;return n.readAsArrayBuffer(i),n.onerror=function(e){return r.reject(e)},n.onload=function(e){var t={orientation:1},n=new DataView(this.result);if(65496!==n.getUint16(0,!1))return r.resolve(t);for(var i=n.byteLength,o=2;o<i;){var a=n.getUint16(o,!1);if(o+=2,65505===a){if(1165519206!==n.getUint32(o+=2,!1))return r.resolve(t);var u=18761===n.getUint16(o+=6,!1);o+=n.getUint32(o+4,u);var s=n.getUint16(o,u);o+=2;for(var l=0;l<s;l++)if(274===n.getUint16(o+12*l,u)){var c=n.getUint16(o+12*l+8,u);return c>=2&&c<=8&&(n.setUint16(o+12*l+8,1,u),t.fixedArrayBuffer=e.target.result),t.orientation=c,r.resolve(t)}}else{if(65280!==(65280&a))break;o+=n.getUint16(o,!1)}}return r.resolve(t)},r.promise},i.applyExifRotation=function(e){if(0!==e.type.indexOf("image/jpeg"))return i.emptyPromise(e);var o=t.defer();return i.readOrientation(e).then(function(t){return t.orientation<2||t.orientation>8?o.resolve(e):void i.dataUrl(e,!0).then(function(a){var u=document.createElement("canvas"),s=document.createElement("img");s.onload=function(){try{u.width=t.orientation>4?s.height:s.width,u.height=t.orientation>4?s.width:s.height;var a=u.getContext("2d");r(a,t.orientation,s.width,s.height),a.drawImage(s,0,0);var l=u.toDataURL(e.type||"image/WebP",.934);l=i.restoreExif(n(t.fixedArrayBuffer),l);var c=i.dataUrltoBlob(l,e.name);o.resolve(c)}catch(d){return o.reject(d)}},s.onerror=function(){o.reject()},s.src=a},function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise},i.restoreExif=function(e,t){var r={};return r.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r.encode64=function(e){var t,r,n,i,o,a="",u="",s="",l=0;do t=e[l++],r=e[l++],u=e[l++],n=t>>2,i=(3&t)<<4|r>>4,o=(15&r)<<2|u>>6,s=63&u,isNaN(r)?o=s=64:isNaN(u)&&(s=64),a=a+this.KEY_STR.charAt(n)+this.KEY_STR.charAt(i)+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(s),t=r=u="",n=i=o=s="";while(l<e.length);return a},r.restore=function(e,t){e.match("data:image/jpeg;base64,")&&(e=e.replace("data:image/jpeg;base64,",""));var r=this.decode64(e),n=this.slice2Segments(r),i=this.exifManipulation(t,n);return"data:image/jpeg;base64,"+this.encode64(i)},r.exifManipulation=function(e,t){var r=this.getExifArray(t),n=this.insertExif(e,r);return new Uint8Array(n)},r.getExifArray=function(e){for(var t,r=0;r<e.length;r++)if(t=e[r],255===t[0]&225===t[1])return t;return[]},r.insertExif=function(e,t){var r=e.replace("data:image/jpeg;base64,",""),n=this.decode64(r),i=n.indexOf(255,3),o=n.slice(0,i),a=n.slice(i),u=o;return u=u.concat(t),u=u.concat(a)},r.slice2Segments=function(e){for(var t=0,r=[];;){if(255===e[t]&218===e[t+1])break;if(255===e[t]&216===e[t+1])t+=2;else{var n=256*e[t+2]+e[t+3],i=t+n+2,o=e.slice(t,i);r.push(o),t=i}if(t>e.length)break}return r},r.decode64=function(e){var t,r,n,i,o,a="",u="",s=0,l=[],c=/[^A-Za-z0-9\+\/\=]/g;c.exec(e)&&console.log("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, NaNExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=this.KEY_STR.indexOf(e.charAt(s++)),i=this.KEY_STR.indexOf(e.charAt(s++)),o=this.KEY_STR.indexOf(e.charAt(s++)),u=this.KEY_STR.indexOf(e.charAt(s++)),t=n<<2|i>>4,r=(15&i)<<4|o>>2,a=(3&o)<<6|u,l.push(t),64!==o&&l.push(r),64!==u&&l.push(a),t=r=a="",n=i=o=u="";while(s<e.length);return l},r.restore(e,t)},i}]),window.Util=function(){"use strict";function e(e,t,r){return t(e.user?function(t){t(e.user)}:function(t){r.currentUser().then(function(r){e.user=r,t(r)},function(r){"no-auth"===r?(e.setStateAfterLogin(),e.$state.go("login")):e.$state.go("error"),t(null)})})}function t(t,r,n){return e(t,r,n).then(function(e){return Util.isEmpty(e)||e.admin?e:(console.log("unauthorized access"),t.$state.go("error"),null)})}function r(e){return e.line1===d.line1&&e.city===d.city&&e.state===d.state&&e.zip===d.zip}function n(e){return e.line1===f.line1&&e.city===f.city&&e.state===f.state&&e.zip===f.zip}function i(e,t,r){var n=$("#errorModal");n.find(".modal-body").html(e),n.find(".modal-title").text(t||"Error"),n.find(".modal-header").removeClass("bg-danger"),n.find(".modal-header").removeClass("bg-success"),n.find(".modal-title").removeClass("text-success"),n.find(".modal-title").removeClass("text-"),"success"===r?(n.find(".modal-header").addClass("bg-success"),n.find(".modal-title").addClass("text-success")):"error"===r&&(n.find(".modal-header").addClass("bg-danger"),n.find(".modal-title").addClass("text-danger")),n.modal("show")}function o(e,t,r){var n=document.createElement("a");if(navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([e],{type:t}),r);if("download"in n)return n.href="data:"+t+","+encodeURIComponent(e),n.setAttribute("download",r),document.body.appendChild(n),n.click(),document.body.removeChild(n),!0;var i=document.createElement("iframe");return document.body.appendChild(i),i.src="data:"+t+","+encodeURIComponent(e),setTimeout(function(){document.body.removeChild(i)},333),!0}function a(e){return void 0===e||null===e||""===e}function u(e,t){if(0!==e.indexOf("http")){var r=t?"https://":"http://";return r+e}return e}function s(){return"ontouchstart"in window||navigator.maxTouchPoints}function l(){return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}function c(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var d={line1:"2695 Creve Coeur Mill Rd",city:"Maryland Heights",state:"MO",zip:63043},f={line1:"4701 State Route 111",city:"Granite City",state:"IL",zip:62040};return{authenticate:["$rootScope","$q","graceGroupsService",e],authenticateAdmin:["$rootScope","$q","graceGroupsService",t],graceWestAddress:d,graceEastAddress:f,isGraceWestCampus:r,isGraceEastCampus:n,alert:i,downloadContent:o,isEmpty:a,externalUrl:u,isTouchDevice:s,genGuid:l}}(),angular.module("angularPromiseButtons",[]),angular.module("angularPromiseButtons").directive("promiseBtn",["angularPromiseButtons","$parse","$timeout","$compile",function(e,t,r,n){"use strict";return{restrict:"EA",priority:e.config.priority,scope:{promiseBtn:"=",promiseBtnOptions:"=?"},link:function(i,o,a){function u(e){console.log("in init loading state"),b.btnLoadingClass&&!b.addClassToCurrentBtnOnly&&e.addClass(b.btnLoadingClass),b.disableBtn&&!b.disableCurrentBtnOnly&&e.attr("disabled","disabled")}function s(e){b.minDuration&&!v||!y||(b.btnLoadingClass&&e.removeClass(b.btnLoadingClass),b.disableBtn&&e.removeAttr("disabled"))}function l(e,t){i.$watch(e,function(e){v=!1,y=!1,b.minDuration&&(h=r(function(){v=!0,s(t)},b.minDuration)),e&&e.then?(u(t),e["finally"](function(){y=!0,s(t)})):e&&e.$promise&&(u(t),e.$promise["finally"](function(){y=!0,s(t)}))})}function c(e){return e.split(";").map(function(e){return t(e)})}function d(e){e.append(n(b.spinnerTpl)(i))}function f(e){b.addClassToCurrentBtnOnly&&e.on(b.CLICK_EVENT,function(){e.addClass(b.btnLoadingClass)}),b.disableCurrentBtnOnly&&e.on(b.CLICK_EVENT,function(){e.attr("disabled","disabled")})}function g(e,t,r){i.$evalAsync(function(){var n=c(a[t]);o.unbind(e),o.bind(e,function(){i.$apply(function(){n.forEach(function(t){var n=t(i.$parent,{$event:e});m||(m=l(function(){return n},r))})})})})}function p(e){for(var t=[],r=e.find("button"),n=0;n<r.length;n++){var i=r[n];"submit"===angular.element(i).attr("type")&&t.push(i)}return angular.element(t)}console.log("in link");var m,h,v,y,b=e.config;if(a.promiseBtn)console.log("specific promise"),d(o),f(o),l(function(){return i.promiseBtn},o);else if(console.log("no specific promise"),a.hasOwnProperty(b.CLICK_ATTR))d(o),f(o),g(b.CLICK_EVENT,b.CLICK_ATTR,o);else if(a.hasOwnProperty(b.SUBMIT_ATTR)){var $=p(o);d($),f($),g(b.SUBMIT_EVENT,b.SUBMIT_ATTR,$)}i.$watch("promiseBtnOptions",function(e){angular.isObject(e)&&(b=angular.extend({},b,e))},!0),i.$on("$destroy",function(){r.cancel(h)})}}}]),angular.module("angularPromiseButtons").provider("angularPromiseButtons",function(){"use strict";var e={spinnerTpl:'<span class="btn-spinner"></span>',priority:0,disableBtn:!0,btnLoadingClass:"is-loading",addClassToCurrentBtnOnly:!1,disableCurrentBtnOnly:!1,minDuration:!1,CLICK_EVENT:"click",CLICK_ATTR:"ngClick",SUBMIT_EVENT:"submit",SUBMIT_ATTR:"ngSubmit"};return{extendConfig:function(t){e=angular.extend(e,t)},$get:function(){return{config:e}}}}),function(e){"use strict";function t(e,t,r,n,i){i&&"https"!==r.protocol()&&(n.location.href=r.absUrl().replace("http","https"));var o=this;o.email="",o.password="",o.login=function(){t.login({email:o.email,password:o.password}).then(function(t){e.user=t,e.goToStateAfterLoginOr("users.home")},function(t){e.user=null,"invalid-login"===t?o.invalidLogin=!0:Util.alert("Login failed. Please try again.")})}}function r(e,t,r,n){var i=this;i.logout=function(){e.logout(),t.user=null,r.go("login")},i.isProfilePage=function(){return r.includes("users.home")||r.includes("users.details")&&t.user&&t.user.id===n.id}}function n(e,t,r){function n(e){return void 0!==e&&null!==e&&""!==e.trim()}return e.filter(function(e){var i=!n(t)||e.firstName.toLowerCase().indexOf(t.toLowerCase())>=0,o=!n(r)||e.lastName.toLowerCase().indexOf(r.toLowerCase())>=0;return i&&o})}e.module("grace-groups",["gg.common","groups","graceGroupsService","authorizer"]),e.module("grace-groups-admin",["ngFileUpload","gg.common","ui.router","users","groups","meetingReports","graceGroupsService","authorizer","ngConstants"]).config(["$stateProvider","$urlRouterProvider","partialPath",function(e,r,n){r.otherwise("/users/home"),e.state("login",{url:"/login",templateUrl:n+"/login-form.html",controller:["$rootScope","graceGroupsService","$location","$window","secureCookies",t],controllerAs:"$ctrl"}).state("error",{templateUrl:n+"/error.html"})}]).run(["$rootScope","$state","$stateParams","authorizer",function(e,t,r,n){e.$state=t,e.$stateParams=r,e.authorizer=n,e.$on("$stateChangeError",function(e,r,n,i,o,a){e.preventDefault(),console.log("something went wrong - ",a),t.go("error")}),e.$on("$stateChangeSuccess",function(){var e=$(".navbar-toggle");e.hasClass("collapsed")||e.click()}),e.$on("$stateChangeStart",function(t,r,n){console.log("state change start",r),e.requestedState={name:r.name,params:$.extend({},n)}}),e.setGroupEditReturnToState=function(){e.groupEditReturnToState={name:t.current.name,params:$.extend({},r)}},e.goToGroupEditReturnToState=function(){void 0!==e.groupEditReturnToState?t.go(e.groupEditReturnToState.name,e.groupEditReturnToState.params):t.go("groups.index"),e.groupEditReturnToState=void 0},e.setUserEditReturnToState=function(){e.userEditReturnToState={name:t.current.name,params:$.extend({},r)}},e.goToUserEditReturnToState=function(){void 0!==e.userEditReturnToState?t.go(e.userEditReturnToState.name,e.userEditReturnToState.params):t.go("users.home"),e.userEditReturnToState=void 0},e.setGroupMemberReturnToState=function(){e.groupMemberReturnToState={name:t.current.name,params:$.extend({},r)}},e.goToGroupMemberReturnToState=function(){void 0!==e.groupMemberReturnToState?t.go(e.groupMemberReturnToState.name,e.groupMemberReturnToState.params):t.go("groups.index"),e.groupMemberReturnToState=void 0},e.setStateAfterLogin=function(){e.stateAfterLogin=e.requestedState},e.goToStateAfterLoginOr=function(r){console.log("state after login",e.stateAfterLogin),void 0!==e.stateAfterLogin?(t.go(e.stateAfterLogin.name,e.stateAfterLogin.params),e.stateAfterLogin=void 0):t.go(r)},e.hasError=function(e){return console.log("does it have an error",e.$invalid),!1}}]).component("ggNav",{templateUrl:["partialPath",function(e){return e+"/nav.html"}],controller:["graceGroupsService","$rootScope","$state","$stateParams",r]}).directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(e,t,r,n){n.$validators.compareTo=function(t){return t===e.otherModelValue},e.$watch("otherModelValue",function(){n.$validate()})}}}).directive("notEqualTo",function(){return{require:"ngModel",scope:{otherModelValue:"=notEqualTo"},link:function(e,t,r,n){n.$validators.notEqualTo=function(t){return void 0===t||""===t||t!==e.otherModelValue},e.$watch("otherModelValue",function(){n.$validate()})}}}).directive("timeAfter",function(){return{require:"ngModel",scope:{otherModelValue:"=timeAfter"},link:function(e,t,r,n){n.$validators.timeAfter=function(t){return!!Util.isEmpty(e.otherModelValue)||moment(t).isSameOrAfter(moment(e.otherModelValue))},e.$watch("otherModelValue",function(){n.$validate()})}}}).directive("requiredIfNotOther",function(){return{require:"ngModel",scope:{otherModelValue:"=requiredIfNotOther"},link:function(e,t,r,n){n.$validators.requiredIfNotOther=function(t){return!(Util.isEmpty(e.otherModelValue)&&Util.isEmpty(t))},e.$watch("otherModelValue",function(){n.$validate()})}}}).directive("serverValidation",function(){return{require:"ngModel",link:function(e,t,r,n){n.$validators.serverValidation=function(){return!0}}}}).filter("filterByUserName",function(){return n}).filter("hasError",function(){return hasError}).directive("scrollPos",["$state","$window","$timeout","$location","$anchorScroll",function(e,t,r,n,i){var o={};return function(a,u,s){a.$on("$stateChangeStart",function(){"keep"===s.scrollPos&&e.current&&(console.log(e.current.templateUrl),o[e.current.templateUrl]=[t.pageXOffset,t.pageYOffset])}),a.$on("$stateChangeSuccess",function(){if(n.hash())i();else{var a=o[e.current.templateUrl]||[0,0];r(function(){t.scrollTo(a[0],a[1])},100)}})}}])}(window.angular),function(e){"use strict";function t(e,t){var r=t.find(".modal");e.noLabel=e.noLabel||"Cancel",e.yesLabel=e.yesLabel||"Yes",e.modalId=e.modalId||"confirm",e.yesClick=function(){console.log("clicked yes"),r.off("hidden.bs.modal").on("hidden.bs.modal",function(){e.onYes()}),r.modal("hide")},e.noClick=function(){console.log("clicked no"),r.off("hidden.bs.modal").on("hidden.bs.modal",function(){e.onNo()}),r.modal("hide")}}function r(e,t){function r(){e.imageFile=null,e.invalid=null,e.clearImage=!1,e.$apply()}var n=t.find(".modal");n.on("show.bs.modal",r),e.unsupported="undefined"==typeof window.FormData,e.modalId=e.modalId||"image-chooser",e.saveClick=function(){e.clearImage?n.off("hidden.bs.modal").on("hidden.bs.modal",function(){e.onClearImage()}):n.off("hidden.bs.modal").on("hidden.bs.modal",function(){e.onSaveImage({file:e.imageFile})}),n.modal("hide")},e.none=function(){e.clearImage=!0,e.imageFile=null},e.selected=function(){e.clearImage=!1}}function n(e){return"GRACE_HAVE_ROOM"===e?"Grace, room assigned":"GRACE_NEED_ROOM"===e?"Grace, need room":"CHILDCARE_PROVIDED"===e?"Provided":"SINGLES_AND_COUPLES"===e?"Mixed single and married":"MARRIEDS"===e?"Married":"SINGLES"===e?"Single":S(e).humanize().s}e.module("gg.common",["ngConstants","ui.router","users"]).filter("enumToLabel",function(){return n}).filter("leaderMailTo",function(){return function(e,t){return"mailto:"+e.leader.email+"?"+(Util.isEmpty(e.secondaryLeader)?"":"cc="+e.secondaryLeader.email+"&")+"subject="+t}}).filter("mailToAll",function(){return function(e,t){if(e&&e.length>0){var r=e.filter(function(e){return!Util.isEmpty(e.email)}).map(function(e){return e.email});if(r.length>0){var n="mailto:"+r.join(";")+"?subject="+(t||"");return console.log("mailto link",n),n}}}}).filter("orDefaultImage",["imagesPath",function(e){return function(t){return Util.isEmpty(t)?e+"/noImage.png":t}}]).directive("confirmBox",["partialPath",function(e){return{restrict:"E",scope:{title:"@",noLabel:"@",yesLabel:"@",onNo:"&",onYes:"&",modalId:"@"},templateUrl:e+"/confirm.html",transclude:!0,link:t}}]).component("auditInfo",{templateUrl:["partialPath",function(e){return e+"/audit-info.html"}],bindings:{model:"<"}}).directive("imageChooser",["partialPath",function(e){return{restrict:"E",scope:{title:"@",onClearImage:"&",onSaveImage:"&",modalId:"@",currentImage:"="},templateUrl:e+"/image-chooser.html",link:r}}])}(window.angular),function(e){"use strict";function t(e,t,r,n,i){function o(t){t=t&&t>0?t:1;var r=t*n;a.page=t-1;var i=e.usersByName(a.searchFirstNameText||"",a.searchLastNameText||"",0,r).then(function(e){a.users=e,a.isFiltered=a.searchFirstNameText&&""!==a.searchFirstNameText||a.searchLastNameText&&""!==a.searchLastNameText});return e.countUsersByName(a.searchFirstNameText||"",a.searchLastNameText||"").then(function(e){a.totalCount=e}),i}var a=this;a.users=t,a.totalCount=r,a.isFiltered=!1,a.page=0,i.setUserEditReturnToState(),a.search=function(){return o()},a.showMore=function(){return a.page++,e.usersByName(a.searchFirstNameText||"",a.searchLastNameText||"",a.page,n).then(function(e){Array.prototype.push.apply(a.users,e)})},a.showMoreCount=function(){var e=a.totalCount-a.users.length;return e>n?n:e},a.clearSearch=function(){a.searchFirstNameText="",a.searchLastNameText="",a.search()},a.noUsers=function(){return 0===a.users.length},a.deleteUser=function(t){e.deleteUser(t).then(function(){o(a.page+1)},function(e){console.log(e);var t=[];e.indexOf("user-in-groups-not-deletable")>=0&&t.push("The user is associated to one or more groups."),e.indexOf("user-as-manager-not-deletable")>=0&&(t.push("The user is the manager of one or more users."),Util.alert("The user cannot be deleted because it either contains direct reports or has group associations. Please remove all associations first.")),console.log("can't remove reasons",t),t.length>0?Util.alert(t.join("<br/>"),"The user cannot be deleted"):Util.alert("Failed to delete the user. Please try again later.")})}}function r(e){var t=this;t.deleteIcon=t.deleteIcon||"trash",t.guid=Util.genGuid(),t.uploadImage=function(r){e.uploadUserImage(t.user.id,r).then(function(e){t.user.imageUrl=e.imageUrl},function(e){e.indexOf("invalid-image-file")>=0?Util.alert("Could not save the image. Invalid file type.","Invalid image"):Util.alert("Failed to save the image. Please try again later.")})},t.clearImage=function(){var r=t.user.imageUrl;t.user.imageUrl=null,e.updateUser(t.user).then(null,function(e){console.log(e),t.user.imageUrl=r,Util.alert("Failed to clear the image for this user. Please try again later.")})},t.createdInfo=function(){if(t.user.auditInfo){var e="Created by ";return e+=t.user.auditInfo.createdBy?t.user.auditInfo.createdBy.fullName():"UNKNOWN",e+=" on "+(t.user.auditInfo.createdAt||"UNKNOWN")}return""},t.updatedInfo=function(){if(t.user.auditInfo){var e="Last updated by ";return e+=t.user.auditInfo.updatedBy?t.user.auditInfo.updatedBy.fullName():"UNKNOWN",e+=" on "+(t.user.auditInfo.updatedAt||"UNKNOWN")}return""}}function n(e,t,r){function n(e,t){var r=!1;t.forEach&&t.forEach(function(t){"user-email-not-unique"===t&&(e.uEmail.$error.serverValidation=!0,e.uEmail.$error.serverError="already used",r=!0),"user-role-change-conflict-with-groups"===t?(e.uRole.$error.serverValidation=!0,e.uRole.$error.serverError="This role is not applicable as a leader of one or more groups.",r=!0):"user-role-reduction-conflict"===t&&(e.uRole.$error.serverValidation=!0,e.uRole.$error.serverError="This role is not applicable for current direct reports.",r=!0),"facebook-link-invalid"===t&&(e.uFacebookLink.$error.serverValidation=!0,e.uFacebookLink.$error.serverError="Not recognized as a valid facebook URL",r=!0)}),r?Util.alert("Please correct errors indicated in red.","Info"):Util.alert("Failed to save the user. Please try again later.")}var i=this;i.managers=i.managers||[],i.availableManagers=[],i.roles=r.rolesAssignableBy(e.user,e.user.id===i.user.id),1===i.roles.length&&(i.user.role=i.roles[0].code),i.noPreviousPassword="CONTACT"===i.user.role,i.handleRoleChange=function(){"ADMIN"!==i.user.role&&"PASTOR"!==i.user.role||(i.user.admin=!0),i.determineAvailableManagers()},i.determineAvailableManagers=function(){var e=[];switch(i.user.role){case"CONTACT":case"GROUP_LEADER":e.push("DIVISION_LEADER");case"DIVISION_LEADER":e.push("DIVISION_DIRECTOR");case"DIVISION_DIRECTOR":e.push("PASTOR")}i.availableManagers=i.managers.filter(function(t){return e.indexOf(t.role)>=0&&t.id!==i.user.id}),0===i.availableManagers.filter(function(e){return e.id===i.user.managerId}).length&&(i.user.managerId=null)},i.determineAvailableManagers(),i.isNew=null===i.user.id||void 0===i.user.id,(i.isNew||i.startWithChangePassword)&&"CONTACT"!==i.user.role&&(i.changePassword=!0),i.needsManager=function(){return"PASTOR"!==i.user.role&&"CONTACT"!==i.user.role&&"ADMIN"!==i.user.role},i.save=function(e){if(e.$valid)return Util.isEmpty(i.user.id)?t.createUser(i.user).then(function(e){i.user.id=e.id,i.onSave()},function(t){n(e,t)}):t.updateUser(i.user).then(i.onSave,function(t){n(e,t)});var r=$(".has-error:first");return r.length>0&&$("html, body").animate({scrollTop:r.offset().top},500),Util.alert("Please correct errors indicated in red.","Info"),null}}function i(e,t,r,n,i){var o=this;o.changePassword=i,o.user=e,o.managers=t,o.cancel=function(){r.goToUserEditReturnToState()},o.afterSave=function(){o.isRootUser()&&!Util.isEmpty(o.user.newPassword)?n.login({email:o.user.email,password:o.user.newPassword}).then(function(e){r.user=e,r.goToUserEditReturnToState()},function(){r.user=null,r.$state.go("login")}):r.goToUserEditReturnToState()},o.isRootUser=function(){return o.user.id===r.user.id}}function o(e,t,r,n,i,o,a){var u=this;u.user=e,u.groups=r,u.directReports=n,u.showGroups="groups"===a,u.showDirectReports="direct-reports"===a,i.setUserEditReturnToState(),i.setGroupEditReturnToState(),i.setGroupMemberReturnToState(),u.isRootUser=function(){return u.user.id===t.id},u.deleteGroup=function(e){o.deleteGroup(e).then(function(){u.groups.splice(u.groups.indexOf(e),1)})}}function a(e){var t=this;t.user={},t.managers=e}e.module("users",["ui.router","angularPromiseButtons","ngConstants"]).config(["$stateProvider","partialPath",function(e,r){e.state("users",{url:"/users","abstract":!0,template:"<ui-view></ui-view>",resolve:{authUser:Util.authenticate}}).state("users.index",{url:"",templateUrl:r+"/users/index.html",resolve:{limit:function(){return 10},users:["graceGroupsService","limit",function(e,t){return e.usersByName("","",0,t)}],totalCount:["graceGroupsService",function(e){return e.countUsersByName("","")}]},controller:["graceGroupsService","users","totalCount","limit","$rootScope",t],controllerAs:"$ctrl"}).state("users.edit",{url:"/{id:int}/edit",templateUrl:r+"/users/edit.html",resolve:{user:["graceGroupsService","$stateParams","authUser",function(e,t){return e.user(t.id)}],managers:["graceGroupsService","authUser",function(e){return e.managers()}]},controller:["user","managers","$rootScope","graceGroupsService",i],controllerAs:"$ctrl"}).state("users.editAndChangePassword",{url:"/{id:int}/editAndChangePassword",templateUrl:r+"/users/edit.html",resolve:{user:["graceGroupsService","$stateParams","authUser",function(e,t){return e.user(t.id)}],managers:["graceGroupsService","authUser",function(e){return e.managers()}],changePassword:function(){return!0}},controller:["user","managers","$rootScope","graceGroupsService","changePassword",i],controllerAs:"$ctrl"}).state("users.details",{url:"/{id:int}/details",templateUrl:r+"/users/details.html",resolve:{user:["graceGroupsService","$stateParams",function(e,t){return e.user(t.id)}],groups:["graceGroupsService","$stateParams",function(e,t){return e.groupsForUser(t.id)}],directReports:["graceGroupsService","$stateParams",function(e,t){return e.directReports(t.id)}],show:["$stateParams",function(e){return e.show}]},controller:["user","authUser","groups","directReports","$rootScope","graceGroupsService","show",o],controllerAs:"$ctrl"}).state("users.home",{url:"/home",templateUrl:r+"/users/details.html",resolve:{user:["graceGroupsService","authUser",function(e,t){return e.user(t.id)}],groups:["graceGroupsService","authUser",function(e,t){return e.groupsForUser(t.id)}],directReports:["graceGroupsService","authUser",function(e,t){return e.directReports(t.id)}]},controller:["user","authUser","groups","directReports","$rootScope","graceGroupsService",o],controllerAs:"$ctrl"}).state("users.new",{url:"/new",templateUrl:r+"/users/new.html",resolve:{managers:["graceGroupsService",function(e){return e.managers()}]},controller:["managers",a],controllerAs:"$ctrl"})}]).component("ggUser",{templateUrl:["partialPath",function(e){return e+"/users/view.html"}],bindings:{user:"<",hideRole:"@",onEdit:"&",showEdit:"<",onSelect:"&",showSelect:"<",onRemove:"&",showRemove:"<",confirmRemove:"<",badge:"<",deleteIcon:"@",highlight:"@",allowImageSelect:"<",compact:"<",noBorder:"<"},controller:["graceGroupsService",r]}).component("ggUserForm",{templateUrl:["partialPath",function(e){return e+"/users/userForm.html"}],bindings:{user:"<",onSave:"&",onCancel:"&",noRoleChange:"@",managers:"<",startWithChangePassword:"<"},controller:["$rootScope","graceGroupsService","authorizer",n]})}(window.angular),function(e){"use strict";function t(e,t){var r=this;e.setGroupEditReturnToState(),e.setGroupMemberReturnToState(),r.download=function(){t.groupExport().then(function(e){Util.downloadContent(e,"text/csv","groups.csv")},function(){Util.alert("Failed to download the groups. Please try again later.")})}}function r(e,t,r){var n=this;n.indicateIfPublic=!!t.user,n.leaderDisplay=function(){return p(n.group)},n.scheduleDisplay=function(){return m(n.group.schedule)},n.timeDisplay=function(){return v(n.group.schedule)},n.ageDisplay=function(){return y(n.group)},n.onGraceWestCampus=function(){return Util.isGraceWestCampus(n.group.address)},n.onGraceEastCampus=function(){return Util.isGraceEastCampus(n.group.address)},n.downloadCalendar=function(){var r=Util.isEmpty(t.user)?e.publishedGroupCalendarExport:e.groupCalendarExport;r.call(this,n.group.id).then(function(e){Util.downloadContent(e,"text/calendar","group-calendar.ics")},function(){Util.alert("Failed to download the group calendar. Please try again later.")})},n.$onInit=function(){r.find('[data-toggle="tooltip"]').tooltip({trigger:"hover"}),r.find('[data-toggle="tooltip"]').on("show.bs.tooltip",function(e){Util.isTouchDevice()&&e.preventDefault()})},n.showStreetAddress=function(){return t.user||n.onGraceWestCampus()||n.onGraceEastCampus()},n.groupName=function(){return n.group.namePending&&Util.isEmpty(t.user)?"Group":n.group.name}}function n(e,t){function r(e){e=e&&e>0?e:1,a.searchCriteria.limit=e*a.resultLimit,a.searchCriteria.page=0,a.searchCriteria.startTimeDate?a.searchCriteria.startTime=moment(a.searchCriteria.startTimeDate).format("HH:mm"):delete a.searchCriteria.startTime,"ALL"===a.ageType&&delete a.searchCriteria.age,a.loading=!0;var t=a.groups=u.call(this,a.searchCriteria).then(function(t){a.groups=t,a.isFiltered=n(a.searchCriteria),a.searchCriteria.page=e-1,a.loading=!1});return s.call(this,a.searchCriteria).then(function(e){a.totalCount=e}),a.showCriteria&&(a.showCriteria=!1,$("#search-container").collapse("hide")),t}function n(e){for(var t=["category","keyWord","dayOfWeek","startTimeDate","gender","status","age","childcare","onCampus"],r=0;r<t.length;r++)if(e[t[r]]&&""!==e[t[r]])return!0;return!1}function i(){a.searchCriteria={limit:a.resultLimit,page:0,category:o(a.categoryCriteria,["ACTIVITY_GROUP","CLASS","COMMUNITY_GROUP","PRAYER_GROUP","SERVING_GROUP","SUPPORT_RECOVERY_GROUP"]),keyWord:a.keyWordCriteria,dayOfWeek:o(a.dayOfWeekCriteria,["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"]),gender:o(a.genderCriteria,["MALE","FEMALE","BOTH"]),status:o(a.statusCriteria,["SINGLES","MARRIEDS","MARRIED_AND_COUPLES","SINGLES_AND_COUPLES"]),childcare:o(a.childcareCriteria,["GRACE_KIDS_OPEN","CHILDCARE_PROVIDED","CHILDREN_WELCOME","CHILDCARE_NOT_AVAILABLE"]),onCampus:"true"===a.onCampusCriteria},a.startTimeCriteria&&a.startTimeCriteria.match(/\d\d:\d\d/)&&(a.searchCriteria.startTimeDate=moment(a.startTimeCriteria,"HH:mm").toDate()),a.ageCriteria&&a.ageCriteria.match(/\d+/)?(a.searchCriteria.age=parseInt(a.ageCriteria),a.ageType="SPECIFIC"):a.ageType="ALL"}function o(e,t){return e&&t.indexOf(e.toUpperCase())>=0?e.toUpperCase():null}var a=this,u=t.user?e.groupSearch:e.publishedGroupSearch,s=t.user?e.groupCount:e.publishedGroupCount;a.resultLimit=a.limit||10,a.showCriteria=!1,a.isFiltered=!1,i(),a.search=function(){return r()},a.showMore=function(){return a.searchCriteria.page++,u.call(this,a.searchCriteria).then(function(e){Array.prototype.push.apply(a.groups,e)})},a.showMoreCount=function(){if(a.groups&&a.totalCount){var e=a.totalCount-a.groups.length;return e>a.resultLimit?a.resultLimit:e}return 0},a.clear=function(){i(null),a.search()},a.deleteGroup=function(t){e.deleteGroup(t).then(function(){r(a.searchCriteria.page+1)},function(){Util.alert("Failed to delete the group. Please try again later.")})},this.$onInit=function(){a.search()}}function i(){function e(){n.group.schedule.startTimeDate&&(n.group.schedule.startTime=moment(n.group.schedule.startTimeDate).format("HH:mm")),n.group.schedule.endTimeDate&&(n.group.schedule.endTime=moment(n.group.schedule.endTimeDate).format("HH:mm")),n.group.schedule.startDateDate&&(n.group.schedule.startDate=moment(n.group.schedule.startDateDate).format("YYYY-MM-DD")),n.group.schedule.endDateDate&&(n.group.schedule.endDate=moment(n.group.schedule.endDateDate).format("YYYY-MM-DD"))}function t(e){return"WEDNESDAY"===e.schedule.dayOfWeek&&("WEEKLY"===e.schedule.frequency||"EVERY_TWO_WEEKS"===e.schedule.frequency||"BI_MONTHLY_FIRST_THIRD"===e.schedule.frequency||"TRI_MONTHLY"===e.schedule.frequency||"MONTHLY_FIRST"===e.schedule.frequency)&&e.schedule.startTime&&e.schedule.endTime&&moment("2016-10-12T"+e.schedule.startTime).isBefore(moment("2016-10-12T20:00"))&&moment("2016-10-12T"+e.schedule.endTime).isAfter(moment("2016-10-12T19:00"))}function r(e){return"OTHER"!==e.locationType&&moment("2016-10-13T"+e.schedule.endTime).isAfter(moment("2016-10-13T23:00"))}var n=this;n.group.address||(n.group.address={}),n.group.schedule||(n.group.schedule={}),n.group.roomRequest||(n.group.roomRequest={}),n.group.schedule.startTime&&(n.group.schedule.startTimeDate=moment(n.group.schedule.startTime,"HH:mm").toDate()),n.group.schedule.endTime&&(n.group.schedule.endTimeDate=moment(n.group.schedule.endTime,"HH:mm").toDate()),n.group.schedule.startDate&&(n.group.schedule.startDateDate=moment(n.group.schedule.startDate,"YYYY-MM-DD").toDate()),
n.group.schedule.endDate&&(n.group.schedule.endDateDate=moment(n.group.schedule.endDate,"YYYY-MM-DD").toDate()),n.locationOnCampus=function(){return"GRACE_NEED_ROOM"===n.group.locationType||"GRACE_HAVE_ROOM"===n.group.locationType},n.requireScheduleTime=function(){return n.group&&"AS_NEEDED"!==n.group.schedule.frequency},n.charactersRemaining=function(e,t){return e-t.length},n.save=function(i){if(i.$valid)if("GRACE_NEED_ROOM"===n.group.locationType&&(n.group.address.room=null),e(),r(n.group))Util.alert("Sorry, the church is closed for meetings after 11pm. Please adjust your schedule.","Info"),$("html, body").animate({scrollTop:$("#schedule").offset().top},500);else{if(!t(n.group))return n.group.study&&(n.group.study=n.group.study.replace(/\n+/g," ")),n.onSave(n.group);Util.alert("Sorry, group meetings cannot occur at the same time as the communion service on first Wednesdays from 7pm to 8pm. Please adjust your schedule.","Info"),$("html, body").animate({scrollTop:$("#schedule").offset().top},500)}else{var o=$(".has-error:first");o.length>0&&$("html, body").animate({scrollTop:o.offset().top},500),Util.alert("Please correct errors indicated in red.","Info")}return null}}function o(e,t,r,n,i,o,a,u,s){function l(){o.meetingsByGroup(e.id,0,n*(c.meetingsPage+1)).then(function(e){c.meetings=e}),o.countMeetingsByGroup(e.id).then(function(e){i=e})}var c=this;c.group=e,c.members=t,c.meetings=r,c.meetingsPage=0,s.setGroupEditReturnToState(),c.$onInit=function(){u&&Util.alert(u.msg,u.title,u.type)},c.showMoreMeetings=function(){return c.meetingsPage++,o.meetingsByGroup(e.id,c.meetingsPage,n).then(function(e){Array.prototype.push.apply(c.meetings,e)})},c.showMoreMeetingsCount=function(){var e=i-c.meetings.length;return e>n?n:e},c.showMembers="members"===a,c.showMembers&&$("#members-panel-body").collapse("show"),c.showReports="reports"===a,c.showReports&&$("#reports-panel-body").collapse("show"),c.removeMember=function(e){o.removeGroupMember(c.group.id,e.id).then(function(){c.members.splice(c.members.indexOf(e),1)},function(){console.log("failed to remove the member - ",err),Util.alert("Failed to remove the member. Please try again later.")})},c.deleteMeetingReport=function(e){o.deleteMeeting(e).then(function(){l()},function(){Util.alert("Failed to delete the meeting report. Please try again later.")})}}function a(e,t,r,n,i){var o=this;o.group=r,o.leaders=n,o.divisionLeaders=i,o.updateGroup=function(){return t.updateGroup(o.group).then(function(){e.goToGroupEditReturnToState()},function(e){console.log("failed to update the group: "+e),Util.alert("Failed to save the group information. Please try again later.")})}}function u(e,t,r,n,i){var o=this;o.group={},o.leaders=r,o.divisionLeaders=n,e.authorizer.userCanCreateGroup(i)?"GROUP_LEADER"===i.role&&(o.group.leaderId=i.id,i.manager&&"DIVISION_LEADER"===i.manager.role&&(o.group.divisionLeaderId=i.managerId)):(console.log("unauthorized access"),e.$state.go("error")),o.createGroup=function(){return t.createGroup(o.group).then(function(){e.goToGroupEditReturnToState()},function(e){console.log("failed to create the group: "+e),Util.alert("Failed to create the group. Please try again later.")})}}function s(e,t,r,n){var i=this;i.group=t,i.members=r,i.removeMember=function(t){e.removeGroupMember(i.group.id,t.id).then(function(){i.members.splice(i.members.indexOf(t),1)},function(){console.log("failed to remove the member - ",err),Util.alert("Failed to remove the member. Please try again later.")})},i.backToLabel=function(){return!n.groupMemberReturnToState||"users.details"!==n.groupMemberReturnToState.name&&"users.home"!==n.groupMemberReturnToState.name?"groups":"user details"}}function l(e,t,r,n){function i(e,t){var r=!1;t.forEach&&t.forEach(function(t){"user-email-not-unique"===t&&(e.uEmail.$error.serverValidation=!0,e.uEmail.$error.serverError="already used",r=!0)}),r?Util.alert("Please correct errors indicated in red.","Info"):Util.alert("Failed to save the user. Please try again later.")}var o=this;o.newContact={role:"CONTACT"},o.users=[],o.totalCount=null,o.pageCount=0,o.group=t,o.nameChanged=function(){""===(o.newContact.firstName||"")&&""===(o.newContact.lastName||"")?(o.users=[],o.totalCount=null,o.pageCount=0):(e.usersByName(o.newContact.firstName||"",o.newContact.lastName||"",0,n).then(function(e){o.users=e,o.pageCount=1}),e.countUsersByName(o.newContact.firstName||"",o.newContact.lastName||"").then(function(e){o.totalCount=e}))},o.setCreateMode=function(e){o.createMode=e},o.showMore=function(){e.usersByName(o.newContact.firstName||"",o.newContact.lastName||"",o.pageCount++,n).then(function(e){Array.prototype.push.apply(o.users,e)})},o.showMoreCount=function(){var e=o.totalCount-o.users.length;return e>n?n:e},o.isMember=function(e){for(var t=0;t<r.length;t++){var n=r[t];if(n.id===e.id)return!0;if(n.lastName.toLocaleLowerCase()>e.lastName.toLocaleLowerCase())return!1}return!1},o.addMember=function(t){e.addGroupMember(o.group.id,t.id).then(function(){r.push(t),r.sort(g),Util.alert("The member has been added to the group","Success!")},function(e){console.log("failed to add the member - ",e),Util.alert("Failed to add the member. Please try again later.")})},o.saveAndAddMember=function(t){t.$valid?e.createUser(o.newContact).then(function(e){o.newContact.id=e.id,o.addMember(e),o.createMode=!1,o.newContact={}},function(e){i(t,e)}):Util.alert("Please correct errors indicated in red.","Info")}}function c(e,t,r,n){function i(){var t={msg:"Thank you! Your missed meeting has been reported successfully.",title:"Success",type:"success"};n.go("groups.details",{id:e.id,alert:t})}function o(){var t={msg:"Sorry, you are not authorized to report a missed meeting for this group.",title:"Unauthorized",type:"error"};n.go("groups.details",{id:e.id,alert:t})}function a(){var t={msg:"Sorry, your request to report a missed meeting is not valid.",title:"Error",type:"error"};n.go("groups.details",{id:e.id,alert:t})}function u(){var t={msg:"Sorry, your request to report a missed meeting has failed. Please try again later.",title:"Failure",type:"error"};n.go("groups.details",{id:e.id,alert:t})}var s=this;s.$onInit=function(){r.postNoMeeting(e.id,t).then(i,function(e){console.log(e),Array.isArray(e)?e.indexOf("unauthorized-update")>=0?o():e.indexOf("group-no-meeting-date-duplicate")>=0?i():e.indexOf("group-no-meeting-date-invalid")>=0?a():u():u()})}}function d(e){var t=this;t.groups=e,t.leaderDisplay=p,t.scheduleDisplay=m,t.timeDisplay=v}function f(e,t,r){var n=this;n.group=e,n.leaderDisplay=p,n.scheduleDisplay=m,n.timeDisplay=v,n.ageDisplay=y,n.approve=function(e){if(e.$valid)return t.approveGroup(n.group).then(function(){r.go("approvals.index")},function(e){console.log("failed to approve the group - ",e),Util.alert("Failed to approve the group. Please try again later.")});var i=$(".has-error:first");return i.length>0&&$("html, body").animate({scrollTop:i.offset().top},500),Util.alert("Please correct errors indicated in red.","Info"),null}}function g(e,t){return e.lastName.localeCompare(t.lastName)}function p(e){var t=e.leader.fullName();return e.secondaryLeader&&(t=t+" & "+e.secondaryLeader.fullName()),t}function m(e){if(Util.isEmpty(e))return"";switch(e.frequency){case"WEEKLY":return"Every "+h(e);case"EVERY_TWO_WEEKS":return"Every other "+h(e);case"BI_MONTHLY_FIRST_THIRD":return"Every 1st and 3rd "+h(e);case"BI_MONTHLY_SECOND_FOURTH":return"Every 2nd and 4th "+h(e);case"TRI_MONTHLY":return"Every 1st, 3rd, and 5th "+h(e);case"MONTHLY_FIRST":return"Every 1st "+h(e);case"MONTHLY_SECOND":return"Every 2nd "+h(e);case"MONTHLY_THIRD":return"Every 3rd "+h(e);case"MONTHLY_FOURTH":return"Every 4th "+h(e);case"AS_NEEDED":return h(e)+", as needed"}}function h(e){return S(e.dayOfWeek).capitalize().s}function v(e){return Util.isEmpty(e)?"":moment(e.startTime,"HH:mm").format("h:mma")+" to "+moment(e.endTime,"HH:mm").format("h:mma")}function y(e){if(e.studentMinistry)return"students";var t=e.minAge||18;return t<=18&&Util.isEmpty(e.maxAge)?"all adults":Util.isEmpty(e.maxAge)?t+" and older":t+" to "+e.maxAge}e.module("groups",["ui.router","users","ngConstants"]).config(["$stateProvider","partialPath",function(e,r){console.log("in config"),e.state("groups",{url:"/groups","abstract":!0,template:"<ui-view></ui-view>",resolve:{authUser:Util.authenticate}}).state("groups.index",{url:"",templateUrl:r+"/groups/index.html",controller:["$rootScope","graceGroupsService",t],controllerAs:"$ctrl"}).state("groups.details",{url:"/{id:int}/details?show",params:{alert:null},templateUrl:r+"/groups/details.html",resolve:{group:["graceGroupsService","$stateParams",function(e,t){return e.group(t.id)}],members:["graceGroupsService","$stateParams",function(e,t){return e.groupMembers(t.id).then(function(e){return e.sort(g)})}],show:["$stateParams",function(e){return e.show}],meetingLimit:function(){return 5},meetings:["graceGroupsService","$stateParams","meetingLimit",function(e,t,r){return e.meetingsByGroup(t.id,0,r).then(function(e){return e})}],meetingTotalCount:["graceGroupsService","$stateParams",function(e,t){return e.countMeetingsByGroup(t.id).then(function(e){return e})}],alert:["$stateParams",function(e){var t=e.alert;return delete e.alert,t}]},controller:["group","members","meetings","meetingLimit","meetingTotalCount","graceGroupsService","show","alert","$rootScope",o],controllerAs:"$ctrl"}).state("groups.edit",{url:"/{id:int}/edit",templateUrl:r+"/groups/edit.html",resolve:{group:["graceGroupsService","$stateParams",function(e,t){return e.group(t.id)}],leaders:["graceGroupsService","authUser",function(e,t){return e.groupLeadersForUser(t)}],divisionLeaders:["graceGroupsService",function(e){return e.usersByRole("DIVISION_LEADER")}]},controller:["$rootScope","graceGroupsService","group","leaders","divisionLeaders",a],controllerAs:"$ctrl"}).state("groups.new",{url:"/new",templateUrl:r+"/groups/new.html",resolve:{leaders:["graceGroupsService","authUser",function(e,t){return e.groupLeadersForUser(t)}],divisionLeaders:["graceGroupsService",function(e){return e.usersByRole("DIVISION_LEADER")}]},controller:["$rootScope","graceGroupsService","leaders","divisionLeaders","authUser",u],controllerAs:"$ctrl"}).state("groups.members",{url:"/{id:int}/members","abstract":!0,template:"<ui-view></ui-view>",resolve:{group:["graceGroupsService","$stateParams",function(e,t){return e.group(t.id)}],members:["graceGroupsService","$stateParams",function(e,t){return e.groupMembers(t.id).then(function(e){return e.sort(g)})}]}}).state("groups.members.view",{url:"",templateUrl:r+"/groups/members.html",controller:["graceGroupsService","group","members","$rootScope",s],controllerAs:"$ctrl"}).state("groups.members.select",{url:"/select",templateUrl:r+"/groups/member-select.html",resolve:{limit:function(){return 5}},controller:["graceGroupsService","group","members","limit",l],controllerAs:"$ctrl"}).state("groups.postNoMeeting",{url:"/{id:int}/no-meeting?date",templateUrl:r+"/groups/no-meeting-response.html",resolve:{group:["graceGroupsService","$stateParams","authUser",function(e,t,r){return r?e.group(t.id).then(function(e){return e}):null}],date:["$stateParams",function(e){return e.date}]},controller:["group","date","graceGroupsService","$state",c],controllerAs:"$ctrl"}).state("approvals",{url:"/approvals","abstract":!0,template:"<ui-view></ui-view>",resolve:{authUser:Util.authenticateAdmin}}).state("approvals.index",{url:"",templateUrl:r+"/approvals/index.html",resolve:{groups:["graceGroupsService","authUser",function(e,t){if(t)return e.groupsPendingApproval()}]},controller:["groups",d],controllerAs:"$ctrl"}).state("approvals.review",{url:"/{id:int}/review",templateUrl:r+"/approvals/review.html",resolve:{group:["graceGroupsService","$stateParams","authUser",function(e,t,r){if(r)return e.group(t.id)}]},controller:["group","graceGroupsService","$state",f],controllerAs:"$ctrl"})}]).component("ggGroup",{templateUrl:["partialPath",function(e){return e+"/groups/view.html"}],bindings:{group:"<",showEdit:"<",showSelect:"<",showDelete:"<",showDivisionLeader:"<",onEdit:"&",onMembers:"&",onDelete:"&",onSelect:"&",highlight:"@"},controller:["graceGroupsService","$rootScope","$element",r]}).component("graceGroupListing",{templateUrl:["partialPath",function(e){return e+"/groups/listing.html"}],bindings:{limit:"<",showSearch:"<",categoryCriteria:"@",keyWordCriteria:"@",dayOfWeekCriteria:"@",startTimeCriteria:"@",genderCriteria:"@",statusCriteria:"@",ageCriteria:"@",childcareCriteria:"@",onCampusCriteria:"@",onEditGroup:"&",onGroupMembers:"&",onSelectGroup:"&"},controller:["graceGroupsService","$rootScope",n]}).component("ggGroupForm",{templateUrl:["partialPath",function(e){return e+"/groups/groupForm.html"}],bindings:{$router:"<",group:"<",leaders:"<",divisionLeaders:"<",onSave:"&",onCancel:"&"},controller:[i]})}(window.angular),function(e){"use strict";function t(e,t,r,n,i){function o(){if(d.meeting.time){var e=moment(d.meeting.time);d.time=e.toDate(),d.date=e.toDate()}else d.group.schedule.startTime&&(d.time=moment(d.group.schedule.startTime,"HH:mm").toDate())}function a(){d.meeting.id?d.prayerRequests=d.meeting.prayerRequests.map(function(e,t){return{id:t,txt:e}}):d.prayerRequests=[];for(var e=d.prayerRequests.length;d.prayerRequests.length<2;)d.prayerRequests.push({id:e++})}function u(){if(d.meeting.id){d.regularAttendees=[],d.guests=[];var e=0;d.meeting.attendance.forEach(function(t){Util.isEmpty(t.userId)&&d.guests.push({id:e++,firstName:t.guestFirstName,lastName:t.guestLastName,email:t.guestEmail,phoneNumber:t.guestPhoneNumber})}),d.regularAttendees=t.map(function(e){var t=d.meeting.attendance.filter(function(t){return t.userId===e.id}).length>0;return{member:e,present:t}})}else d.regularAttendees=t.map(function(e){return{member:e,present:!0}}),d.guests=[]}function s(){d.meeting.attendance=d.regularAttendees.filter(function(e){return e.present}).map(function(e){return{userId:e.member.id}});var e=d.guests.map(function(e){return{guestFirstName:e.firstName,guestLastName:e.lastName,guestEmail:e.email,guestPhoneNumber:e.phoneNumber}});Array.prototype.push.apply(d.meeting.attendance,e)}function l(){d.meeting.prayerRequests=d.prayerRequests.filter(function(e){return!Util.isEmpty(e.txt)}).map(function(e){return e.txt})}function c(){d.meeting.time=moment(d.date).hour(d.time.getHours()).minute(d.time.getMinutes()).format("YYYY-MM-DDTHH:mm")}var d=this;d.group=e,d.members=t,d.meeting=r,a(),u(),o(),d.$onInit=function(){Util.isEmpty(d.meeting.id)&&i.isMeetingReported(e.id,moment(d.date).format("YYYY-MM-DD")).then(function(e){e&&(d.form.mDate.$error.serverValidation=!0,d.form.mDate.$error.serverError="meeting date already reported",d.form.mDate.$setTouched(),d.form.mDate.$invalid=!0)},function(e){console.log("failed to determine if the meeting date was already reported. Error(s): ",e)})},d.addPrayerRequest=function(){d.prayerRequests.push({id:d.prayerRequests[d.prayerRequests.length-1].id+1})},d.attendeeCount=function(){var e=d.regularAttendees.filter(function(e){return e.present}).length;return e+d.guests.length},d.addGuest=function(){var e=0===d.guests.length?0:d.guests[d.guests.length-1].id+1;d.guests.push({id:e})},d.save=function(t){if(t.$valid){s(),l(),c();var r=d.meeting.id?i.updateMeeting:i.createMeeting;return r.call(this,d.meeting).then(function(){n.go("groups.details",{id:e.id,show:"reports"})},function(e){console.log(e);var r=!1;if(e.forEach&&e.forEach(function(e){"meeting-already-reported"===e&&(t.mDate.$error.serverValidation=!0,t.mDate.$error.serverError="meeting date already reported",r=!0)}),r){var n=$(".has-error:first");n.length>0&&$("html, body").animate({scrollTop:n.offset().top},500),Util.alert("Please correct errors indicated in red.","Info")}else Util.alert("Failed to save the meeting report. Please try again later.")})}var o=$(".has-error:first");return o.length>0&&$("html, body").animate({scrollTop:o.offset().top},500),Util.alert("Please correct errors indicated in red.","Info"),null}}function r(e,t,r,n,i){function o(){var n={groupId:a.group.id,topic:e.name,comments:"Met as planned",time:r,prayerRequests:[],attendance:t.map(function(e){return{userId:e.id}})};return i.supplementMeeting(n),n}var a=this;a.group=e,a.members=t,a.meeting=o(),a.save=function(){return i.createMeeting(a.meeting).then(function(){n.go("groups.details",{id:e.id,show:"reports"})},function(e){console.log(e),e.indexOf("unauthorized-create")>=0?Util.alert("You are not authorized to create a report for this group.","Unauthorized"):Util.alert("Failed to save the meeting report. Please try again later.")})}}function n(e,t,r){function n(){i.regularAttendees=r.map(function(t){return{member:t,present:e.attendance.filter(function(e){return e.userId===t.id}).length>0}}),i.guests=e.attendance.filter(function(e){return!!Util.isEmpty(e.userId)||0===r.filter(function(t){return t.id===e.userId}).length})}var i=this;i.meeting=e,i.group=t,i.members=r,n()}function i(e,t){return e.lastName.localeCompare(t.lastName)}e.module("meetingReports",["ui.router","angularPromiseButtons","ngConstants"]).config(["$stateProvider","partialPath",function(e,o){e.state("meetingReports",{url:"/meeting-reports","abstract":!0,template:"<ui-view></ui-view>",resolve:{authUser:Util.authenticate}}).state("meetingReports.new",{url:"/new?groupId&default&dateTime",templateUrl:o+"/meeting-reports/manage.html",resolve:{group:["graceGroupsService","$stateParams",function(e,t){return e.group(t.groupId).then(function(e){return e})}],members:["graceGroupsService","$stateParams",function(e,t){return e.groupMembers(t.groupId).then(function(e){return e.sort(i)})}],meeting:["group","$stateParams",function(e,t){var r={groupId:e.id,time:t.dateTime||e.schedule.lastMeeting};return"true"===t["default"]&&(r.topic=e.name,r.comments="Met as planned"),r}]},controller:["group","members","meeting","$state","graceGroupsService",t],controllerAs:"$ctrl"}).state("meetingReports.newDefault",{url:"/new-default?groupId&dateTime",templateUrl:o+"/meeting-reports/new-default.html",resolve:{group:["graceGroupsService","$stateParams",function(e,t){return e.group(t.groupId).then(function(e){return e})}],members:["graceGroupsService","$stateParams",function(e,t){return e.groupMembers(t.groupId).then(function(e){return e.sort(i)})}],dateTime:["$stateParams",function(e){return e.dateTime}]},controller:["group","members","dateTime","$state","graceGroupsService",r],controllerAs:"$ctrl"}).state("meetingReports.edit",{url:"/{id:int}/edit",templateUrl:o+"/meeting-reports/manage.html",resolve:{meeting:["graceGroupsService","$stateParams",function(e,t){return e.meeting(t.id)}],group:["graceGroupsService","meeting",function(e,t){return e.group(t.groupId).then(function(e){return e})}],members:["graceGroupsService","group",function(e,t){return e.groupMembers(t.id).then(function(e){return e.sort(i)})}]},controller:["group","members","meeting","$state","graceGroupsService",t],controllerAs:"$ctrl"}).state("meetingReports.details",{url:"/{id:int}/details",templateUrl:o+"/meeting-reports/details.html",resolve:{meeting:["graceGroupsService","$stateParams",function(e,t){return e.meeting(t.id).then(function(e){return e})}],members:["graceGroupsService","meeting",function(e,t){return e.groupMembers(t.groupId).then(function(e){return e.sort(i)})}],group:["graceGroupsService","meeting",function(e,t){return e.group(t.groupId).then(function(e){return e})}]},controller:["meeting","group","members",n],controllerAs:"$ctrl"})}])}(window.angular),function(e){"use strict";function t(e,t,r,n,i,o){function a(i){return t(function(t,o){e.post(W("/users/login"),i,K()).then(function(e){r.put(ne,e.data.token,{secure:n}),X(e.data.user),t(e.data.user)},function(e){var t=e.status<500&&e.status>399?"invalid-login":"server-error";o(t)})})}function u(){return t(function(t,r){e.get(W("/users/current"),K()).then(function(e){X(e.data),t(e.data)},function(e){console.log("current user error",e);var t=401===e.status?"no-auth":"server-error";r(t)})})}function s(){r.remove(ne)}function l(r){return t(function(t,n){e.put(W("/users",r.id),r,K()).then(function(){t()},function(e){n(te(e))})})}function c(r){return t(function(t,n){e.post(W("/users"),r,K()).then(function(e){X(e.data),t(e.data)},function(e){n(te(e))})})}function d(){return t(function(t,r){e.get(W("/users"),K()).then(function(e){e.data.forEach(function(e){X(e)}),t(e.data)},function(){r("server-error")})})}function f(r){return t(function(t,n){e.get(W("/users",r),K()).then(function(e){X(e.data),t(e.data)},function(e){var t=e.status<500?"user-not-found":"server-error";n(t)})})}function g(r){return t(function(t,n){e.get(W("/users/by-role"),K({role:r})).then(function(e){e.data.forEach(function(e){X(e)}),t(e.data)},function(e){console.log(e),n("server-error")})})}function p(r,n,i,o){return t(function(t,a){e.get(W("/users/by-name"),K({firstName:r,lastName:n,page:i,limit:o})).then(function(e){e.data.forEach(function(e){X(e)}),t(e.data)},function(){a("server-error")})})}function m(r,n){return t(function(t,i){e.get(W("/users/count/by-name"),K({firstName:r,lastName:n})).then(function(e){t(e.data)},function(){i("server-error")})})}function h(r){return t(function(t,n){e.get(W("/users",r.id,"group-leaders"),K()).then(function(e){e.data.forEach(function(e){X(e)}),t(e.data)},function(){n("server-error")})})}function v(){return t(function(t,r){e.get(W("/users/managers"),K()).then(function(e){e.data.forEach(function(e){X(e)}),t(e.data)},function(){r("server-error")})})}function y(r){return t(function(t,n){e.get(W("/users",r,"direct-reports"),K()).then(function(e){e.data.forEach(function(e){X(e)}),t(e.data)},function(){n("server-error")})})}function b(r){return t(function(t,n){e["delete"](W("/users",r.id),K()).then(function(){t()},function(e){n(te(e))})})}function $(e,n){var i=r.get(ne);return t(function(t,r){o.upload({url:W("/users",e,"image"),data:{file:n},headers:{Authorization:"Bearer "+i},method:"POST"}).then(function(e){console.log(e.data),X(e.data),t(e.data)},function(e){r(te(e))})})}function U(){return t(function(t,r){e.get(W("/groups"),K()).then(function(e){e.data.forEach(function(e){Q(e)}),t(e.data)},function(){r("server-error")})})}function C(){return t(function(t,r){e.get(W("/groups/export"),K()).then(function(e){t(e.data)},function(){r("server-error")})})}function E(){return t(function(t,r){e.get(W("/groups/pending-approval"),K()).then(function(e){e.data.forEach(function(e){Q(e)}),t(e.data)},function(){r("server-error")})})}function w(r){return t(function(t,n){e.post(W("/groups"),r,K()).then(function(){t()},function(e){n(te(e))})})}function T(r){return t(function(t,n){e.get(W("/groups",r),K()).then(function(e){Q(e.data),t(e.data)},function(e){var t=e.status<500?"group-not-found":"server-error";n(t)})})}function D(r){return t(function(t,n){e.put(W("/groups",r.id),r,K()).then(function(){t()},function(e){n(te(e))})})}function R(r){return t(function(t,n){e.get(W("/groups",r,"members"),K()).then(function(e){e.data.forEach(function(e){X(e)}),t(e.data)},function(e){var t=e.status<500?"group-not-found":"server-error";n(t)})})}function A(r,n){return t(function(t,i){e.put(W("/groups",r,"add-member/"+n),null,K()).then(function(){t()},function(e){var t=e.status<500?"bad-data":"server-error";i(t)})})}function P(r,n){return t(function(t,i){e.put(W("/groups",r,"remove-member/"+n),null,K()).then(function(){t()},function(e){var t=e.status<500?"bad-data":"server-error";i(t)})})}function I(r){return t(function(t,n){e.put(W("/groups",r.id,"approve"),r,K()).then(function(){t()},function(){n("server-error")})})}function M(r){return t(function(t,n){e.get(W("/groups/by-user"),K({userId:r})).then(function(e){e.data.forEach(function(e){Q(e)}),t(e.data)},function(){n("server-error")})})}function O(r){return t(function(t,n){e.get(W("/groups/search"),K(r)).then(function(e){console.log(e),e.data.forEach(function(e){Q(e)}),t(e.data)},function(){n("server-error")})})}function x(r){return t(function(t,n){e.get(W("/groups/count"),K(r)).then(function(e){t(e.data)},function(){n("server-error")})})}function G(r){return t(function(t,n){e.get(W("/groups/published/search"),K(r)).then(function(e){console.log(e),e.data.forEach(function(e){Q(e)}),t(e.data)},function(){n("server-error")})})}function _(r){return t(function(t,n){e.get(W("/groups/published/count"),K(r)).then(function(e){t(e.data)},function(){n("server-error")})})}function N(r){return t(function(t,n){e["delete"](W("/groups",r.id),K()).then(function(){t()},function(e){n(te(e))})})}function L(r){return t(function(t,n){e.get(W("/groups",r,"calendar-export"),K()).then(function(e){t(e.data)},function(){n("server-error")})})}function F(r){return t(function(t,n){e.get(W("/groups",r,"published/calendar-export"),K()).then(function(e){t(e.data)},function(){n("server-error")})})}function z(r,n){return t(function(t,i){e.post(W("/groups",r,"no-meeting"),"",K({dateTime:n})).then(function(){t()},function(e){i(te(e))})})}function k(r){return t(function(t,n){e.post(W("/meetings"),r,K()).then(function(){t()},function(e){n(te(e))})})}function B(r){return t(function(t,n){e.put(W("/meetings",r.id),r,K()).then(function(){t()},function(e){n(te(e))})})}function V(r){return t(function(t,n){e["delete"](W("/meetings",r.id),K()).then(function(){t()},function(e){n(te(e))})})}function q(r,n,i){return t(function(t,o){e.get(W("/meetings/by-group",r),K({page:n,limit:i})).then(function(e){e.data.forEach(function(e){ee(e)}),t(e.data)},function(){o("server-error")})})}function H(r){return t(function(t,n){e.get(W("/meetings/count/by-group",r),K()).then(function(e){t(e.data)},function(){n("server-error")})})}function Y(r){return t(function(t,n){e.get(W("/meetings",r),K()).then(function(e){ee(e.data),t(e.data)},function(e){var t=e.status<500?"meeting-not-found":"server-error";n(t)})})}function j(r,n){return t(function(t,i){e.get(W("/meetings/by-group",r,"is-date-reported"),K({date:n})).then(function(e){t(e.data)},function(){i("server-error")})})}function W(e,t,r){var n=re+e;return t&&(n=n+"/"+t),r&&(n=n+"/"+r),n}function K(e){var t={withCredentials:!0};e&&(t.params=e);var n=r.get(ne);return n&&(t.headers={Authorization:"Bearer "+n}),t}function X(e){e.shortName=function(){return S(e.firstName).capitalize().s+" "+S(e.lastName.substring(0,1)).capitalize()+"."},Z(e),e.roleLabel=function(){return S(e.role).humanize().s},J(e.auditInfo),e.facebookLinkFull=function(){return e.facebookLink?Util.externalUrl(e.facebookLink,!0):null},e.facebookLinkShort=function(){return e.facebookLink?e.facebookLink.replace(/http:\/\/|https:\/\//,"").replace("www.",""):null}}function J(e){e&&(e.createdBy&&Z(e.createdBy),e.updatedBy&&Z(e.updatedBy))}function Z(e){e.fullName=function(){return S(e.firstName).capitalize().s+" "+S(e.lastName).capitalize().s}}function Q(e){X(e.leader),e.secondaryLeader&&X(e.secondaryLeader),e.divisionLeader&&X(e.divisionLeader),e.isFull=function(){return!Util.isEmpty(this.capacity)&&this.memberIds.length>=this.capacity},J(e.auditInfo)}function ee(e){e.memberCount=function(e){return this.attendance.filter(function(t){return e.filter(function(e){return e.id===t.userId}).length>0}).length},e.guestCount=function(e){return this.attendance.filter(function(t){return 0===e.filter(function(e){return e.id===t.userId}).length}).length},J(e.auditInfo)}function te(e){return e.status<500&&e.status>399?e.data:["server-error"]}var re=i,ne="ggs-auth-token";return{login:a,currentUser:u,logout:s,updateUser:l,users:d,user:f,createUser:c,usersByRole:g,usersByName:p,countUsersByName:m,groupLeadersForUser:h,managers:v,directReports:y,deleteUser:b,uploadUserImage:$,groups:U,groupExport:C,groupsPendingApproval:E,createGroup:w,group:T,updateGroup:D,groupMembers:R,addGroupMember:A,removeGroupMember:P,approveGroup:I,groupsForUser:M,groupSearch:O,groupCount:x,publishedGroupSearch:G,publishedGroupCount:_,deleteGroup:N,groupCalendarExport:L,publishedGroupCalendarExport:F,postNoMeeting:z,createMeeting:k,updateMeeting:B,deleteMeeting:V,meetingsByGroup:q,countMeetingsByGroup:H,meeting:Y,supplementMeeting:ee,isMeetingReported:j}}e.module("graceGroupsService",["ngCookies","ngConstants","ngFileUpload"]).config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]).service("graceGroupsService",["$http","$q","$cookies","secureCookies","serviceUrl","Upload",t])}(window.angular),function(e){"use strict";function t(){function e(){return h.slice()}function t(e,t){if(t=t||!1,"PASTOR"===e.role||e.admin)return h.slice();for(var r=0;r<h.length-1;r++)if(h[r].code===e.role)return h.slice(t?r:r+1);return[{code:"CONTACT",label:"Contact"}]}function r(e,t){return!Util.isEmpty(e)&&(!(!e.admin&&"PASTOR"!==e.role&&"CONTACT"!==t.role&&e.id!==t.id)||l(e,t))}function n(e,t){return!Util.isEmpty(e)&&("CONTACT"===t.role?m(e):e.id!==t.id&&r(e,t))}function i(e,t){return!Util.isEmpty(e)&&(e.admin||Util.isEmpty(t.id)||Util.isEmpty(t.manager)||r(e,t)&&e.id!==t.id)}function o(e){return!Util.isEmpty(e)&&(e.admin||"GROUP_LEADER"!==e.role&&"CONTACT"!==e.role)}function a(e,t){if(Util.isEmpty(e))return!1;var r=e.admin||"PASTOR"===e.role,n=e.id===t.leaderId,i=e.id===t.secondaryLeaderId,o=l(e,t.leader);return r||n||i||o}function u(e){return!Util.isEmpty(e)}function s(e){return m(e)}function l(e,t){for(var r=t.manager,n=0;!Util.isEmpty(r)&&n++<h.length-1;){if(r.id===e.id)return!0;r=r.manager}return!1}function c(e,t){return a(e,t)}function d(e,t){var r=[];return a(e,t)&&r.push("edit"),c(e,t)&&r.push("delete"),r}function f(e,t){return d(e,t).join(" ")}function g(e){return m(e)}function p(e,t){if(Util.isEmpty(e))return!1;var r=t.leaderId===e.id||t.secondaryLeaderId===e.id,n=t.divisionLeaderId===e.id;return m(e)||r||n}function m(e){return e&&(e.admin||"PASTOR"===e.role)}var h=[{code:"ADMIN",label:"Admin"},{code:"PASTOR",label:"Pastor"},{code:"DIVISION_DIRECTOR",label:"Division Director"},{code:"DIVISION_LEADER",label:"Division Leader"},{code:"GROUP_LEADER",label:"Group Leader"},{code:"CONTACT",label:"Contact"}];return{roles:e,rolesAssignableBy:t,userCanEditUser:r,userCanDeleteUser:n,userCanChangeManagerOf:i,userCanChangeGroupLeader:o,userCanEditGroup:a,userCanCreateGroup:u,userCanSeeAuditInfo:s,isUserManagerOf:l,userCanDeleteGroup:c,groupPrivileges:d,groupPrivilegesString:f,canDownloadGroups:g,canEditMeetingForGroup:p}}e.module("authorizer",[]).service("authorizer",[t])}(window.angular);