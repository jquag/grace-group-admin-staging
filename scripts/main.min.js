!window.XMLHttpRequest||window.FileAPI&&FileAPI.shouldLoad||(window.XMLHttpRequest.prototype.setRequestHeader=function(e){return function(t,r){if("__setXHR_"===t){var n=r(this);n instanceof Function&&n(this)}else e.apply(this,arguments)}}(window.XMLHttpRequest.prototype.setRequestHeader));var ngFileUpload=angular.module("ngFileUpload",[]);ngFileUpload.version="12.2.13",ngFileUpload.service("UploadBase",["$http","$q","$timeout",function(e,t,r){function n(n){function i(e){l.notify&&l.notify(e),c.progressFunc&&r(function(){c.progressFunc(e)})}function u(e){return null!=n._start&&a?{loaded:e.loaded+n._start,total:n._file&&n._file.size||e.total,type:e.type,config:n,lengthComputable:!0,target:e.target}:e}function s(){e(n).then(function(e){if(a&&n._chunkSize&&!n._finished&&n._file){var t=n._file&&n._file.size||0;i({loaded:Math.min(n._end,t),total:t,config:n,type:"progress"}),o.upload(n,!0)}else n._finished&&delete n._finished,l.resolve(e)},function(e){l.reject(e)},function(e){l.notify(e)})}n.method=n.method||"POST",n.headers=n.headers||{};var l=n._deferred=n._deferred||t.defer(),c=l.promise;return n.disableProgress||(n.headers.__setXHR_=function(){return function(e){e&&e.upload&&e.upload.addEventListener&&(n.__XHR=e,n.xhrFn&&n.xhrFn(e),e.upload.addEventListener("progress",function(e){e.config=n,i(u(e))},!1),e.upload.addEventListener("load",function(e){e.lengthComputable&&(e.config=n,i(u(e)))},!1))}}),a?n._chunkSize&&n._end&&!n._finished?(n._start=n._end,n._end+=n._chunkSize,s()):n.resumeSizeUrl?e.get(n.resumeSizeUrl).then(function(e){n.resumeSizeResponseReader?n._start=n.resumeSizeResponseReader(e.data):n._start=parseInt((null==e.data.size?e.data:e.data.size).toString()),n._chunkSize&&(n._end=n._start+n._chunkSize),s()},function(e){throw e}):n.resumeSize?n.resumeSize().then(function(e){n._start=e,n._chunkSize&&(n._end=n._start+n._chunkSize),s()},function(e){throw e}):(n._chunkSize&&(n._start=0,n._end=n._start+n._chunkSize),s()):s(),c.success=function(e){return c.then(function(t){e(t.data,t.status,t.headers,n)}),c},c.error=function(e){return c.then(null,function(t){e(t.data,t.status,t.headers,n)}),c},c.progress=function(e){return c.progressFunc=e,c.then(null,null,function(t){e(t)}),c},c.abort=c.pause=function(){return n.__XHR&&r(function(){n.__XHR.abort()}),c},c.xhr=function(e){return n.xhrFn=function(t){return function(){t&&t.apply(c,arguments),e.apply(c,arguments)}}(n.xhrFn),c},o.promisesCount++,c["finally"]&&c["finally"]instanceof Function&&c["finally"](function(){o.promisesCount--}),c}function i(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}var o=this;o.promisesCount=0,this.isResumeSupported=function(){return window.Blob&&window.Blob.prototype.slice};var a=this.isResumeSupported();this.isUploadInProgress=function(){return o.promisesCount>0},this.rename=function(e,t){return e.ngfName=t,e},this.jsonBlob=function(e){null==e||angular.isString(e)||(e=JSON.stringify(e));var t=new window.Blob([e],{type:"application/json"});return t._ngfBlob=!0,t},this.json=function(e){return angular.toJson(e)},this.isFile=function(e){return null!=e&&(e instanceof window.Blob||e.flashId&&e.name&&e.size)},this.upload=function(e,t){function r(t,r){if(t._ngfBlob)return t;if(e._file=e._file||t,null!=e._start&&a){e._end&&e._end>=t.size&&(e._finished=!0,e._end=t.size);var n=t.slice(e._start,e._end||t.size);return n.name=t.name,n.ngfName=t.ngfName,e._chunkSize&&(r.append("_chunkSize",e._chunkSize),r.append("_currentChunkSize",e._end-e._start),r.append("_chunkNumber",Math.floor(e._start/e._chunkSize)),r.append("_totalSize",e._file.size)),n}return t}function u(t,n,i){if(void 0!==n)if(angular.isDate(n)&&(n=n.toISOString()),angular.isString(n))t.append(i,n);else if(o.isFile(n)){var a=r(n,t),s=i.split(",");s[1]&&(a.ngfName=s[1].replace(/^\s+|\s+$/g,""),i=s[0]),e._fileKey=e._fileKey||i,t.append(i,a,a.ngfName||a.name)}else if(angular.isObject(n)){if(n.$$ngfCircularDetection)throw"ngFileUpload: Circular reference in config.data. Make sure specified data for Upload.upload() has no circular reference: "+i;n.$$ngfCircularDetection=!0;try{for(var l in n)if(n.hasOwnProperty(l)&&"$$ngfCircularDetection"!==l){var c=null==e.objectKey?"[i]":e.objectKey;n.length&&parseInt(l)>-1&&(c=null==e.arrayKey?c:e.arrayKey),u(t,n[l],i+c.replace(/[ik]/g,l))}}finally{delete n.$$ngfCircularDetection}}else t.append(i,n)}function s(){e._chunkSize=o.translateScalars(e.resumeChunkSize),e._chunkSize=e._chunkSize?parseInt(e._chunkSize.toString()):null,e.headers=e.headers||{},e.headers["Content-Type"]=void 0,e.transformRequest=e.transformRequest?angular.isArray(e.transformRequest)?e.transformRequest:[e.transformRequest]:[],e.transformRequest.push(function(t){var r,n=new window.FormData;t=t||e.fields||{},e.file&&(t.file=e.file);for(r in t)if(t.hasOwnProperty(r)){var i=t[r];e.formDataAppender?e.formDataAppender(n,r,i):u(n,i,r)}return n})}return t||(e=i(e)),e._isDigested||(e._isDigested=!0,s()),n(e)},this.http=function(t){return t=i(t),t.transformRequest=t.transformRequest||function(t){return window.ArrayBuffer&&t instanceof window.ArrayBuffer||t instanceof window.Blob?t:e.defaults.transformRequest[0].apply(this,arguments)},t._chunkSize=o.translateScalars(t.resumeChunkSize),t._chunkSize=t._chunkSize?parseInt(t._chunkSize.toString()):null,n(t)},this.translateScalars=function(e){if(angular.isString(e)){if(e.search(/kb/i)===e.length-2)return parseFloat(1024*e.substring(0,e.length-2));if(e.search(/mb/i)===e.length-2)return parseFloat(1048576*e.substring(0,e.length-2));if(e.search(/gb/i)===e.length-2)return parseFloat(1073741824*e.substring(0,e.length-2));if(e.search(/b/i)===e.length-1)return parseFloat(e.substring(0,e.length-1));if(e.search(/s/i)===e.length-1)return parseFloat(e.substring(0,e.length-1));if(e.search(/m/i)===e.length-1)return parseFloat(60*e.substring(0,e.length-1));if(e.search(/h/i)===e.length-1)return parseFloat(3600*e.substring(0,e.length-1))}return e},this.urlToBlob=function(r){var n=t.defer();return e({url:r,method:"get",responseType:"arraybuffer"}).then(function(e){var t=new Uint8Array(e.data),i=e.headers("content-type")||"image/WebP",o=new window.Blob([t],{type:i}),a=r.match(/.*\/(.+?)(\?.*)?$/);a.length>1&&(o.name=a[1]),n.resolve(o)},function(e){n.reject(e)}),n.promise},this.setDefaults=function(e){this.defaults=e||{}},this.defaults={},this.version=ngFileUpload.version}]),ngFileUpload.service("Upload",["$parse","$timeout","$compile","$q","UploadExif",function(e,t,r,n,i){function o(e,t,r){var i=[s.emptyPromise()];return angular.forEach(e,function(n,o){0===n.type.indexOf("image/jpeg")&&s.attrGetter("ngfFixOrientation",t,r,{$file:n})&&i.push(s.happyPromise(s.applyExifRotation(n),n).then(function(t){e.splice(o,1,t)}))}),n.all(i)}function a(e,t,r,i){var o=s.attrGetter("ngfResize",t,r);if(!o||!s.isResizeSupported()||!e.length)return s.emptyPromise();if(o instanceof Function){var a=n.defer();return o(e).then(function(n){u(n,e,t,r,i).then(function(e){a.resolve(e)},function(e){a.reject(e)})},function(e){a.reject(e)})}return u(o,e,t,r,i)}function u(e,t,r,i,o){function a(n,a){if(0===n.type.indexOf("image")){if(e.pattern&&!s.validatePattern(n,e.pattern))return;e.resizeIf=function(e,t){return s.attrGetter("ngfResizeIf",r,i,{$width:e,$height:t,$file:n})};var l=s.resize(n,e);u.push(l),l.then(function(e){t.splice(a,1,e)},function(e){n.$error="resize",(n.$errorMessages=n.$errorMessages||{}).resize=!0,n.$errorParam=(e?(e.message?e.message:e)+": ":"")+(n&&n.name),o.$ngfValidations.push({name:"resize",valid:!1}),s.applyModelValidation(o,t)})}}for(var u=[s.emptyPromise()],l=0;l<t.length;l++)a(t[l],l);return n.all(u)}var s=i;return s.getAttrWithDefaults=function(e,t){if(null!=e[t])return e[t];var r=s.defaults[t];return null==r?r:angular.isString(r)?r:JSON.stringify(r)},s.attrGetter=function(t,r,n,i){var o=this.getAttrWithDefaults(r,t);if(!n)return o;try{return i?e(o)(n,i):e(o)(n)}catch(a){if(t.search(/min|max|pattern/i))return o;throw a}},s.shouldUpdateOn=function(e,t,r){var n=s.attrGetter("ngfModelOptions",t,r);return n&&n.updateOn?n.updateOn.split(" ").indexOf(e)>-1:!0},s.emptyPromise=function(){var e=n.defer(),r=arguments;return t(function(){e.resolve.apply(e,r)}),e.promise},s.rejectPromise=function(){var e=n.defer(),r=arguments;return t(function(){e.reject.apply(e,r)}),e.promise},s.happyPromise=function(e,r){var i=n.defer();return e.then(function(e){i.resolve(e)},function(e){t(function(){throw e}),i.resolve(r)}),i.promise},s.updateModel=function(r,n,i,u,l,c,f){function d(o,a,l,f,d){n.$$ngfPrevValidFiles=o,n.$$ngfPrevInvalidFiles=a;var g=o&&o.length?o[0]:null,p=a&&a.length?a[0]:null;r&&(s.applyModelValidation(r,o),r.$setViewValue(d?g:o)),u&&e(u)(i,{$files:o,$file:g,$newFiles:l,$duplicateFiles:f,$invalidFiles:a,$invalidFile:p,$event:c});var h=s.attrGetter("ngfModelInvalid",n);h&&t(function(){e(h).assign(i,d?p:a)}),t(function(){})}function g(){function e(e,t){return e.name===t.name&&(e.$ngfOrigSize||e.size)===(t.$ngfOrigSize||t.size)&&e.type===t.type}function t(t){var r;for(r=0;r<v.length;r++)if(e(t,v[r]))return!0;for(r=0;r<b.length;r++)if(e(t,b[r]))return!0;return!1}if(l){m=[],y=[];for(var r=0;r<l.length;r++)t(l[r])?y.push(l[r]):m.push(l[r])}}function p(e){return angular.isArray(e)?e:[e]}function h(){function e(){t(function(){d(U?v.concat(S):S,U?b.concat($):$,l,y,w)},T&&T.debounce?T.debounce.change||T.debounce:0)}var o=C?m:S;a(o,n,i,r).then(function(){C?s.validate(m,U?v.length:0,r,n,i).then(function(t){S=t.validsFiles,$=t.invalidsFiles,e()}):e()},function(){for(var t=0;t<o.length;t++){var r=o[t];if("resize"===r.$error){var n=S.indexOf(r);n>-1&&(S.splice(n,1),$.push(r)),e()}}})}var m,v,b,y=[],$=[],S=[];v=n.$$ngfPrevValidFiles||[],b=n.$$ngfPrevInvalidFiles||[],r&&r.$modelValue&&(v=p(r.$modelValue));var U=s.attrGetter("ngfKeep",n,i);m=(l||[]).slice(0),"distinct"!==U&&s.attrGetter("ngfKeepDistinct",n,i)!==!0||g(n,i);var w=!U&&!s.attrGetter("ngfMultiple",n,i)&&!s.attrGetter("multiple",n);if(!U||m.length){s.attrGetter("ngfBeforeModelChange",n,i,{$files:l,$file:l&&l.length?l[0]:null,$newFiles:m,$duplicateFiles:y,$event:c});var C=s.attrGetter("ngfValidateAfterResize",n,i),T=s.attrGetter("ngfModelOptions",n,i);s.validate(m,U?v.length:0,r,n,i).then(function(e){f?d(m,[],l,y,w):(T&&T.allowInvalid||C?S=m:(S=e.validFiles,$=e.invalidFiles),s.attrGetter("ngfFixOrientation",n,i)&&s.isExifSupported()?o(S,n,i).then(function(){h()}):h())})}},s}]),ngFileUpload.directive("ngfSelect",["$parse","$timeout","$compile","Upload",function(e,t,r,n){function i(e){var t=e.match(/Android[^\d]*(\d+)\.(\d+)/);if(t&&t.length>2){var r=n.defaults.androidFixMinorVersion||4;return parseInt(t[1])<4||parseInt(t[1])===r&&parseInt(t[2])<r}return-1===e.indexOf("Chrome")&&/.*Windows.*Safari.*/.test(e)}function o(e,t,r,n,o,u,s,l){function c(){return"input"===t[0].tagName.toLowerCase()&&r.type&&"file"===r.type.toLowerCase()}function f(){return y("ngfChange")||y("ngfSelect")}function d(t){if(l.shouldUpdateOn("change",r,e)){var i=t.__files_||t.target&&t.target.files,o=[];if(!i)return;for(var a=0;a<i.length;a++)o.push(i[a]);l.updateModel(n,r,e,f(),o.length?o:null,t)}}function g(e,n){function i(t){e.attr("id","ngf-"+t),n.attr("id","ngf-label-"+t)}for(var o=0;o<t[0].attributes.length;o++){var a=t[0].attributes[o];"type"!==a.name&&"class"!==a.name&&"style"!==a.name&&("id"===a.name?(i(a.value),$.push(r.$observe("id",i))):e.attr(a.name,a.value||"required"!==a.name&&"multiple"!==a.name?a.value:a.name))}}function p(){if(c())return t;var e=angular.element('<input type="file">'),r=angular.element("<label>upload</label>");return r.css("visibility","hidden").css("position","absolute").css("overflow","hidden").css("width","0px").css("height","0px").css("border","none").css("margin","0px").css("padding","0px").attr("tabindex","-1"),g(e,r),a.push({el:t,ref:r}),document.body.appendChild(r.append(e)[0]),e}function h(r){if(t.attr("disabled"))return!1;if(!y("ngfSelectDisabled",e)){var n=m(r);if(null!=n)return n;v(r);try{c()||document.body.contains(w[0])||(a.push({el:t,ref:w.parent()}),document.body.appendChild(w.parent()[0]),w.bind("change",d))}catch(o){}return i(navigator.userAgent)?setTimeout(function(){w[0].click()},0):w[0].click(),!1}}function m(e){var t=e.changedTouches||e.originalEvent&&e.originalEvent.changedTouches;if(t){if("touchstart"===e.type)return U=t[0].clientX,S=t[0].clientY,!0;if("touchend"===e.type){var r=t[0].clientX,n=t[0].clientY;if(Math.abs(r-U)>20||Math.abs(n-S)>20)return e.stopPropagation(),e.preventDefault(),!1}return!0}}function v(t){l.shouldUpdateOn("click",r,e)&&w.val()&&(w.val(null),l.updateModel(n,r,e,f(),null,t,!0))}function b(e){if(w&&!w.attr("__ngf_ie10_Fix_")){if(!w[0].parentNode)return void(w=null);e.preventDefault(),e.stopPropagation(),w.unbind("click");var t=w.clone();return w.replaceWith(t),w=t,w.attr("__ngf_ie10_Fix_","true"),w.bind("change",d),w.bind("click",b),w[0].click(),!1}w.removeAttr("__ngf_ie10_Fix_")}var y=function(e,t){return l.attrGetter(e,r,t)};l.registerModelChangeValidator(n,r,e);var $=[];y("ngfMultiple")&&$.push(e.$watch(y("ngfMultiple"),function(){w.attr("multiple",y("ngfMultiple",e))})),y("ngfCapture")&&$.push(e.$watch(y("ngfCapture"),function(){w.attr("capture",y("ngfCapture",e))})),y("ngfAccept")&&$.push(e.$watch(y("ngfAccept"),function(){w.attr("accept",y("ngfAccept",e))})),$.push(r.$observe("accept",function(){w.attr("accept",y("accept"))}));var S=0,U=0,w=t;c()||(w=p()),w.bind("change",d),c()?t.bind("click",v):t.bind("click touchstart touchend",h),-1!==navigator.appVersion.indexOf("MSIE 10")&&w.bind("click",b),n&&n.$formatters.push(function(e){return null!=e&&0!==e.length||w.val()&&w.val(null),e}),e.$on("$destroy",function(){c()||w.parent().remove(),angular.forEach($,function(e){e()})}),u(function(){for(var e=0;e<a.length;e++){var t=a[e];document.body.contains(t.el[0])||(a.splice(e,1),t.ref.remove())}}),window.FileAPI&&window.FileAPI.ngfFixIE&&window.FileAPI.ngfFixIE(t,w,d)}var a=[];return{restrict:"AEC",require:"?ngModel",link:function(i,a,u,s){o(i,a,u,s,e,t,r,n)}}}]),function(){function e(e){return"img"===e.tagName.toLowerCase()?"image":"audio"===e.tagName.toLowerCase()?"audio":"video"===e.tagName.toLowerCase()?"video":/./}function t(t,r,n,i,o,a,u,s){function l(e){var a=t.attrGetter("ngfNoObjectUrl",o,n);t.dataUrl(e,a)["finally"](function(){r(function(){var t=(a?e.$ngfDataUrl:e.$ngfBlobUrl)||e.$ngfDataUrl;s?i.css("background-image","url('"+(t||"")+"')"):i.attr("src",t),t?i.removeClass("ng-hide"):i.addClass("ng-hide")})})}r(function(){var r=n.$watch(o[a],function(r){var c=u;if("ngfThumbnail"===a&&(c||(c={width:i[0].naturalWidth||i[0].clientWidth,height:i[0].naturalHeight||i[0].clientHeight}),0===c.width&&window.getComputedStyle)){var f=getComputedStyle(i[0]);f.width&&f.width.indexOf("px")>-1&&f.height&&f.height.indexOf("px")>-1&&(c={width:parseInt(f.width.slice(0,-2)),height:parseInt(f.height.slice(0,-2))})}return angular.isString(r)?(i.removeClass("ng-hide"),s?i.css("background-image","url('"+r+"')"):i.attr("src",r)):void(!r||!r.type||0!==r.type.search(e(i[0]))||s&&0!==r.type.indexOf("image")?i.addClass("ng-hide"):c&&t.isResizeSupported()?(c.resizeIf=function(e,i){return t.attrGetter("ngfResizeIf",o,n,{$width:e,$height:i,$file:r})},t.resize(r,c).then(function(e){l(e)},function(e){throw e})):l(r))});n.$on("$destroy",function(){r()})})}ngFileUpload.service("UploadDataUrl",["UploadBase","$timeout","$q",function(e,t,r){var n=e;return n.base64DataUrl=function(e){if(angular.isArray(e)){var t=r.defer(),i=0;return angular.forEach(e,function(r){n.dataUrl(r,!0)["finally"](function(){if(i++,i===e.length){var r=[];angular.forEach(e,function(e){r.push(e.$ngfDataUrl)}),t.resolve(r,e)}})}),t.promise}return n.dataUrl(e,!0)},n.dataUrl=function(e,i){if(!e)return n.emptyPromise(e,e);if(i&&null!=e.$ngfDataUrl||!i&&null!=e.$ngfBlobUrl)return n.emptyPromise(i?e.$ngfDataUrl:e.$ngfBlobUrl,e);var o=i?e.$$ngfDataUrlPromise:e.$$ngfBlobUrlPromise;if(o)return o;var a=r.defer();return t(function(){if(window.FileReader&&e&&(!window.FileAPI||-1===navigator.userAgent.indexOf("MSIE 8")||e.size<2e4)&&(!window.FileAPI||-1===navigator.userAgent.indexOf("MSIE 9")||e.size<4e6)){var r=window.URL||window.webkitURL;if(r&&r.createObjectURL&&!i){var o;try{o=r.createObjectURL(e)}catch(u){return void t(function(){e.$ngfBlobUrl="",a.reject()})}t(function(){if(e.$ngfBlobUrl=o,o){a.resolve(o,e),n.blobUrls=n.blobUrls||[],n.blobUrlsTotalSize=n.blobUrlsTotalSize||0,n.blobUrls.push({url:o,size:e.size}),n.blobUrlsTotalSize+=e.size||0;for(var t=n.defaults.blobUrlsMaxMemory||268435456,i=n.defaults.blobUrlsMaxQueueSize||200;(n.blobUrlsTotalSize>t||n.blobUrls.length>i)&&n.blobUrls.length>1;){var u=n.blobUrls.splice(0,1)[0];r.revokeObjectURL(u.url),n.blobUrlsTotalSize-=u.size}}})}else{var s=new FileReader;s.onload=function(r){t(function(){e.$ngfDataUrl=r.target.result,a.resolve(r.target.result,e),t(function(){delete e.$ngfDataUrl},1e3)})},s.onerror=function(){t(function(){e.$ngfDataUrl="",a.reject()})},s.readAsDataURL(e)}}else t(function(){e[i?"$ngfDataUrl":"$ngfBlobUrl"]="",a.reject()})}),o=i?e.$$ngfDataUrlPromise=a.promise:e.$$ngfBlobUrlPromise=a.promise,o["finally"](function(){delete e[i?"$$ngfDataUrlPromise":"$$ngfBlobUrlPromise"]}),o},n}]),ngFileUpload.directive("ngfSrc",["Upload","$timeout",function(e,r){return{restrict:"AE",link:function(n,i,o){t(e,r,n,i,o,"ngfSrc",e.attrGetter("ngfResize",o,n),!1)}}}]),ngFileUpload.directive("ngfBackground",["Upload","$timeout",function(e,r){return{restrict:"AE",link:function(n,i,o){t(e,r,n,i,o,"ngfBackground",e.attrGetter("ngfResize",o,n),!0)}}}]),ngFileUpload.directive("ngfThumbnail",["Upload","$timeout",function(e,r){return{restrict:"AE",link:function(n,i,o){var a=e.attrGetter("ngfSize",o,n);t(e,r,n,i,o,"ngfThumbnail",a,e.attrGetter("ngfAsBackground",o,n))}}}]),ngFileUpload.config(["$compileProvider",function(e){e.imgSrcSanitizationWhitelist&&e.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|webcal|local|file|data|blob):/),e.aHrefSanitizationWhitelist&&e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|webcal|local|file|data|blob):/)}]),ngFileUpload.filter("ngfDataUrl",["UploadDataUrl","$sce",function(e,t){return function(r,n,i){if(angular.isString(r))return t.trustAsResourceUrl(r);var o=r&&((n?r.$ngfDataUrl:r.$ngfBlobUrl)||r.$ngfDataUrl);return r&&!o?(!r.$ngfDataUrlFilterInProgress&&angular.isObject(r)&&(r.$ngfDataUrlFilterInProgress=!0,e.dataUrl(r,n)),""):(r&&delete r.$ngfDataUrlFilterInProgress,(r&&o?i?t.trustAsResourceUrl(o):o:r)||"")}}])}(),ngFileUpload.service("UploadValidate",["UploadDataUrl","$q","$timeout",function(e,t,r){function n(e){var t="",r=[];if(e.length>2&&"/"===e[0]&&"/"===e[e.length-1])t=e.substring(1,e.length-1);else{var i=e.split(",");if(i.length>1)for(var o=0;o<i.length;o++){var a=n(i[o]);a.regexp?(t+="("+a.regexp+")",o<i.length-1&&(t+="|")):r=r.concat(a.excludes)}else 0===e.indexOf("!")?r.push("^((?!"+n(e.substring(1)).regexp+").)*$"):(0===e.indexOf(".")&&(e="*"+e),t="^"+e.replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g"),"\\$&")+"$",t=t.replace(/\\\*/g,".*").replace(/\\\?/g,"."))}return{regexp:t,excludes:r}}function i(e,t){null==t||e.$dirty||(e.$setDirty?e.$setDirty():e.$dirty=!0)}var o=e;return o.validatePattern=function(e,t){if(!t)return!0;var r=n(t),i=!0;if(r.regexp&&r.regexp.length){var o=new RegExp(r.regexp,"i");i=null!=e.type&&o.test(e.type)||null!=e.name&&o.test(e.name)}for(var a=r.excludes.length;a--;){var u=new RegExp(r.excludes[a],"i");i=i&&(null==e.type||u.test(e.type))&&(null==e.name||u.test(e.name))}return i},o.ratioToFloat=function(e){var t=e.toString(),r=t.search(/[x:]/i);return t=r>-1?parseFloat(t.substring(0,r))/parseFloat(t.substring(r+1)):parseFloat(t)},o.registerModelChangeValidator=function(e,t,r){e&&e.$formatters.push(function(n){if(e.$dirty){var i=n;n&&!angular.isArray(n)&&(i=[n]),o.validate(i,0,e,t,r).then(function(){o.applyModelValidation(e,i)})}return n})},o.applyModelValidation=function(e,t){i(e,t),angular.forEach(e.$ngfValidations,function(t){e.$setValidity(t.name,t.valid)})},o.getValidationAttr=function(e,t,r,n,i){var a="ngf"+r[0].toUpperCase()+r.substr(1),u=o.attrGetter(a,e,t,{$file:i});if(null==u&&(u=o.attrGetter("ngfValidate",e,t,{$file:i}))){var s=(n||r).split(".");u=u[s[0]],s.length>1&&(u=u&&u[s[1]])}return u},o.validate=function(e,r,n,i,a){function u(t,r,u){if(e){for(var s=e.length,l=null;s--;){var g=e[s];if(g){var p=o.getValidationAttr(i,a,t,r,g);null!=p&&(u(g,p,s)||(-1===c.indexOf(t)?(g.$error=t,(g.$errorMessages=g.$errorMessages||{})[t]=!0,g.$errorParam=p,-1===d.indexOf(g)&&d.push(g),f||e.splice(s,1),l=!1):e.splice(s,1)))}}null!==l&&n.$ngfValidations.push({name:t,valid:l})}}function s(r,u,s,g,p){function h(t,n,i){function o(o){if(o())if(-1===c.indexOf(r)){if(n.$error=r,(n.$errorMessages=n.$errorMessages||{})[r]=!0,n.$errorParam=i,-1===d.indexOf(n)&&d.push(n),!f){var a=e.indexOf(n);a>-1&&e.splice(a,1)}t.resolve(!1)}else{var u=e.indexOf(n);u>-1&&e.splice(u,1),t.resolve(!0)}else t.resolve(!0)}null!=i?g(n,i).then(function(e){o(function(){return!p(e,i)})},function(){o(function(){return l("ngfValidateForce",{$file:n})})}):t.resolve(!0)}var m=[o.emptyPromise(!0)];e&&(e=void 0===e.length?[e]:e,angular.forEach(e,function(e){var n=t.defer();return m.push(n.promise),!s||null!=e.type&&0===e.type.search(s)?void("dimensions"===r&&null!=o.attrGetter("ngfDimensions",i)?o.imageDimensions(e).then(function(t){h(n,e,l("ngfDimensions",{$file:e,$width:t.width,$height:t.height}))},function(){n.resolve(!1)}):"duration"===r&&null!=o.attrGetter("ngfDuration",i)?o.mediaDuration(e).then(function(t){h(n,e,l("ngfDuration",{$file:e,$duration:t}))},function(){n.resolve(!1)}):h(n,e,o.getValidationAttr(i,a,r,u,e))):void n.resolve(!0)}));var v=t.defer();return t.all(m).then(function(e){for(var t=!0,i=0;i<e.length;i++)if(!e[i]){t=!1;break}n.$ngfValidations.push({name:r,valid:t}),v.resolve(t)}),v.promise}n=n||{},n.$ngfValidations=n.$ngfValidations||[],angular.forEach(n.$ngfValidations,function(e){e.valid=!0});var l=function(e,t){return o.attrGetter(e,i,a,t)},c=(o.attrGetter("ngfIgnoreInvalid",i,a)||"").split(" "),f=o.attrGetter("ngfRunAllValidations",i,a);if(null==e||0===e.length)return o.emptyPromise({validFiles:e,invalidFiles:[]});e=void 0===e.length?[e]:e.slice(0);var d=[];u("pattern",null,o.validatePattern),u("minSize","size.min",function(e,t){return e.size+.1>=o.translateScalars(t)}),u("maxSize","size.max",function(e,t){return e.size-.1<=o.translateScalars(t)});var g=0;if(u("maxTotalSize",null,function(t,r){return g+=t.size,g>o.translateScalars(r)?(e.splice(0,e.length),!1):!0}),u("validateFn",null,function(e,t){return t===!0||null===t||""===t}),!e.length)return o.emptyPromise({validFiles:[],invalidFiles:d});var p=t.defer(),h=[];return h.push(s("maxHeight","height.max",/image/,this.imageDimensions,function(e,t){return e.height<=t})),h.push(s("minHeight","height.min",/image/,this.imageDimensions,function(e,t){return e.height>=t})),h.push(s("maxWidth","width.max",/image/,this.imageDimensions,function(e,t){return e.width<=t})),h.push(s("minWidth","width.min",/image/,this.imageDimensions,function(e,t){return e.width>=t})),h.push(s("dimensions",null,/image/,function(e,t){return o.emptyPromise(t)},function(e){return e})),h.push(s("ratio",null,/image/,this.imageDimensions,function(e,t){for(var r=t.toString().split(","),n=!1,i=0;i<r.length;i++)Math.abs(e.width/e.height-o.ratioToFloat(r[i]))<.01&&(n=!0);return n})),h.push(s("maxRatio","ratio.max",/image/,this.imageDimensions,function(e,t){return e.width/e.height-o.ratioToFloat(t)<1e-4})),h.push(s("minRatio","ratio.min",/image/,this.imageDimensions,function(e,t){return e.width/e.height-o.ratioToFloat(t)>-1e-4})),h.push(s("maxDuration","duration.max",/audio|video/,this.mediaDuration,function(e,t){return e<=o.translateScalars(t)})),h.push(s("minDuration","duration.min",/audio|video/,this.mediaDuration,function(e,t){return e>=o.translateScalars(t)})),h.push(s("duration",null,/audio|video/,function(e,t){return o.emptyPromise(t)},function(e){return e})),h.push(s("validateAsyncFn",null,null,function(e,t){return t},function(e){return e===!0||null===e||""===e})),t.all(h).then(function(){if(f)for(var t=0;t<e.length;t++){var n=e[t];n.$error&&e.splice(t--,1)}f=!1,u("maxFiles",null,function(e,t,n){return t>r+n}),p.resolve({validFiles:e,invalidFiles:d})}),p.promise},o.imageDimensions=function(e){if(e.$ngfWidth&&e.$ngfHeight){var n=t.defer();return r(function(){n.resolve({width:e.$ngfWidth,height:e.$ngfHeight})}),n.promise}if(e.$ngfDimensionPromise)return e.$ngfDimensionPromise;var i=t.defer();return r(function(){return 0!==e.type.indexOf("image")?void i.reject("not image"):void o.dataUrl(e).then(function(t){function n(){var t=u[0].naturalWidth||u[0].clientWidth,r=u[0].naturalHeight||u[0].clientHeight;u.remove(),e.$ngfWidth=t,e.$ngfHeight=r,i.resolve({width:t,height:r})}function o(){u.remove(),i.reject("load error")}function a(){r(function(){u[0].parentNode&&(u[0].clientWidth?n():s++>10?o():a())},1e3)}var u=angular.element("<img>").attr("src",t).css("visibility","hidden").css("position","fixed").css("max-width","none !important").css("max-height","none !important");u.on("load",n),u.on("error",o);var s=0;a(),angular.element(document.getElementsByTagName("body")[0]).append(u)},function(){i.reject("load error")})}),e.$ngfDimensionPromise=i.promise,e.$ngfDimensionPromise["finally"](function(){delete e.$ngfDimensionPromise}),e.$ngfDimensionPromise},o.mediaDuration=function(e){if(e.$ngfDuration){var n=t.defer();return r(function(){n.resolve(e.$ngfDuration)}),n.promise}if(e.$ngfDurationPromise)return e.$ngfDurationPromise;var i=t.defer();return r(function(){return 0!==e.type.indexOf("audio")&&0!==e.type.indexOf("video")?void i.reject("not media"):void o.dataUrl(e).then(function(t){function n(){var t=u[0].duration;e.$ngfDuration=t,u.remove(),i.resolve(t)}function o(){u.remove(),i.reject("load error")}function a(){r(function(){u[0].parentNode&&(u[0].duration?n():s>10?o():a())},1e3)}var u=angular.element(0===e.type.indexOf("audio")?"<audio>":"<video>").attr("src",t).css("visibility","none").css("position","fixed");u.on("loadedmetadata",n),u.on("error",o);var s=0;a(),angular.element(document.body).append(u)},function(){i.reject("load error")})}),e.$ngfDurationPromise=i.promise,e.$ngfDurationPromise["finally"](function(){delete e.$ngfDurationPromise}),e.$ngfDurationPromise},o}]),ngFileUpload.service("UploadResize",["UploadValidate","$q",function(e,t){var r=e,n=function(e,t,r,n,i){var o=i?Math.max(r/e,n/t):Math.min(r/e,n/t);return{width:e*o,height:t*o,marginX:e*o-r,marginY:t*o-n}},i=function(e,i,o,a,u,s,l,c){var f=t.defer(),d=document.createElement("canvas"),g=document.createElement("img");return g.setAttribute("style","visibility:hidden;position:fixed;z-index:-100000"),document.body.appendChild(g),g.onload=function(){var e=g.width,t=g.height;if(g.parentNode.removeChild(g),null!=c&&c(e,t)===!1)return void f.reject("resizeIf");try{if(s){var p=r.ratioToFloat(s),h=e/t;p>h?(i=e,o=i/p):(o=t,i=o*p)}i||(i=e),o||(o=t);var m=n(e,t,i,o,l);d.width=Math.min(m.width,i),d.height=Math.min(m.height,o);var v=d.getContext("2d");v.drawImage(g,Math.min(0,-m.marginX/2),Math.min(0,-m.marginY/2),m.width,m.height),f.resolve(d.toDataURL(u||"image/WebP",a||.934))}catch(b){f.reject(b)}},g.onerror=function(){g.parentNode.removeChild(g),f.reject()},g.src=e,f.promise};return r.dataUrltoBlob=function(e,t,r){for(var n=e.split(","),i=n[0].match(/:(.*?);/)[1],o=atob(n[1]),a=o.length,u=new Uint8Array(a);a--;)u[a]=o.charCodeAt(a);var s=new window.Blob([u],{type:i});return s.name=t,s.$ngfOrigSize=r,s},r.isResizeSupported=function(){var e=document.createElement("canvas");return window.atob&&e.getContext&&e.getContext("2d")&&window.Blob},r.isResizeSupported()&&Object.defineProperty(window.Blob.prototype,"name",{get:function(){return this.$ngfName},set:function(e){this.$ngfName=e},configurable:!0}),r.resize=function(e,n){if(0!==e.type.indexOf("image"))return r.emptyPromise(e);var o=t.defer();return r.dataUrl(e,!0).then(function(t){i(t,n.width,n.height,n.quality,n.type||e.type,n.ratio,n.centerCrop,n.resizeIf).then(function(i){if("image/jpeg"===e.type&&n.restoreExif!==!1)try{i=r.restoreExif(t,i)}catch(a){setTimeout(function(){throw a},1)}try{var u=r.dataUrltoBlob(i,e.name,e.size);o.resolve(u)}catch(a){o.reject(a)}},function(t){"resizeIf"===t&&o.resolve(e),o.reject(t)})},function(e){o.reject(e)}),o.promise},r}]),function(){function e(e,r,n,i,o,a,u,s,l,c){function f(){return r.attr("disabled")||b("ngfDropDisabled",e)}function d(t,r,n){if(t){var i;try{i=t&&t.getData&&t.getData("text/html")}catch(o){}m(t.items,t.files,b("ngfAllowDir",e)!==!1,b("multiple")||b("ngfMultiple",e)).then(function(e){e.length?g(e,r):p(n,i).then(function(e){g(e,r)})})}}function g(t,r){s.updateModel(i,n,e,b("ngfChange")||b("ngfDrop"),t,r)}function p(t,r){if(!s.shouldUpdateOn(t,n,e)||"string"!=typeof r)return s.rejectPromise([]);var i=[];r.replace(/<(img src|img [^>]* src) *=\"([^\"]*)\"/gi,function(e,t,r){i.push(r)});var o=[],a=[];if(i.length){angular.forEach(i,function(e){o.push(s.urlToBlob(e).then(function(e){a.push(e)}))});var u=c.defer();return c.all(o).then(function(){u.resolve(a)},function(e){u.reject(e)}),u.promise}return s.emptyPromise()}function h(e,t,r,n){var i=b("ngfDragOverClass",e,{$event:r}),o="dragover";if(angular.isString(i))o=i;else if(i&&(i.delay&&(U=i.delay),i.accept||i.reject)){var a=r.dataTransfer.items;if(null!=a&&a.length)for(var u=i.pattern||b("ngfPattern",e,{$event:r}),l=a.length;l--;){if(!s.validatePattern(a[l],u)){o=i.reject;break}o=i.accept}else o=i.accept}n(o)}function m(t,r,i,o){function a(e,t){var r=c.defer();if(null!=e)if(e.isDirectory){var n=[s.emptyPromise()];if(d){var i={type:"directory"};i.name=i.path=(t||"")+e.name,g.push(i)}var o=e.createReader(),u=[],h=function(){o.readEntries(function(i){try{i.length?(u=u.concat(Array.prototype.slice.call(i||[],0)),h()):(angular.forEach(u.slice(0),function(r){g.length<=l&&f>=p&&n.push(a(r,(t?t:"")+e.name+"/"))}),c.all(n).then(function(){r.resolve()},function(e){r.reject(e)}))}catch(o){r.reject(o)}},function(e){r.reject(e)})};h()}else e.file(function(e){try{e.path=(t?t:"")+e.name,d&&(e=s.rename(e,e.path)),g.push(e),p+=e.size,r.resolve()}catch(n){r.reject(n)}},function(e){r.reject(e)});return r.promise}var l=s.getValidationAttr(n,e,"maxFiles");null==l&&(l=Number.MAX_VALUE);var f=s.getValidationAttr(n,e,"maxTotalSize");null==f&&(f=Number.MAX_VALUE);var d=b("ngfIncludeDir",e),g=[],p=0,h=[s.emptyPromise()];if(t&&t.length>0&&"file:"!==u.location.protocol)for(var m=0;m<t.length;m++){if(t[m].webkitGetAsEntry&&t[m].webkitGetAsEntry()&&t[m].webkitGetAsEntry().isDirectory){var v=t[m].webkitGetAsEntry();if(v.isDirectory&&!i)continue;null!=v&&h.push(a(v))}else{var y=t[m].getAsFile();null!=y&&(g.push(y),p+=y.size)}if(g.length>l||p>f||!o&&g.length>0)break}else if(null!=r)for(var $=0;$<r.length;$++){var S=r.item($);if((S.type||S.size>0)&&(g.push(S),p+=S.size),g.length>l||p>f||!o&&g.length>0)break}var U=c.defer();return c.all(h).then(function(){if(o||d||!g.length)U.resolve(g);else{for(var e=0;g[e]&&"directory"===g[e].type;)e++;U.resolve([g[e]])}},function(e){U.reject(e)}),U.promise}var v=t(),b=function(e,t,r){return s.attrGetter(e,n,t,r)};if(b("dropAvailable")&&a(function(){e[b("dropAvailable")]?e[b("dropAvailable")].value=v:e[b("dropAvailable")]=v}),!v)return void(b("ngfHideOnDropNotAvailable",e)===!0&&r.css("display","none"));null==b("ngfSelect")&&s.registerModelChangeValidator(i,n,e);var y,$=null,S=o(b("ngfStopPropagation")),U=1;r[0].addEventListener("dragover",function(t){if(!f()&&s.shouldUpdateOn("drop",n,e)){if(t.preventDefault(),S(e)&&t.stopPropagation(),navigator.userAgent.indexOf("Chrome")>-1){var i=t.dataTransfer.effectAllowed;t.dataTransfer.dropEffect="move"===i||"linkMove"===i?"move":"copy"}a.cancel($),y||(y="C",h(e,n,t,function(n){y=n,r.addClass(y),b("ngfDrag",e,{$isDragging:!0,$class:y,$event:t})}))}},!1),r[0].addEventListener("dragenter",function(t){!f()&&s.shouldUpdateOn("drop",n,e)&&(t.preventDefault(),S(e)&&t.stopPropagation())},!1),r[0].addEventListener("dragleave",function(t){!f()&&s.shouldUpdateOn("drop",n,e)&&(t.preventDefault(),
S(e)&&t.stopPropagation(),$=a(function(){y&&r.removeClass(y),y=null,b("ngfDrag",e,{$isDragging:!1,$event:t})},U||100))},!1),r[0].addEventListener("drop",function(t){!f()&&s.shouldUpdateOn("drop",n,e)&&(t.preventDefault(),S(e)&&t.stopPropagation(),y&&r.removeClass(y),y=null,d(t.dataTransfer,t,"dropUrl"))},!1),r[0].addEventListener("paste",function(t){navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&b("ngfEnableFirefoxPaste",e)&&t.preventDefault(),!f()&&s.shouldUpdateOn("paste",n,e)&&d(t.clipboardData||t.originalEvent.clipboardData,t,"pasteUrl")},!1),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&b("ngfEnableFirefoxPaste",e)&&(r.attr("contenteditable",!0),r.on("keypress",function(e){e.metaKey||e.ctrlKey||e.preventDefault()}))}function t(){var e=document.createElement("div");return"draggable"in e&&"ondrop"in e&&!/Edge\/12./i.test(navigator.userAgent)}ngFileUpload.directive("ngfDrop",["$parse","$timeout","$window","Upload","$http","$q",function(t,r,n,i,o,a){return{restrict:"AEC",require:"?ngModel",link:function(u,s,l,c){e(u,s,l,c,t,r,n,i,o,a)}}}]),ngFileUpload.directive("ngfNoFileDrop",function(){return function(e,r){t()&&r.css("display","none")}}),ngFileUpload.directive("ngfDropAvailable",["$parse","$timeout","Upload",function(e,r,n){return function(i,o,a){if(t()){var u=e(n.attrGetter("ngfDropAvailable",a));r(function(){u(i),u.assign&&u.assign(i,!0)})}}}])}(),ngFileUpload.service("UploadExif",["UploadResize","$q",function(e,t){function r(e,t,r,n){switch(t){case 2:return e.transform(-1,0,0,1,r,0);case 3:return e.transform(-1,0,0,-1,r,n);case 4:return e.transform(1,0,0,-1,0,n);case 5:return e.transform(0,1,1,0,0,0);case 6:return e.transform(0,1,-1,0,n,0);case 7:return e.transform(0,-1,-1,0,n,r);case 8:return e.transform(0,-1,1,0,0,r)}}function n(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;n>i;i++)t+=String.fromCharCode(r[i]);return window.btoa(t)}var i=e;return i.isExifSupported=function(){return window.FileReader&&(new FileReader).readAsArrayBuffer&&i.isResizeSupported()},i.readOrientation=function(e){var r=t.defer(),n=new FileReader,i=e.slice?e.slice(0,65536):e;return n.readAsArrayBuffer(i),n.onerror=function(e){return r.reject(e)},n.onload=function(e){var t={orientation:1},n=new DataView(this.result);if(65496!==n.getUint16(0,!1))return r.resolve(t);for(var i=n.byteLength,o=2;i>o;){var a=n.getUint16(o,!1);if(o+=2,65505===a){if(1165519206!==n.getUint32(o+=2,!1))return r.resolve(t);var u=18761===n.getUint16(o+=6,!1);o+=n.getUint32(o+4,u);var s=n.getUint16(o,u);o+=2;for(var l=0;s>l;l++)if(274===n.getUint16(o+12*l,u)){var c=n.getUint16(o+12*l+8,u);return c>=2&&8>=c&&(n.setUint16(o+12*l+8,1,u),t.fixedArrayBuffer=e.target.result),t.orientation=c,r.resolve(t)}}else{if(65280!==(65280&a))break;o+=n.getUint16(o,!1)}}return r.resolve(t)},r.promise},i.applyExifRotation=function(e){if(0!==e.type.indexOf("image/jpeg"))return i.emptyPromise(e);var o=t.defer();return i.readOrientation(e).then(function(t){return t.orientation<2||t.orientation>8?o.resolve(e):void i.dataUrl(e,!0).then(function(a){var u=document.createElement("canvas"),s=document.createElement("img");s.onload=function(){try{u.width=t.orientation>4?s.height:s.width,u.height=t.orientation>4?s.width:s.height;var a=u.getContext("2d");r(a,t.orientation,s.width,s.height),a.drawImage(s,0,0);var l=u.toDataURL(e.type||"image/WebP",.934);l=i.restoreExif(n(t.fixedArrayBuffer),l);var c=i.dataUrltoBlob(l,e.name);o.resolve(c)}catch(f){return o.reject(f)}},s.onerror=function(){o.reject()},s.src=a},function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise},i.restoreExif=function(e,t){var r={};return r.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r.encode64=function(e){var t,r,n,i,o,a="",u="",s="",l=0;do t=e[l++],r=e[l++],u=e[l++],n=t>>2,i=(3&t)<<4|r>>4,o=(15&r)<<2|u>>6,s=63&u,isNaN(r)?o=s=64:isNaN(u)&&(s=64),a=a+this.KEY_STR.charAt(n)+this.KEY_STR.charAt(i)+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(s),t=r=u="",n=i=o=s="";while(l<e.length);return a},r.restore=function(e,t){e.match("data:image/jpeg;base64,")&&(e=e.replace("data:image/jpeg;base64,",""));var r=this.decode64(e),n=this.slice2Segments(r),i=this.exifManipulation(t,n);return"data:image/jpeg;base64,"+this.encode64(i)},r.exifManipulation=function(e,t){var r=this.getExifArray(t),n=this.insertExif(e,r);return new Uint8Array(n)},r.getExifArray=function(e){for(var t,r=0;r<e.length;r++)if(t=e[r],255===t[0]&225===t[1])return t;return[]},r.insertExif=function(e,t){var r=e.replace("data:image/jpeg;base64,",""),n=this.decode64(r),i=n.indexOf(255,3),o=n.slice(0,i),a=n.slice(i),u=o;return u=u.concat(t),u=u.concat(a)},r.slice2Segments=function(e){for(var t=0,r=[];;){if(255===e[t]&218===e[t+1])break;if(255===e[t]&216===e[t+1])t+=2;else{var n=256*e[t+2]+e[t+3],i=t+n+2,o=e.slice(t,i);r.push(o),t=i}if(t>e.length)break}return r},r.decode64=function(e){var t,r,n,i,o,a="",u="",s=0,l=[],c=/[^A-Za-z0-9\+\/\=]/g;c.exec(e)&&console.log("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, NaNExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=this.KEY_STR.indexOf(e.charAt(s++)),i=this.KEY_STR.indexOf(e.charAt(s++)),o=this.KEY_STR.indexOf(e.charAt(s++)),u=this.KEY_STR.indexOf(e.charAt(s++)),t=n<<2|i>>4,r=(15&i)<<4|o>>2,a=(3&o)<<6|u,l.push(t),64!==o&&l.push(r),64!==u&&l.push(a),t=r=a="",n=i=o=u="";while(s<e.length);return l},r.restore(e,t)},i}]),window.Util=function(){"use strict";function e(e,t,r){return console.log("in authenticate!!!!"),t(e.user?function(t){t(e.user)}:function(t){r.currentUser().then(function(r){e.user=r,t(r)},function(r){"no-auth"==r?(e.setStateAfterLogin(),e.$state.go("login")):e.$state.go("error"),t(null)})})}function t(t,r,n){return e(t,r,n).then(function(e){return null==e||e.admin?e:(console.log("unauthorized access"),t.$state.go("error"),null)})}function r(e){return e.line1==u.line1&&e.city==u.city&&e.state==u.state&&e.zip==u.zip}function n(e){return e.line1==s.line1&&e.city==s.city&&e.state==s.state&&e.zip==s.zip}function i(e,t){var r=$("#errorModal");r.find(".modal-body").html(e),r.find(".modal-title").text(t||"Error"),r.modal("show")}function o(e,t,r){var n=document.createElement("a");if(navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([e],{type:t}),r);if("download"in n)return n.href="data:"+t+","+encodeURIComponent(e),n.setAttribute("download",r),document.body.appendChild(n),n.click(),document.body.removeChild(n),!0;var i=document.createElement("iframe");return document.body.appendChild(i),i.src="data:"+t+","+encodeURIComponent(e),setTimeout(function(){document.body.removeChild(i)},333),!0}function a(e){return void 0==e||null==e||""===e}var u={line1:"2695 Creve Coeur Mill Rd",city:"Maryland Heights",state:"MO",zip:63043},s={line1:"4701 State Route 111",city:"Granite City",state:"IL",zip:62040};return{authenticate:["$rootScope","$q","graceGroupsService",e],authenticateAdmin:["$rootScope","$q","graceGroupsService",t],graceWestAddress:u,graceEastAddress:s,isGraceWestCampus:r,isGraceEastCampus:n,alert:i,downloadContent:o,isEmpty:a}}(),angular.module("angularPromiseButtons",[]),angular.module("angularPromiseButtons").directive("promiseBtn",["angularPromiseButtons","$parse","$timeout","$compile",function(e,t,r,n){"use strict";return{restrict:"EA",priority:e.config.priority,scope:{promiseBtn:"=",promiseBtnOptions:"=?"},link:function(i,o,a){function u(e){console.log("in init loading state"),y.btnLoadingClass&&!y.addClassToCurrentBtnOnly&&e.addClass(y.btnLoadingClass),y.disableBtn&&!y.disableCurrentBtnOnly&&e.attr("disabled","disabled")}function s(e){y.minDuration&&!v||!b||(y.btnLoadingClass&&e.removeClass(y.btnLoadingClass),y.disableBtn&&e.removeAttr("disabled"))}function l(e,t){i.$watch(e,function(e){v=!1,b=!1,y.minDuration&&(m=r(function(){v=!0,s(t)},y.minDuration)),e&&e.then?(u(t),e["finally"](function(){b=!0,s(t)})):e&&e.$promise&&(u(t),e.$promise["finally"](function(){b=!0,s(t)}))})}function c(e){return e.split(";").map(function(e){return t(e)})}function f(e){e.append(n(y.spinnerTpl)(i))}function d(e){y.addClassToCurrentBtnOnly&&e.on(y.CLICK_EVENT,function(){e.addClass(y.btnLoadingClass)}),y.disableCurrentBtnOnly&&e.on(y.CLICK_EVENT,function(){e.attr("disabled","disabled")})}function g(e,t,r){i.$evalAsync(function(){var n=c(a[t]);o.unbind(e),o.bind(e,function(){i.$apply(function(){n.forEach(function(t){var n=t(i.$parent,{$event:e});h||(h=l(function(){return n},r))})})})})}function p(e){for(var t=[],r=e.find("button"),n=0;n<r.length;n++){var i=r[n];"submit"===angular.element(i).attr("type")&&t.push(i)}return angular.element(t)}console.log("in link");var h,m,v,b,y=e.config;if(a.promiseBtn)console.log("specific promise"),f(o),d(o),l(function(){return i.promiseBtn},o);else if(console.log("no specific promise"),a.hasOwnProperty(y.CLICK_ATTR))f(o),d(o),g(y.CLICK_EVENT,y.CLICK_ATTR,o);else if(a.hasOwnProperty(y.SUBMIT_ATTR)){var $=p(o);f($),d($),g(y.SUBMIT_EVENT,y.SUBMIT_ATTR,$)}i.$watch("promiseBtnOptions",function(e){angular.isObject(e)&&(y=angular.extend({},y,e))},!0),i.$on("$destroy",function(){r.cancel(m)})}}}]),angular.module("angularPromiseButtons").provider("angularPromiseButtons",function(){"use strict";var e={spinnerTpl:'<span class="btn-spinner"></span>',priority:0,disableBtn:!0,btnLoadingClass:"is-loading",addClassToCurrentBtnOnly:!1,disableCurrentBtnOnly:!1,minDuration:!1,CLICK_EVENT:"click",CLICK_ATTR:"ngClick",SUBMIT_EVENT:"submit",SUBMIT_ATTR:"ngSubmit"};return{extendConfig:function(t){e=angular.extend(e,t)},$get:function(){return{config:e}}}}),function(e){"use strict";function t(e,t){var r=this;r.email="",r.password="",r.login=function(){t.login({email:r.email,password:r.password}).then(function(t){e.user=t,e.goToStateAfterLoginOr("users.home")},function(t){e.user=null,"invalid-login"==t?r.invalidLogin=!0:Util.alert("Login failed. Please try again.")})}}function r(e,t,r,n){var i=this;i.logout=function(){e.logout(),t.user=null,r.go("login")},i.isProfilePage=function(){return r.includes("users.home")||r.includes("users.details")&&t.user&&t.user.id==n.id}}function n(e,t,r){function n(e){return void 0!=e&&null!=e&&""!=e.trim()}return e.filter(function(e){var i=!n(t)||e.firstName.toLowerCase().indexOf(t.toLowerCase())>=0,o=!n(r)||e.lastName.toLowerCase().indexOf(r.toLowerCase())>=0;return i&&o})}e.module("grace-groups",["gg.common","groups","graceGroupsService","authorizer"]),e.module("grace-groups-admin",["ngFileUpload","gg.common","ui.router","users","groups","graceGroupsService","authorizer","ngConstants"]).config(["$stateProvider","$urlRouterProvider","partialPath",function(e,r,n){r.otherwise("/users/home"),e.state("login",{url:"/login",templateUrl:n+"/login-form.html",controller:["$rootScope","graceGroupsService",t],controllerAs:"$ctrl"}).state("error",{templateUrl:n+"/error.html"})}]).run(["$rootScope","$state","$stateParams","authorizer",function(e,t,r,n){e.$state=t,e.$stateParams=r,e.authorizer=n,e.$on("$stateChangeError",function(e,r,n,i,o,a){e.preventDefault(),console.log("something went wrong - ",a),t.go("error")}),e.$on("$stateChangeSuccess",function(t,r,n,i,o){var a=$(".navbar-toggle");a.hasClass("collapsed")||a.click(),e.previousState={name:i,params:o}}),e.$on("$stateChangeStart",function(t,r,n){console.log("state change start",r),e.requestedState={name:r.name,params:$.extend({},n)}}),e.setGroupEditReturnToState=function(){e.groupEditReturnToState={name:t.current.name,params:$.extend({},r)}},e.goToGroupEditReturnToState=function(){void 0!=e.groupEditReturnToState?t.go(e.groupEditReturnToState.name,e.groupEditReturnToState.params):t.go("groups.index"),e.groupEditReturnToState=void 0},e.setUserEditReturnToState=function(){e.userEditReturnToState={name:t.current.name,params:$.extend({},r)}},e.goToUserEditReturnToState=function(){void 0!=e.userEditReturnToState?t.go(e.userEditReturnToState.name,e.userEditReturnToState.params):t.go("users.home"),e.userEditReturnToState=void 0},e.setGroupMemberReturnToState=function(){e.groupMemberReturnToState={name:t.current.name,params:$.extend({},r)}},e.goToGroupMemberReturnToState=function(){void 0!=e.groupMemberReturnToState?t.go(e.groupMemberReturnToState.name,e.groupMemberReturnToState.params):t.go("groups.index"),e.groupMemberReturnToState=void 0},e.setStateAfterLogin=function(){e.stateAfterLogin=e.requestedState},e.goToStateAfterLoginOr=function(r){console.log("state after login",e.stateAfterLogin),void 0!=e.stateAfterLogin?(t.go(e.stateAfterLogin.name,e.stateAfterLogin.params),e.stateAfterLogin=void 0):t.go(r)},e.hasError=function(e){return console.log("does it have an error",e.$invalid),!1}}]).component("ggNav",{templateUrl:["partialPath",function(e){return e+"/nav.html"}],controller:["graceGroupsService","$rootScope","$state","$stateParams",r]}).directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(e,t,r,n){n.$validators.compareTo=function(t){return t==e.otherModelValue},e.$watch("otherModelValue",function(){n.$validate()})}}}).directive("notEqualTo",function(){return{require:"ngModel",scope:{otherModelValue:"=notEqualTo"},link:function(e,t,r,n){n.$validators.notEqualTo=function(t){return void 0==t||""==t?!0:t!=e.otherModelValue},e.$watch("otherModelValue",function(){n.$validate()})}}}).directive("timeAfter",function(){return{require:"ngModel",scope:{otherModelValue:"=timeAfter"},link:function(e,t,r,n){n.$validators.timeAfter=function(t){return null==e.otherModelValue?!0:moment(t).isAfter(moment(e.otherModelValue))},e.$watch("otherModelValue",function(){n.$validate()})}}}).directive("requiredIfNotOther",function(){return{require:"ngModel",scope:{otherModelValue:"=requiredIfNotOther"},link:function(e,t,r,n){n.$validators.requiredIfNotOther=function(t){return!(Util.isEmpty(e.otherModelValue)&&Util.isEmpty(t))},e.$watch("otherModelValue",function(){n.$validate()})}}}).directive("serverValidation",function(){return{require:"ngModel",link:function(e,t,r,n){n.$validators.serverValidation=function(){return!0}}}}).filter("filterByUserName",function(){return n}).filter("hasError",function(){return hasError}).directive("scrollPos",["$state","$window","$timeout","$location","$anchorScroll",function(e,t,r,n,i){var o={};return function(a,u,s){a.$on("$stateChangeStart",function(){"keep"==s.scrollPos&&e.current&&(console.log(e.current.templateUrl),o[e.current.templateUrl]=[t.pageXOffset,t.pageYOffset])}),a.$on("$stateChangeSuccess",function(){if(n.hash())i();else{var a=o[e.current.templateUrl]||[0,0];r(function(){t.scrollTo(a[0],a[1])},0)}})}}])}(window.angular),function(e){"use strict";function t(e,t){var r=t.find(".modal");e.noLabel=e.noLabel||"Cancel",e.yesLabel=e.yesLabel||"Yes",e.modalId=e.modalId||"confirm",e.yesClick=function(){console.log("clicked yes"),r.off("hidden.bs.modal").on("hidden.bs.modal",function(){e.onYes()}),r.modal("hide")},e.noClick=function(){console.log("clicked no"),r.off("hidden.bs.modal").on("hidden.bs.modal",function(){e.onNo()}),r.modal("hide")}}function r(e,t){function r(){e.imageFile=null,e.invalid=null,e.clearImage=!1,e.$apply()}var n=t.find(".modal");n.on("show.bs.modal",r),e.modalId=e.modalId||"image-chooser",e.saveClick=function(){e.clearImage?n.off("hidden.bs.modal").on("hidden.bs.modal",function(){e.onClearImage()}):n.off("hidden.bs.modal").on("hidden.bs.modal",function(){e.onSaveImage({file:e.imageFile})}),n.modal("hide")},e.none=function(){e.clearImage=!0,e.imageFile=null},e.selected=function(){e.clearImage=!1}}function n(e){return"GRACE_HAVE_ROOM"==e?"Grace, room assigned":"GRACE_NEED_ROOM"==e?"Grace, need room":"CHILDCARE_PROVIDED"==e?"Provided":"SINGLES_AND_COUPLES"==e?"Mixed single and married":"MARRIEDS"==e?"Married":"SINGLES"==e?"Single":S(e).humanize().s}e.module("gg.common",["ngConstants","ui.router","users"]).filter("enumToLabel",function(){return n}).filter("leaderMailTo",function(){return function(e,t){return"mailto:"+e.leader.email+"?"+(null!=e.secondaryLeader?"cc="+e.secondaryLeader.email+"&":"")+"subject="+t}}).filter("orDefaultImage",["imagesPath",function(e){return function(t){return Util.isEmpty(t)?e+"/noImage.png":t}}]).directive("confirmBox",["partialPath",function(e){return{restrict:"E",scope:{title:"@",noLabel:"@",yesLabel:"@",onNo:"&",onYes:"&",modalId:"@"},templateUrl:e+"/confirm.html",transclude:!0,link:t}}]).directive("imageChooser",["partialPath",function(e){return{restrict:"E",scope:{title:"@",onClearImage:"&",onSaveImage:"&",modalId:"@",currentImage:"="},templateUrl:e+"/image-chooser.html",link:r}}])}(window.angular),function(e){"use strict";function t(e,t,r,n,i){function o(t){t=t&&t>0?t:1;var r=t*n;a.page=t-1;var i=e.usersByName(a.searchFirstNameText||"",a.searchLastNameText||"",0,r).then(function(e){a.users=e,a.isFiltered=a.searchFirstNameText&&""!=a.searchFirstNameText||a.searchLastNameText&&""!=a.searchLastNameText});return e.countUsersByName(a.searchFirstNameText||"",a.searchLastNameText||"").then(function(e){a.totalCount=e}),i}var a=this;a.users=t,a.totalCount=r,a.isFiltered=!1,a.page=0,i.setUserEditReturnToState(),a.search=function(){return o()},a.showMore=function(){return a.page++,e.usersByName(a.searchFirstNameText||"",a.searchLastNameText||"",a.page,n).then(function(e){Array.prototype.push.apply(a.users,e)})},a.showMoreCount=function(){var e=a.totalCount-a.users.length;return e>n?n:e},a.clearSearch=function(){a.searchFirstNameText="",a.searchLastNameText="",a.search()},a.noUsers=function(){return 0==a.users.length},a.deleteUser=function(t){e.deleteUser(t).then(function(){o(a.page+1)},function(e){console.log(e);var t=[];e.indexOf("user-in-groups-not-deletable")>=0&&t.push("The user is associated to one or more groups."),e.indexOf("user-as-manager-not-deletable")>=0&&(t.push("The user is the manager of one or more users."),Util.alert("The user cannot be deleted because it either contains direct reports or has group associations. Please remove all associations first.")),console.log("can't remove reasons",t),t.length>0?Util.alert(t.join("<br/>"),"The user cannot be deleted"):Util.alert("Failed to delete the user. Please try again later.")})}}function r(e){var t=this;t.deleteIcon=t.deleteIcon||"trash",t.uploadImage=function(r){e.uploadUserImage(t.user.id,r).then(function(e){t.user.imageUrl=e.imageUrl},function(e){e.indexOf("invalid-image-file")>=0?Util.alert("Could not save the image. Invalid file type.","Invalid image"):Util.alert("Failed to save the image. Please try again later.")})},t.clearImage=function(){var r=t.user.imageUrl;t.user.imageUrl=null,e.updateUser(t.user).then(null,function(e){console.log(e),t.user.imageUrl=r,Util.alert("Failed to clear the image for this user. Please try again later.")})}}function n(e,t,r){function n(e,t){var r=!1;t.forEach&&t.forEach(function(t){"user-email-not-unique"==t&&(e.uEmail.$error.serverValidation=!0,e.uEmail.$error.serverError="already used",r=!0),"user-role-reduction-conflict"==t&&(e.uRole.$error.serverValidation=!0,e.uRole.$error.serverError="This role is not applicable for current direct reports.",r=!0)}),r?Util.alert("Please correct errors indicated in red.","Info"):Util.alert("Failed to save the user. Please try again later.")}var i=this;i.managers=i.managers||[],i.availableManagers=[],i.roles=r.rolesAssignableBy(e.user,e.user.id==i.user.id),1==i.roles.length&&(i.user.role=i.roles[0].code),i.noPreviousPassword="CONTACT"==i.user.role,i.handleRoleChange=function(){"ADMIN"!=i.user.role&&"PASTOR"!=i.user.role||(i.user.admin=!0),i.determineAvailableManagers()},i.determineAvailableManagers=function(){var e=[];switch(i.user.role){case"CONTACT":case"GROUP_LEADER":e.push("DIVISION_LEADER");case"DIVISION_LEADER":e.push("DIVISION_DIRECTOR");case"DIVISION_DIRECTOR":e.push("PASTOR")}i.availableManagers=i.managers.filter(function(t){return e.indexOf(t.role)>=0&&t.id!=i.user.id}),0==i.availableManagers.filter(function(e){return e.id==i.user.managerId}).length&&(i.user.managerId=null)},i.determineAvailableManagers(),i.isNew=null==i.user.id||void 0==i.user.id,(i.isNew||i.startWithChangePassword)&&"CONTACT"!=i.user.role&&(i.changePassword=!0),i.needsManager=function(){return"PASTOR"!=i.user.role&&"CONTACT"!=i.user.role&&"ADMIN"!=i.user.role},i.save=function(e){if(e.$valid)return null==i.user.id?t.createUser(i.user).then(function(e){i.user.id=e.id,i.onSave()},function(t){n(e,t)}):t.updateUser(i.user).then(i.onSave,function(t){n(e,t)});var r=$(".has-error:first");return r.length>0&&$("html, body").animate({scrollTop:r.offset().top},500),Util.alert("Please correct errors indicated in red.","Info"),null}}function i(e,t,r,n,i){var o=this;o.changePassword=i,o.user=e,o.managers=t,o.cancel=function(){r.goToUserEditReturnToState()},o.afterSave=function(){o.isRootUser()&&null!=o.user.newPassword&&""!=o.user.newPassword?n.login({email:o.user.email,password:o.user.newPassword}).then(function(e){r.user=e,r.goToUserEditReturnToState()},function(){r.user=null,r.$state.go("login")}):r.goToUserEditReturnToState()},o.isRootUser=function(){return o.user.id==r.user.id}}function o(e,t,r,n,i,o){var a=this;a.user=e,a.groups=r,a.directReports=n,i.setUserEditReturnToState(),i.setGroupEditReturnToState(),i.setGroupMemberReturnToState(),a.isRootUser=function(){return a.user.id==t.id},a.deleteGroup=function(e){o.deleteGroup(e).then(function(){a.groups.splice(a.groups.indexOf(e),1)})}}function a(e){var t=this;t.user={},t.managers=e}e.module("users",["ui.router","angularPromiseButtons","ngConstants"]).config(["$stateProvider","partialPath",function(e,r){e.state("users",{url:"/users","abstract":!0,template:"<ui-view></ui-view>",resolve:{authUser:Util.authenticate}}).state("users.index",{url:"",templateUrl:r+"/users/index.html",resolve:{limit:function(){return 10},users:["graceGroupsService","limit",function(e,t){return e.usersByName("","",0,t)}],totalCount:["graceGroupsService",function(e){return e.countUsersByName("","")}]},controller:["graceGroupsService","users","totalCount","limit","$rootScope",t],controllerAs:"$ctrl"}).state("users.edit",{url:"/{id:int}/edit",templateUrl:r+"/users/edit.html",resolve:{user:["graceGroupsService","$stateParams","authUser",function(e,t){return e.user(t.id)}],managers:["graceGroupsService","authUser",function(e){return e.managers()}]},controller:["user","managers","$rootScope","graceGroupsService",i],controllerAs:"$ctrl"}).state("users.editAndChangePassword",{url:"/{id:int}/editAndChangePassword",templateUrl:r+"/users/edit.html",resolve:{user:["graceGroupsService","$stateParams","authUser",function(e,t){return e.user(t.id)}],managers:["graceGroupsService","authUser",function(e){return e.managers()}],changePassword:function(){return!0}},controller:["user","managers","$rootScope","graceGroupsService","changePassword",i],controllerAs:"$ctrl"}).state("users.details",{url:"/{id:int}/details",templateUrl:r+"/users/details.html",resolve:{user:["graceGroupsService","$stateParams",function(e,t){return e.user(t.id)}],groups:["graceGroupsService","$stateParams",function(e,t){return e.groupsForUser(t.id)}],directReports:["graceGroupsService","$stateParams",function(e,t){return e.directReports(t.id)}]},controller:["user","authUser","groups","directReports","$rootScope","graceGroupsService",o],controllerAs:"$ctrl"}).state("users.home",{url:"/home",templateUrl:r+"/users/details.html",resolve:{user:["graceGroupsService","authUser",function(e,t){return e.user(t.id)}],groups:["graceGroupsService","authUser",function(e,t){return e.groupsForUser(t.id)}],directReports:["graceGroupsService","authUser",function(e,t){return e.directReports(t.id)}]},controller:["user","authUser","groups","directReports","$rootScope","graceGroupsService",o],controllerAs:"$ctrl"}).state("users.new",{url:"/new",templateUrl:r+"/users/new.html",resolve:{managers:["graceGroupsService",function(e){return e.managers()}]},controller:["managers",a],controllerAs:"$ctrl"})}]).component("ggUser",{templateUrl:["partialPath",function(e){return e+"/users/view.html"}],bindings:{user:"<",hideRole:"@",onEdit:"&",showEdit:"<",onSelect:"&",showSelect:"<",onRemove:"&",showRemove:"<",confirmRemove:"<",badge:"<",deleteIcon:"@",highlight:"@"},controller:["graceGroupsService",r]}).component("ggUserForm",{templateUrl:["partialPath",function(e){return e+"/users/userForm.html"}],bindings:{user:"<",onSave:"&",onCancel:"&",noRoleChange:"@",managers:"<",startWithChangePassword:"<"},controller:["$rootScope","graceGroupsService","authorizer",n]})}(window.angular),function(e){"use strict";function t(e,t){var r=this;e.setGroupEditReturnToState(),e.setGroupMemberReturnToState(),r.download=function(){t.groupExport().then(function(e){Util.downloadContent(e,"text/csv","groups.csv")},function(){Util.alert("Failed to download the groups. Please try again later.")})}}function r(e,t,r){function n(e){return i.options&&i.options.split(" ").includes(e)}var i=this;i.leaderDisplay=function(){return d(i.group)},i.scheduleDisplay=function(){return g(i.group.schedule)},i.timeDisplay=function(){return h(i.group.schedule)},i.ageDisplay=function(){return m(i.group)},i.onGraceWestCampus=function(){return Util.isGraceWestCampus(i.group.address)},i.onGraceEastCampus=function(){return Util.isGraceEastCampus(i.group.address)},i.showEdit=function(){return n("edit")},i.showDelete=function(){return n("delete")},i.downloadCalendar=function(){var r=null==t.user?e.publishedGroupCalendarExport:e.groupCalendarExport;r.call(this,i.group.id).then(function(e){Util.downloadContent(e,"text/calendar","group-calendar.ics")},function(){Util.alert("Failed to download the group calendar. Please try again later.")})},i.$onInit=function(){r.find('[data-toggle="tooltip"]').tooltip({trigger:"hover"})},i.showStreetAddress=function(){return t.user||i.onGraceWestCampus()||i.onGraceEastCampus()}}function n(e,t){function r(e){e=e&&e>0?e:1,o.searchCriteria.limit=e*o.resultLimit,o.searchCriteria.page=0,o.searchCriteria.startTimeDate?o.searchCriteria.startTime=moment(o.searchCriteria.startTimeDate).format("HH:mm"):delete o.searchCriteria.startTime,"ALL"==o.ageType&&delete o.searchCriteria.age,o.loading=!0;var t=o.groups=a.call(this,o.searchCriteria).then(function(t){o.groups=t,o.isFiltered=n(o.searchCriteria),o.searchCriteria.page=e-1,o.loading=!1});return u.call(this,o.searchCriteria).then(function(e){o.totalCount=e}),o.showCriteria&&(o.showCriteria=!1,$("#search-container").collapse("hide")),t}function n(e){for(var t=["category","keyWord","dayOfWeek","startTimeDate","gender","status","age","childCare","onCampus"],r=0;r<t.length;r++)if(e[t[r]]&&""!=e[t[r]])return!0;return!1}function i(){o.searchCriteria={limit:o.resultLimit,page:0},o.ageType="ALL"}console.log("in listing controller");var o=this,a=t.user?e.groupSearch:e.publishedGroupSearch,u=t.user?e.groupCount:e.publishedGroupCount;o.resultLimit=o.limit||10,o.showCriteria=!1,o.isFiltered=!1,i(),o.search=function(){return r()},o.showMore=function(){return o.searchCriteria.page++,a.call(this,o.searchCriteria).then(function(e){Array.prototype.push.apply(o.groups,e)})},o.showMoreCount=function(){if(o.groups&&o.totalCount){var e=o.totalCount-o.groups.length;return e>o.resultLimit?o.resultLimit:e}return 0},o.clear=function(){i(),o.search()},o.deleteGroup=function(t){e.deleteGroup(t).then(function(){r(o.searchCriteria.page+1)},function(){Util.alert("Failed to delete the group. Please try again later.")})},this.$onInit=function(){o.search()}}function i(){function e(){n.group.schedule.startTimeDate&&(n.group.schedule.startTime=moment(n.group.schedule.startTimeDate).format("HH:mm")),n.group.schedule.endTimeDate&&(n.group.schedule.endTime=moment(n.group.schedule.endTimeDate).format("HH:mm")),n.group.schedule.startDateDate&&(n.group.schedule.startDate=moment(n.group.schedule.startDateDate).format("YYYY-MM-DD")),n.group.schedule.endDateDate&&(n.group.schedule.endDate=moment(n.group.schedule.endDateDate).format("YYYY-MM-DD"))}function t(e){return"WEDNESDAY"==e.schedule.dayOfWeek&&("WEEKLY"==e.schedule.frequency||"EVERY_TWO_WEEKS"==e.schedule.frequency||"BI_MONTHLY_FIRST_THIRD"==e.schedule.frequency||"TRI_MONTHLY"==e.schedule.frequency||"MONTHLY_FIRST"==e.schedule.frequency)&&e.schedule.startTime&&e.schedule.endTime&&moment("2016-10-12T"+e.schedule.startTime).isBefore(moment("2016-10-12T20:00"))&&moment("2016-10-12T"+e.schedule.endTime).isAfter(moment("2016-10-12T19:00"))}function r(e){return"OTHER"!=e.locationType&&moment("2016-10-13T"+e.schedule.endTime).isAfter(moment("2016-10-13T23:00"))}var n=this;n.group.address||(n.group.address={}),n.group.schedule||(n.group.schedule={}),n.group.roomRequest||(n.group.roomRequest={}),n.group.schedule.startTime&&(n.group.schedule.startTimeDate=moment(n.group.schedule.startTime,"HH:mm").toDate()),n.group.schedule.endTime&&(n.group.schedule.endTimeDate=moment(n.group.schedule.endTime,"HH:mm").toDate()),n.group.schedule.startDate&&(n.group.schedule.startDateDate=moment(n.group.schedule.startDate,"YYYY-MM-DD").toDate()),n.group.schedule.endDate&&(n.group.schedule.endDateDate=moment(n.group.schedule.endDate,"YYYY-MM-DD").toDate()),n.locationOnCampus=function(){return"GRACE_NEED_ROOM"==n.group.locationType||"GRACE_HAVE_ROOM"==n.group.locationType},n.requireScheduleTime=function(){return n.group&&"AS_NEEDED"!=n.group.schedule.frequency},n.charactersRemaining=function(e,t){return e-t.length},n.save=function(i){if(i.$valid)if("GRACE_NEED_ROOM"==n.group.locationType&&(n.group.address.room=null),e(),r(n.group))Util.alert("Sorry, the church is closed for meetings after 11pm. Please adjust your schedule.","Info"),$("html, body").animate({scrollTop:$("#schedule").offset().top},500);else{if(!t(n.group))return n.group.study&&(n.group.study=n.group.study.replace(/\n+/g," ")),n.onSave(n.group);Util.alert("Sorry, group meetings cannot occur at the same time as the communion service on first Wednesdays from 7pm to 8pm. Please adjust your schedule.","Info"),$("html, body").animate({scrollTop:$("#schedule").offset().top},500)}else{var o=$(".has-error:first");o.length>0&&$("html, body").animate({scrollTop:o.offset().top},500),Util.alert("Please correct errors indicated in red.","Info")}return null}}function o(e,t,r,n){var i=this;i.group=r,i.leaders=n,i.updateGroup=function(){return t.updateGroup(i.group).then(function(){e.goToGroupEditReturnToState()},function(e){console.log("failed to update the group: "+e),Util.alert("Failed to save the group information. Please try again later.")})}}function a(e,t,r,n){var i=this;i.group={},i.leaders=r,e.authorizer.userCanCreateGroup(n)?"GROUP_LEADER"==n.role&&(i.group.leaderId=n.id):(console.log("unauthorized access"),e.$state.go("error")),i.createGroup=function(){return t.createGroup(i.group).then(function(){e.goToGroupEditReturnToState()},function(e){console.log("failed to create the group: "+e),Util.alert("Failed to create the group. Please try again later.")})}}function u(e,t,r,n){var i=this;i.group=t,i.members=r,i.removeMember=function(t){e.removeGroupMember(i.group.id,t.id).then(function(){i.members.splice(i.members.indexOf(t),1)},function(){console.log("failed to remove the member - ",err),Util.alert("Failed to remove the member. Please try again later.")})},i.backToLabel=function(){return!n.groupMemberReturnToState||"users.details"!=n.groupMemberReturnToState.name&&"users.home"!=n.groupMemberReturnToState.name?"groups":"user details"}}function s(e,t,r,n,i){function o(e,t){var r=!1;t.forEach&&t.forEach(function(t){"user-email-not-unique"==t&&(e.uEmail.$error.serverValidation=!0,e.uEmail.$error.serverError="already used",r=!0)}),r?Util.alert("Please correct errors indicated in red.","Info"):Util.alert("Failed to save the user. Please try again later.")}var a=this;a.newContact={role:"CONTACT"},a.users=[],a.totalCount=null,a.pageCount=0,a.group=r,a.nameChanged=function(){""==(a.newContact.firstName||"")&&""==(a.newContact.lastName||"")?(a.users=[],a.totalCount=null,a.pageCount=0):(t.usersByName(a.newContact.firstName||"",a.newContact.lastName||"",0,i).then(function(e){a.users=e,a.pageCount=1}),t.countUsersByName(a.newContact.firstName||"",a.newContact.lastName||"").then(function(e){
a.totalCount=e}))},a.setCreateMode=function(e){a.createMode=e},a.showMore=function(){t.usersByName(a.newContact.firstName||"",a.newContact.lastName||"",a.pageCount++,i).then(function(e){Array.prototype.push.apply(a.users,e)})},a.showMoreCount=function(){var e=a.totalCount-a.users.length;return e>i?i:e},a.isMember=function(e){for(var t=0;t<n.length;t++){var r=n[t];if(r.id==e.id)return!0;if(r.lastName.toLocaleLowerCase()>e.lastName.toLocaleLowerCase())return!1}return!1},a.addMember=function(i){t.addGroupMember(a.group.id,i.id).then(function(){n.push(i),n.sort(f),e.go("groups.members.view",{id:r.id})},function(e){console.log("failed to add the member - ",e),Util.alert("Failed to add the member. Please try again later.")})},a.saveAndAddMember=function(e){e.$valid?t.createUser(a.newContact).then(function(e){a.newContact.id=e.id,a.addMember(e)},function(t){o(e,t)}):Util.alert("Please correct errors indicated in red.","Info")}}function l(e){var t=this;t.groups=e,t.leaderDisplay=d,t.scheduleDisplay=g,t.timeDisplay=h}function c(e,t,r){var n=this;n.group=e,n.leaderDisplay=d,n.scheduleDisplay=g,n.timeDisplay=h,n.ageDisplay=m,n.approve=function(e){if(e.$valid)return t.approveGroup(n.group).then(function(){r.go("approvals.index")},function(e){console.log("failed to approve the group - ",e),Util.alert("Failed to approve the group. Please try again later.")});var i=$(".has-error:first");return i.length>0&&$("html, body").animate({scrollTop:i.offset().top},500),Util.alert("Please correct errors indicated in red.","Info"),null}}function f(e,t){return e.lastName.localeCompare(t.lastName)}function d(e){var t=e.leader.fullName();return e.secondaryLeader&&(t=t+" & "+e.secondaryLeader.fullName()),t}function g(e){if(null==e)return"";switch(e.frequency){case"WEEKLY":return"Every "+p(e);case"EVERY_TWO_WEEKS":return"Every other "+p(e);case"BI_MONTHLY_FIRST_THIRD":return"Every 1st and 3rd "+p(e);case"BI_MONTHLY_SECOND_FOURTH":return"Every 2nd and 4th "+p(e);case"TRI_MONTHLY":return"Every 1st, 3rd, and 5th "+p(e);case"MONTHLY_FIRST":return"Every 1st "+p(e);case"MONTHLY_SECOND":return"Every 2nd "+p(e);case"MONTHLY_THIRD":return"Every 3rd "+p(e);case"MONTHLY_FOURTH":return"Every 4th "+p(e);case"AS_NEEDED":return p(e)+", as needed"}}function p(e){return S(e.dayOfWeek).capitalize().s}function h(e){return null==e?"":moment(e.startTime,"HH:mm").format("h:mma")+" to "+moment(e.endTime,"HH:mm").format("h:mma")}function m(e){if(e.studentMinistry)return"students";var t=e.minAge||18;return 18>=t&&null==e.maxAge?"all adults":null==e.maxAge?t+" and older":t+" to "+e.maxAge}e.module("groups",["ui.router","users","ngConstants"]).config(["$stateProvider","partialPath",function(e,r){console.log("in config"),e.state("groups",{url:"/groups","abstract":!0,template:"<ui-view></ui-view>",resolve:{authUser:Util.authenticate}}).state("groups.index",{url:"",templateUrl:r+"/groups/index.html",controller:["$rootScope","graceGroupsService",t],controllerAs:"$ctrl"}).state("groups.edit",{url:"/{id:int}/edit",templateUrl:r+"/groups/edit.html",resolve:{group:["graceGroupsService","$stateParams",function(e,t){return e.group(t.id)}],leaders:["graceGroupsService","authUser",function(e,t){return e.groupLeadersForUser(t)}]},controller:["$rootScope","graceGroupsService","group","leaders",o],controllerAs:"$ctrl"}).state("groups.new",{url:"/new",templateUrl:r+"/groups/new.html",resolve:{leaders:["graceGroupsService","authUser",function(e,t){return e.groupLeadersForUser(t)}]},controller:["$rootScope","graceGroupsService","leaders","authUser",a],controllerAs:"$ctrl"}).state("groups.members",{url:"/{id:int}/members","abstract":!0,template:"<ui-view></ui-view>",resolve:{group:["graceGroupsService","$stateParams",function(e,t){return e.group(t.id)}],members:["graceGroupsService","$stateParams",function(e,t){return e.groupMembers(t.id).then(function(e){return e.sort(f)})}]}}).state("groups.members.view",{url:"",templateUrl:r+"/groups/members.html",controller:["graceGroupsService","group","members","$rootScope",u],controllerAs:"$ctrl"}).state("groups.members.select",{url:"/select",templateUrl:r+"/groups/member-select.html",resolve:{limit:function(){return 5}},controller:["$state","graceGroupsService","group","members","limit",s],controllerAs:"$ctrl"}).state("approvals",{url:"/approvals","abstract":!0,template:"<ui-view></ui-view>",resolve:{authUser:Util.authenticateAdmin}}).state("approvals.index",{url:"",templateUrl:r+"/approvals/index.html",resolve:{groups:["graceGroupsService",function(e){return e.groupsPendingApproval()}]},controller:["groups",l],controllerAs:"$ctrl"}).state("approvals.review",{url:"/{id:int}/review",templateUrl:r+"/approvals/review.html",resolve:{group:["graceGroupsService","$stateParams",function(e,t){return e.group(t.id)}]},controller:["group","graceGroupsService","$state",c],controllerAs:"$ctrl"})}]).component("ggGroup",{templateUrl:["partialPath",function(e){return e+"/groups/view.html"}],bindings:{$router:"<",group:"<",options:"@",onEdit:"&",onMembers:"&",onDelete:"&"},controller:["graceGroupsService","$rootScope","$element",r]}).component("graceGroupListing",{templateUrl:["partialPath",function(e){return e+"/groups/listing.html"}],bindings:{limit:"<",showSearch:"<",onEditGroup:"&",onGroupMembers:"&"},controller:["graceGroupsService","$rootScope",n]}).component("ggGroupForm",{templateUrl:["partialPath",function(e){return e+"/groups/groupForm.html"}],bindings:{$router:"<",group:"<",leaders:"<",onSave:"&",onCancel:"&"},controller:[i]})}(window.angular),function(e){"use strict";function t(e,t,r,n,i,o){function a(i){return t(function(t,o){e.post(L("/users/login"),i,k()).then(function(e){r.put(q,e.data.token,{secure:n}),B(e.data.user),t(e.data.user)},function(e){var t=e.status<500&&e.status>399?"invalid-login":"server-error";o(t)})})}function u(){return t(function(t,r){e.get(L("/users/current"),k()).then(function(e){B(e.data),t(e.data)},function(e){console.log("current user error",e);var t=401==e.status?"no-auth":"server-error";r(t)})})}function s(){r.remove(q)}function l(r){return t(function(t,n){e.put(L("/users",r.id),r,k()).then(function(){t()},function(e){n(j(e))})})}function c(r){return t(function(t,n){e.post(L("/users"),r,k()).then(function(e){B(e.data),t(e.data)},function(e){n(j(e))})})}function f(){return t(function(t,r){e.get(L("/users"),k()).then(function(e){e.data.forEach(function(e){B(e)}),t(e.data)},function(){r("server-error")})})}function d(r){return t(function(t,n){e.get(L("/users",r),k()).then(function(e){B(e.data),t(e.data)},function(e){var t=e.status<500?"user-not-found":"server-error";n(t)})})}function g(r){return t(function(t,n){e.get(L("/users/by-role"),k({role:r})).then(function(e){e.data.forEach(function(e){B(e)}),t(e.data)},function(e){console.log(e),n("server-error")})})}function p(r,n,i,o){return t(function(t,a){e.get(L("/users/by-name"),k({firstName:r,lastName:n,page:i,limit:o})).then(function(e){e.data.forEach(function(e){B(e)}),t(e.data)},function(){a("server-error")})})}function h(r,n){return t(function(t,i){e.get(L("/users/count/by-name"),k({firstName:r,lastName:n})).then(function(e){t(e.data)},function(){i("server-error")})})}function m(r){return t(function(t,n){e.get(L("/users",r.id,"group-leaders"),k()).then(function(e){e.data.forEach(function(e){B(e)}),t(e.data)},function(){n("server-error")})})}function v(){return t(function(t,r){e.get(L("/users/managers"),k()).then(function(e){e.data.forEach(function(e){B(e)}),t(e.data)},function(){r("server-error")})})}function b(r){return t(function(t,n){e.get(L("/users",r,"direct-reports"),k()).then(function(e){e.data.forEach(function(e){B(e)}),t(e.data)},function(){n("server-error")})})}function y(r){return t(function(t,n){e["delete"](L("/users",r.id),k()).then(function(){t()},function(e){n(j(e))})})}function $(e,n){var i=r.get(q);return t(function(t,r){o.upload({url:L("/users",e,"image"),data:{file:n},headers:{Authorization:"Bearer "+i},method:"POST"}).then(function(e){console.log(e.data),B(e.data),t(e.data)},function(e){r(j(e))})})}function U(){return t(function(t,r){e.get(L("/groups"),k()).then(function(e){e.data.forEach(function(e){V(e)}),t(e.data)},function(){r("server-error")})})}function w(){return t(function(t,r){e.get(L("/groups/export"),k()).then(function(e){t(e.data)},function(){r("server-error")})})}function C(){return t(function(t,r){e.get(L("/groups/pending-approval"),k()).then(function(e){e.data.forEach(function(e){V(e)}),t(e.data)},function(){r("server-error")})})}function T(r){return t(function(t,n){e.post(L("/groups"),r,k()).then(function(){t()},function(e){n(j(e))})})}function E(r){return t(function(t,n){e.get(L("/groups",r),k()).then(function(e){V(e.data),t(e.data)},function(e){var t=e.status<500?"group-not-found":"server-error";n(t)})})}function D(r){return t(function(t,n){e.put(L("/groups",r.id),r,k()).then(function(){t()},function(e){n(j(e))})})}function A(r){return t(function(t,n){e.get(L("/groups",r,"members"),k()).then(function(e){e.data.forEach(function(e){B(e)}),t(e.data)},function(e){var t=e.status<500?"group-not-found":"server-error";n(t)})})}function R(r,n){return t(function(t,i){e.put(L("/groups",r,"add-member/"+n),null,k()).then(function(){t()},function(e){var t=e.status<500?"bad-data":"server-error";i(t)})})}function P(r,n){return t(function(t,i){e.put(L("/groups",r,"remove-member/"+n),null,k()).then(function(){t()},function(e){var t=e.status<500?"bad-data":"server-error";i(t)})})}function x(r){return t(function(t,n){e.put(L("/groups",r.id,"approve"),r,k()).then(function(){t()},function(){n("server-error")})})}function _(r){return t(function(t,n){e.get(L("/groups/by-user"),k({userId:r})).then(function(e){e.data.forEach(function(e){V(e)}),t(e.data)},function(){n("server-error")})})}function O(r){return t(function(t,n){e.get(L("/groups/search"),k(r)).then(function(e){console.log(e),e.data.forEach(function(e){V(e)}),t(e.data)},function(){n("server-error")})})}function M(r){return t(function(t,n){e.get(L("/groups/count"),k(r)).then(function(e){t(e.data)},function(){n("server-error")})})}function F(r){return t(function(t,n){e.get(L("/groups/published/search"),k(r)).then(function(e){console.log(e),e.data.forEach(function(e){V(e)}),t(e.data)},function(){n("server-error")})})}function I(r){return t(function(t,n){e.get(L("/groups/published/count"),k(r)).then(function(e){t(e.data)},function(){n("server-error")})})}function G(r){return t(function(t,n){e["delete"](L("/groups",r.id),k()).then(function(){t()},function(e){n(j(e))})})}function N(r){return t(function(t,n){e.get(L("/groups",r,"calendar-export"),k()).then(function(e){t(e.data)},function(){n("server-error")})})}function z(r){return t(function(t,n){e.get(L("/groups",r,"published/calendar-export"),k()).then(function(e){t(e.data)},function(){n("server-error")})})}function L(e,t,r){var n=H+e;return t&&(n=n+"/"+t),r&&(n=n+"/"+r),n}function k(e){var t={withCredentials:!0};e&&(t.params=e);var n=r.get(q);return n&&(t.headers={Authorization:"Bearer "+n}),t}function B(e){e.shortName=function(){return S(e.firstName).capitalize().s+" "+S(e.lastName.substring(0,1)).capitalize()+"."},e.fullName=function(){return S(e.firstName).capitalize().s+" "+S(e.lastName).capitalize().s},e.roleLabel=function(){return S(e.role).humanize().s}}function V(e){B(e.leader),e.secondaryLeader&&B(e.secondaryLeader),e.isFull=function(){return null!=this.capacity&&this.memberIds.length>=this.capacity}}function j(e){return e.status<500&&e.status>399?e.data:["server-error"]}var H=i,q="ggs-auth-token";return{login:a,currentUser:u,logout:s,updateUser:l,users:f,user:d,createUser:c,usersByRole:g,usersByName:p,countUsersByName:h,groupLeadersForUser:m,managers:v,directReports:b,deleteUser:y,uploadUserImage:$,groups:U,groupExport:w,groupsPendingApproval:C,createGroup:T,group:E,updateGroup:D,groupMembers:A,addGroupMember:R,removeGroupMember:P,approveGroup:x,groupsForUser:_,groupSearch:O,groupCount:M,publishedGroupSearch:F,publishedGroupCount:I,deleteGroup:G,groupCalendarExport:N,publishedGroupCalendarExport:z}}e.module("graceGroupsService",["ngCookies","ngConstants","ngFileUpload"]).config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]).service("graceGroupsService",["$http","$q","$cookies","secureCookies","serviceUrl","Upload",t])}(window.angular),function(e){"use strict";function t(){function e(){return p.slice()}function t(e,t){if(t=t||!1,"PASTOR"==e.role||e.admin)return p.slice();for(var r=0;r<p.length-1;r++)if(p[r].code==e.role)return p.slice(t?r:r+1);return[{code:"CONTACT",label:"Contact"}]}function r(e,t){return null==e?!1:e.admin||"PASTOR"==e.role||"CONTACT"==t.role||e.id==t.id?!0:s(e,t)}function n(e,t){return null==e?!1:"CONTACT"==t.role?g(e):e.id!=t.id&&r(e,t)}function i(e,t){return null==e?!1:e.admin||null==t.id||null==t.manager||r(e,t)&&e.id!=t.id}function o(e){return null==e?!1:e.admin||"GROUP_LEADER"!=e.role&&"CONTACT"!=e.role}function a(e,t){if(null==e)return!1;var r=e.admin||"PASTOR"==e.role,n=e.id==t.leaderId,i=e.id==t.secondaryLeaderId,o=s(e,t.leader);return r||n||i||o}function u(e){return null!=e}function s(e,t){for(var r=t.manager,n=0;null!=r&&n++<p.length-1;){if(r.id==e.id)return!0;r=r.manager}return!1}function l(e,t){return a(e,t)}function c(e,t){var r=[];return a(e,t)&&r.push("edit"),l(e,t)&&r.push("delete"),r}function f(e,t){return c(e,t).join(" ")}function d(e){return g(e)}function g(e){return e&&(e.admin||"PASTOR"==e.role)}var p=[{code:"ADMIN",label:"Admin"},{code:"PASTOR",label:"Pastor"},{code:"DIVISION_DIRECTOR",label:"Division Director"},{code:"DIVISION_LEADER",label:"Division Leader"},{code:"GROUP_LEADER",label:"Group Leader"},{code:"CONTACT",label:"Contact"}];return{roles:e,rolesAssignableBy:t,userCanEditUser:r,userCanDeleteUser:n,userCanChangeManagerOf:i,userCanChangeGroupLeader:o,userCanEditGroup:a,userCanCreateGroup:u,isUserManagerOf:s,userCanDeleteGroup:l,groupPrivileges:c,groupPrivilegesString:f,canDownloadGroups:d}}e.module("authorizer",[]).service("authorizer",[t])}(window.angular);